<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #20794d; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #20794d; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
  <title>Home: Part 4: Tidymodels Workflowsets</title>

  <meta property="description" itemprop="description" content="On this Part 4 page we will analyse the same agroforestry data from ERA, as in Part 3, but we are going to make use of the relatively new tidymodels package called &quot;Workflowsets&quot;. We are going to skip the preliminary explorertive data analysis (EDA) and jump straight to the modelling setup.  &quot;Show code&quot; to view the R codes used to perform a given analysis or visualise a analysis output. As you have seen in Part 3, tidymodels builds on the integration of model specifications from the parsnip package and data pre-processing steps using the recipe package. These are integrated into a workflow using the workflows package, and finally tuned using the tune package. What is revolutionary about the latest member in the tidymodels family is the workflowsets package that can create a workflow set that holds multiple workflow objects (integrated model specifications and pre-processing steps). This object, or set, can then easily be tuned or fitted based on resamples by using a set of simple commands. Workflowsets is a powerful concept for modelling as researchers often are interested in test and compare the performance of multiple models specified under different pre-processing settings."/>

  <link rel="icon" type="image/png" href="./IMAGES/ERA_logo_circle.png"/>


  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Home: Part 4: Tidymodels Workflowsets"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="On this Part 4 page we will analyse the same agroforestry data from ERA, as in Part 3, but we are going to make use of the relatively new tidymodels package called &quot;Workflowsets&quot;. We are going to skip the preliminary explorertive data analysis (EDA) and jump straight to the modelling setup.  &quot;Show code&quot; to view the R codes used to perform a given analysis or visualise a analysis output. As you have seen in Part 3, tidymodels builds on the integration of model specifications from the parsnip package and data pre-processing steps using the recipe package. These are integrated into a workflow using the workflows package, and finally tuned using the tune package. What is revolutionary about the latest member in the tidymodels family is the workflowsets package that can create a workflow set that holds multiple workflow objects (integrated model specifications and pre-processing steps). This object, or set, can then easily be tuned or fitted based on resamples by using a set of simple commands. Workflowsets is a powerful concept for modelling as researchers often are interested in test and compare the performance of multiple models specified under different pre-processing settings."/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:site_name" content="Home"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Home: Part 4: Tidymodels Workflowsets"/>
  <meta property="twitter:description" content="On this Part 4 page we will analyse the same agroforestry data from ERA, as in Part 3, but we are going to make use of the relatively new tidymodels package called &quot;Workflowsets&quot;. We are going to skip the preliminary explorertive data analysis (EDA) and jump straight to the modelling setup.  &quot;Show code&quot; to view the R codes used to perform a given analysis or visualise a analysis output. As you have seen in Part 3, tidymodels builds on the integration of model specifications from the parsnip package and data pre-processing steps using the recipe package. These are integrated into a workflow using the workflows package, and finally tuned using the tune package. What is revolutionary about the latest member in the tidymodels family is the workflowsets package that can create a workflow set that holds multiple workflow objects (integrated model specifications and pre-processing steps). This object, or set, can then easily be tuned or fitted based on resamples by using a set of simple commands. Workflowsets is a powerful concept for modelling as researchers often are interested in test and compare the performance of multiple models specified under different pre-processing settings."/>

  <!--/radix_placeholder_meta_tags-->
  
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","favicon","description","bibliography","csl","output"]}},"value":[{"type":"character","attributes":{},"value":["Part 4: Tidymodels Workflowsets"]},{"type":"character","attributes":{},"value":["./IMAGES/ERA_logo_circle.png"]},{"type":"character","attributes":{},"value":["On this Part 4 page we will analyse the same agroforestry data from ERA, as in Part 3, but we are going to make use of the relatively new tidymodels package called \"Workflowsets\". We are going to skip the preliminary explorertive data analysis (EDA) and jump straight to the modelling setup.  \"Show code\" to view the R codes used to perform a given analysis or visualise a analysis output. As you have seen in Part 3, tidymodels builds on the integration of model specifications from the parsnip package and data pre-processing steps using the recipe package. These are integrated into a workflow using the workflows package, and finally tuned using the tune package. What is revolutionary about the latest member in the tidymodels family is the workflowsets package that can create a workflow set that holds multiple workflow objects (integrated model specifications and pre-processing steps). This object, or set, can then easily be tuned or fitted based on resamples by using a set of simple commands. Workflowsets is a powerful concept for modelling as researchers often are interested in test and compare the performance of multiple models specified under different pre-processing settings. \n"]},{"type":"character","attributes":{},"value":["library.bib"]},{"type":"character","attributes":{},"value":["frontiers-in-ecology-and-the-environment.csl"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["toc","toc_float","toc_depth","number_sections","code_folding"]}},"value":[{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[true]},{"type":"integer","attributes":{},"value":[3]},{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[true]}]}]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  <!--radix_placeholder_navigation_in_header-->
  <meta name="distill:offset" content=""/>

  <script type="application/javascript">

    window.headroom_prevent_pin = false;

    window.document.addEventListener("DOMContentLoaded", function (event) {

      // initialize headroom for banner
      var header = $('header').get(0);
      var headerHeight = header.offsetHeight;
      var headroom = new Headroom(header, {
        tolerance: 5,
        onPin : function() {
          if (window.headroom_prevent_pin) {
            window.headroom_prevent_pin = false;
            headroom.unpin();
          }
        }
      });
      headroom.init();
      if(window.location.hash)
        headroom.unpin();
      $(header).addClass('headroom--transition');

      // offset scroll location for banner on hash change
      // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
      window.addEventListener("hashchange", function(event) {
        window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
      });

      // responsive menu
      $('.distill-site-header').each(function(i, val) {
        var topnav = $(this);
        var toggle = topnav.find('.nav-toggle');
        toggle.on('click', function() {
          topnav.toggleClass('responsive');
        });
      });

      // nav dropdowns
      $('.nav-dropbtn').click(function(e) {
        $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
        $(this).parent().siblings('.nav-dropdown')
           .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $("body").click(function(e){
        $('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $(".nav-dropdown").click(function(e){
        e.stopPropagation();
      });
    });
  </script>

  <style type="text/css">

  /* Theme (user-documented overrideables for nav appearance) */

  .distill-site-nav {
    color: rgba(255, 255, 255, 0.8);
    background-color: #0F2E3D;
    font-size: 15px;
    font-weight: 300;
  }

  .distill-site-nav a {
    color: inherit;
    text-decoration: none;
  }

  .distill-site-nav a:hover {
    color: white;
  }

  @media print {
    .distill-site-nav {
      display: none;
    }
  }

  .distill-site-header {

  }

  .distill-site-footer {

  }


  /* Site Header */

  .distill-site-header {
    width: 100%;
    box-sizing: border-box;
    z-index: 3;
  }

  .distill-site-header .nav-left {
    display: inline-block;
    margin-left: 8px;
  }

  @media screen and (max-width: 768px) {
    .distill-site-header .nav-left {
      margin-left: 0;
    }
  }


  .distill-site-header .nav-right {
    float: right;
    margin-right: 8px;
  }

  .distill-site-header a,
  .distill-site-header .title {
    display: inline-block;
    text-align: center;
    padding: 14px 10px 14px 10px;
  }

  .distill-site-header .title {
    font-size: 18px;
    min-width: 150px;
  }

  .distill-site-header .logo {
    padding: 0;
  }

  .distill-site-header .logo img {
    display: none;
    max-height: 20px;
    width: auto;
    margin-bottom: -4px;
  }

  .distill-site-header .nav-image img {
    max-height: 18px;
    width: auto;
    display: inline-block;
    margin-bottom: -3px;
  }



  @media screen and (min-width: 1000px) {
    .distill-site-header .logo img {
      display: inline-block;
    }
    .distill-site-header .nav-left {
      margin-left: 20px;
    }
    .distill-site-header .nav-right {
      margin-right: 20px;
    }
    .distill-site-header .title {
      padding-left: 12px;
    }
  }


  .distill-site-header .nav-toggle {
    display: none;
  }

  .nav-dropdown {
    display: inline-block;
    position: relative;
  }

  .nav-dropdown .nav-dropbtn {
    border: none;
    outline: none;
    color: rgba(255, 255, 255, 0.8);
    padding: 16px 10px;
    background-color: transparent;
    font-family: inherit;
    font-size: inherit;
    font-weight: inherit;
    margin: 0;
    margin-top: 1px;
    z-index: 2;
  }

  .nav-dropdown-content {
    display: none;
    position: absolute;
    background-color: white;
    min-width: 200px;
    border: 1px solid rgba(0,0,0,0.15);
    border-radius: 4px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
    z-index: 1;
    margin-top: 2px;
    white-space: nowrap;
    padding-top: 4px;
    padding-bottom: 4px;
  }

  .nav-dropdown-content hr {
    margin-top: 4px;
    margin-bottom: 4px;
    border: none;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .nav-dropdown-active {
    display: block;
  }

  .nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
    color: black;
    padding: 6px 24px;
    text-decoration: none;
    display: block;
    text-align: left;
  }

  .nav-dropdown-content .nav-dropdown-header {
    display: block;
    padding: 5px 24px;
    padding-bottom: 0;
    text-transform: uppercase;
    font-size: 14px;
    color: #999999;
    white-space: nowrap;
  }

  .nav-dropdown:hover .nav-dropbtn {
    color: white;
  }

  .nav-dropdown-content a:hover {
    background-color: #ddd;
    color: black;
  }

  .nav-right .nav-dropdown-content {
    margin-left: -45%;
    right: 0;
  }

  @media screen and (max-width: 768px) {
    .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
    .distill-site-header a.nav-toggle {
      float: right;
      display: block;
    }
    .distill-site-header .title {
      margin-left: 0;
    }
    .distill-site-header .nav-right {
      margin-right: 0;
    }
    .distill-site-header {
      overflow: hidden;
    }
    .nav-right .nav-dropdown-content {
      margin-left: 0;
    }
  }


  @media screen and (max-width: 768px) {
    .distill-site-header.responsive {position: relative; min-height: 500px; }
    .distill-site-header.responsive a.nav-toggle {
      position: absolute;
      right: 0;
      top: 0;
    }
    .distill-site-header.responsive a,
    .distill-site-header.responsive .nav-dropdown {
      display: block;
      text-align: left;
    }
    .distill-site-header.responsive .nav-left,
    .distill-site-header.responsive .nav-right {
      width: 100%;
    }
    .distill-site-header.responsive .nav-dropdown {float: none;}
    .distill-site-header.responsive .nav-dropdown-content {position: relative;}
    .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
      display: block;
      width: 100%;
      text-align: left;
    }
  }

  /* Site Footer */

  .distill-site-footer {
    width: 100%;
    overflow: hidden;
    box-sizing: border-box;
    z-index: 3;
    margin-top: 30px;
    padding-top: 30px;
    padding-bottom: 30px;
    text-align: center;
  }

  /* Headroom */

  d-title {
    padding-top: 6rem;
  }

  @media print {
    d-title {
      padding-top: 4rem;
    }
  }

  .headroom {
    z-index: 1000;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
  }

  .headroom--transition {
    transition: all .4s ease-in-out;
  }

  .headroom--unpinned {
    top: -100px;
  }

  .headroom--pinned {
    top: 0;
  }

  /* adjust viewport for navbar height */
  /* helps vertically center bootstrap (non-distill) content */
  .min-vh-100 {
    min-height: calc(100vh - 100px) !important;
  }

  </style>

  <script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
  <link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
  <script src="site_libs/headroom-0.9.4/headroom.min.js"></script>
  <script src="site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
  <script src="site_libs/fuse-6.4.1/fuse.min.js"></script>

  <script type="application/javascript">

  function getMeta(metaName) {
    var metas = document.getElementsByTagName('meta');
    for (let i = 0; i < metas.length; i++) {
      if (metas[i].getAttribute('name') === metaName) {
        return metas[i].getAttribute('content');
      }
    }
    return '';
  }

  function offsetURL(url) {
    var offset = getMeta('distill:offset');
    return offset ? offset + '/' + url : url;
  }

  function createFuseIndex() {

    // create fuse index
    var options = {
      keys: [
        { name: 'title', weight: 20 },
        { name: 'categories', weight: 15 },
        { name: 'description', weight: 10 },
        { name: 'contents', weight: 5 },
      ],
      ignoreLocation: true,
      threshold: 0
    };
    var fuse = new window.Fuse([], options);

    // fetch the main search.json
    return fetch(offsetURL('search.json'))
      .then(function(response) {
        if (response.status == 200) {
          return response.json().then(function(json) {
            // index main articles
            json.articles.forEach(function(article) {
              fuse.add(article);
            });
            // download collections and index their articles
            return Promise.all(json.collections.map(function(collection) {
              return fetch(offsetURL(collection)).then(function(response) {
                if (response.status === 200) {
                  return response.json().then(function(articles) {
                    articles.forEach(function(article) {
                      fuse.add(article);
                    });
                  })
                } else {
                  return Promise.reject(
                    new Error('Unexpected status from search index request: ' +
                              response.status)
                  );
                }
              });
            })).then(function() {
              return fuse;
            });
          });

        } else {
          return Promise.reject(
            new Error('Unexpected status from search index request: ' +
                        response.status)
          );
        }
      });
  }

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // get search element (bail if we don't have one)
    var searchEl = window.document.getElementById('distill-search');
    if (!searchEl)
      return;

    createFuseIndex()
      .then(function(fuse) {

        // make search box visible
        searchEl.classList.remove('hidden');

        // initialize autocomplete
        var options = {
          autoselect: true,
          hint: false,
          minLength: 2,
        };
        window.autocomplete(searchEl, options, [{
          source: function(query, callback) {
            const searchOptions = {
              isCaseSensitive: false,
              shouldSort: true,
              minMatchCharLength: 2,
              limit: 10,
            };
            var results = fuse.search(query, searchOptions);
            callback(results
              .map(function(result) { return result.item; })
            );
          },
          templates: {
            suggestion: function(suggestion) {
              var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
                ? `<img src="${offsetURL(suggestion.preview)}"</img>`
                : '';
              var html = `
                <div class="search-item">
                  <h3>${suggestion.title}</h3>
                  <div class="search-item-description">
                    ${suggestion.description || ''}
                  </div>
                  <div class="search-item-preview">
                    ${img}
                  </div>
                </div>
              `;
              return html;
            }
          }
        }]).on('autocomplete:selected', function(event, suggestion) {
          window.location.href = offsetURL(suggestion.path);
        });
        // remove inline display style on autocompleter (we want to
        // manage responsive display via css)
        $('.algolia-autocomplete').css("display", "");
      })
      .catch(function(error) {
        console.log(error);
      });

  });

  </script>

  <style type="text/css">

  .nav-search {
    font-size: x-small;
  }

  /* Algolioa Autocomplete */

  .algolia-autocomplete {
    display: inline-block;
    margin-left: 10px;
    vertical-align: sub;
    background-color: white;
    color: black;
    padding: 6px;
    padding-top: 8px;
    padding-bottom: 0;
    border-radius: 6px;
    border: 1px #0F2E3D solid;
    width: 180px;
  }


  @media screen and (max-width: 768px) {
    .distill-site-nav .algolia-autocomplete {
      display: none;
      visibility: hidden;
    }
    .distill-site-nav.responsive .algolia-autocomplete {
      display: inline-block;
      visibility: visible;
    }
    .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
      margin-left: 0;
      width: 400px;
      max-height: 400px;
    }
  }

  .algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
    width: 90%;
    outline: none;
    border: none;
  }

  .algolia-autocomplete .aa-hint {
    color: #999;
  }
  .algolia-autocomplete .aa-dropdown-menu {
    width: 550px;
    max-height: 70vh;
    overflow-x: visible;
    overflow-y: scroll;
    padding: 5px;
    margin-top: 3px;
    margin-left: -150px;
    background-color: #fff;
    border-radius: 5px;
    border: 1px solid #999;
    border-top: none;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
    cursor: pointer;
    padding: 5px 4px;
    border-bottom: 1px solid #eee;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
    border-bottom: none;
    margin-bottom: 2px;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
    overflow: hidden;
    font-size: 0.8em;
    line-height: 1.4em;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
    font-size: 1rem;
    margin-block-start: 0;
    margin-block-end: 5px;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
    display: inline-block;
    overflow: hidden;
    height: 2.8em;
    width: 80%;
    margin-right: 4%;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
    display: inline-block;
    width: 15%;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
    height: 3em;
    width: auto;
    display: none;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
    display: initial;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
    background-color: #eee;
  }
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
    font-weight: bold;
    font-style: normal;
  }

  </style>


  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure img {
    width: 100%;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        var refHtml = $('#ref-' + $(this).attr('data-cites')).html();
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
  <script src="site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Part 4: Tidymodels Workflowsets","description":"On this Part 4 page we will analyse the same agroforestry data from ERA, as in Part 3, but we are going to make use of the relatively new tidymodels package called \"Workflowsets\". We are going to skip the preliminary explorertive data analysis (EDA) and jump straight to the modelling setup.  \"Show code\" to view the R codes used to perform a given analysis or visualise a analysis output. As you have seen in Part 3, tidymodels builds on the integration of model specifications from the parsnip package and data pre-processing steps using the recipe package. These are integrated into a workflow using the workflows package, and finally tuned using the tune package. What is revolutionary about the latest member in the tidymodels family is the workflowsets package that can create a workflow set that holds multiple workflow objects (integrated model specifications and pre-processing steps). This object, or set, can then easily be tuned or fitted based on resamples by using a set of simple commands. Workflowsets is a powerful concept for modelling as researchers often are interested in test and compare the performance of multiple models specified under different pre-processing settings.","authors":[]}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a class="logo" href="https://era.ccafs.cgiar.org/about/">
<img src="IMAGES/ERA_logo_circle.png" alt="Logo"/>
</a>
<a href="index.html" class="title">Home</a>
</div>
<div class="nav-right">
<a href="ABOUT.html">About this site</a>
<a href="INTRO.html">PART 1: Introduction</a>
<a href="ERAANA.html">PART 2: Analysing with ERAAnalyze</a>
<a href="MLTIDYMODELS.html">PART 3: Analysing with Tidymodels</a>
<a href="TIDYMODELSWFS.html">PART 4: Analysing with Tidymodels Workflowsets</a>
<a href="https://github.com/kamaulindhardt/ERA_Agroforestry_destill_website">
<i class="fab fa-github" aria-hidden="true"></i>
</a>
<a href="https://twitter.com/KamauLindhardt">
<i class="fa fa-twitter" aria-hidden="true"></i>
</a>
<a href="https://www.linkedin.com/in/magnus-kamau-lindhardt/">
<i class="fa fa-linkedin" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Part 4: Tidymodels Workflowsets</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>On this Part 4 page we will analyse the same agroforestry data from ERA, as in Part 3, but we are going to make use of the relatively new tidymodels package called “Workflowsets.” We are going to skip the preliminary explorertive data analysis (EDA) and jump straight to the modelling setup. “Show code” to view the R codes used to perform a given analysis or visualise a analysis output. As you have seen in Part 3, tidymodels builds on the integration of model specifications from the parsnip package and data pre-processing steps using the recipe package. These are integrated into a workflow using the workflows package, and finally tuned using the tune package. What is revolutionary about the latest member in the tidymodels family is the workflowsets package that can create a workflow set that holds multiple workflow objects (integrated model specifications and pre-processing steps). This object, or set, can then easily be tuned or fitted based on resamples by using a set of simple commands. Workflowsets is a powerful concept for modelling as researchers often are interested in test and compare the performance of multiple models specified under different pre-processing settings.</p></p>
</div>


<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#loading-necessary-r-packages-and-era-data">Loading necessary R packages and ERA data</a>
<ul>
<li><a href="#step-1-getting-the-data">STEP 1: Getting the data</a></li>
<li><a href="#step-2-splitting-data">STEP 2: Splitting data</a></li>
<li><a href="#step-3-define-resampling-techniques-on-training-data">STEP 3: Define resampling techniques on training data</a></li>
<li><a href="#step-4-define-model-metrics">STEP 4: Define model metrics</a></li>
<li><a href="#step-5-create-pre-processing-recipies">STEP 5: Create pre-processing recipies</a></li>
<li><a href="#step-6-defining-model-specifications">STEP 6: Defining model specifications</a></li>
<li><a href="#step-7-integrating-pre-processing-and-model-specification-into-a-workflowset">STEP 7: Integrating pre-processing and model specification into a workflowset</a></li>
<li><a href="#step-8-tuning-workflowsets-using-tune_grid-or-tune_race_anova">STEP 8: Tuning workflowsets using tune_grid() or tune_race_anova()</a>
<ul>
<li><a href="#using-tune_grid">Using tune_grid()</a></li>
<li><a href="#using-tune_race_anova">Using tune_race_anova()</a></li>
</ul></li>
<li><a href="#step-9-assessing-results-of-the-tuned-workflowsets">STEP 9: Assessing results of the tuned workflowsets</a>
<ul>
<li><a href="#from-tune_grid">From tune_grid()</a></li>
</ul></li>
<li><a href="#step-10-finalizing-models">STEP 10: Finalizing models</a>
<ul>
<li><a href="#extracting-best-performing-models-configurations">Extracting best performing models configurations</a></li>
<li><a href="#performing-last-fitting-on-the-whole-dataset-traningset-testingset">Performing last fitting on the whole dataset (traningset + testingset)</a></li>
</ul></li>
<li><a href="#step-11-explaining-models-and-predictions">STEP 11: Explaining models and predictions</a>
<ul>
<li><a href="#explainer">Explainer</a></li>
</ul></li>
</ul></li>
<li><a href="#random-forest">Random forest</a></li>
</ul>
</nav>
</div>
<p>Here we are going to explore Machine Learning with Tidymodels on the ERA agroforestry data</p>
<p>These objects can be created by crossing all combinations of pre-processors (e.g., formula, recipe, etc) and model specifications. This different model toolkit in the arsenal of</p>
<h1 id="loading-necessary-r-packages-and-era-data">Loading necessary R packages and ERA data</h1>
<p><strong>Loading general R packages</strong></p>
<p>This part of the document is where we actually get to the nitty-gritty of the ERA agroforestry data and therefore it requires us to load a number of R packages for both general Explorortive Data Analysis and Machine Learning.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Using the pacman functions to load required packages</span>

        <span class='kw'>if</span><span class='op'>(</span><span class='op'>!</span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='st'><a href='https://github.com/trinker/pacman'>"pacman"</a></span>, character.only <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span>
          <span class='fu'><a href='https://rdrr.io/r/utils/install.packages.html'>install.packages</a></span><span class='op'>(</span><span class='st'>"pacman"</span>,dependencies <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span>
          <span class='op'>}</span>

<span class='co'># ------------------------------------------------------------------------------------------</span>
<span class='co'># General packages</span>
<span class='co'># ------------------------------------------------------------------------------------------</span>
<span class='va'>required.packages</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"tidyverse"</span>, <span class='st'>"tidymodels"</span>, <span class='st'>"finetune"</span>, <span class='st'>"kernlab"</span>, <span class='st'>"here"</span>, <span class='st'>"hablar"</span>, <span class='st'>"spatialsample"</span>, 
                       <span class='st'>"stacks"</span>, <span class='st'>"rules"</span>, <span class='st'>"baguette"</span>, <span class='st'>"viridis"</span>, <span class='st'>"yardstick"</span>, <span class='st'>"DALEXtra"</span>, <span class='st'>"see"</span>, <span class='st'>"ggridges"</span>,
<span class='co'># ------------------------------------------------------------------------------------------</span>
<span class='co'># Parallel computing packages</span>
<span class='co'># ------------------------------------------------------------------------------------------</span>
                      <span class='st'>"parallelMap"</span>, <span class='st'>"parallelly"</span>, <span class='st'>"parallel"</span>, <span class='st'>"doParallel"</span>
<span class='op'>)</span>

<span class='fu'>p_load</span><span class='op'>(</span>char<span class='op'>=</span><span class='va'>required.packages</span>, install <span class='op'>=</span> <span class='cn'>T</span>,character.only <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<h2 id="step-1-getting-the-data">STEP 1: Getting the data</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>agrofor.biophys.modelling.data.wf</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>readRDS</a></span><span class='op'>(</span>file <span class='op'>=</span> <span class='fu'>here</span><span class='fu'>::</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"agrofor.biophys.modelling.data.RDS"</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>ml.data.wf</span> <span class='op'>&lt;-</span>  <span class='va'>agrofor.biophys.modelling.data.wf</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"RR"</span>, <span class='st'>"ID"</span>, <span class='st'>"AEZ16s"</span>, <span class='st'>"Country"</span>, <span class='st'>"MeanC"</span>, <span class='st'>"MeanT"</span>, <span class='st'>"PrName.Code"</span>, <span class='st'>"SubPrName"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Removing outliers from logRR</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>is_outlier</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>x</span> <span class='op'>&lt;</span> <span class='fu'><a href='https://rdrr.io/r/stats/quantile.html'>quantile</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='fl'>0.25</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>3</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/stats/IQR.html'>IQR</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>|</span> <span class='va'>x</span> <span class='op'>&gt;</span> <span class='fu'><a href='https://rdrr.io/r/stats/quantile.html'>quantile</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='fl'>0.75</span><span class='op'>)</span> <span class='op'>+</span> <span class='fl'>3</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/stats/IQR.html'>IQR</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='va'>ml.data.outliers.wf</span> <span class='op'>&lt;-</span> <span class='va'>ml.data.wf</span> <span class='op'>%&gt;%</span>
  <span class='fu'>rationalize</span><span class='op'>(</span><span class='va'>logRR</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>drop_na</span><span class='op'>(</span><span class='va'>logRR</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>ERA_Agroforestry <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>ERA_Agroforestry</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>logRR.outlier <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='fu'>is_outlier</span><span class='op'>(</span><span class='va'>logRR</span><span class='op'>)</span>, <span class='va'>logRR</span>, <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fl'>9999</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Agroforestry data with no outliers</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>ml.data.no.outliers.wf</span> <span class='op'>&lt;-</span>  <span class='va'>ml.data.outliers.wf</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>logRR.outlier</span> <span class='op'>==</span> <span class='fl'>9999</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>ERA_Agroforestry</span>, <span class='va'>logRR.outlier</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Notice we do not remove missing values</p>
<h2 id="step-2-splitting-data">STEP 2: Splitting data</h2>
<p>Split data in training and testing sets</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>456</span><span class='op'>)</span>

<span class='co'># Splitting data</span>
<span class='va'>af.split.wf</span> <span class='op'>&lt;-</span> <span class='fu'>initial_split</span><span class='op'>(</span><span class='va'>ml.data.no.outliers.wf</span>, prop <span class='op'>=</span> <span class='fl'>0.80</span>, strata <span class='op'>=</span> <span class='va'>logRR</span><span class='op'>)</span>

<span class='va'>af.train.wf</span> <span class='op'>&lt;-</span> <span class='fu'>training</span><span class='op'>(</span><span class='va'>af.split.wf</span><span class='op'>)</span>
<span class='va'>af.test.wf</span> <span class='op'>&lt;-</span> <span class='fu'>testing</span><span class='op'>(</span><span class='va'>af.split.wf</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="step-3-define-resampling-techniques-on-training-data">STEP 3: Define resampling techniques on training data</h2>
<p>Notice here that we do not have any repeats defined as we did originally. Previously we used an argument: repeats = 10 to specify the number of times to repeat the V-fold partitioning. Instead we are increasing the number of partitions/folds (v) from 10 to 20, for the cv-folds, just as the spatial clustering cv-folds.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>345</span><span class='op'>)</span>

<span class='co'># Re-sample technique(s) </span>
<span class='va'>boostrap.wf</span> <span class='op'>&lt;-</span> <span class='fu'>bootstraps</span><span class='op'>(</span><span class='va'>af.train.wf</span>, times <span class='op'>=</span> <span class='fl'>20</span>, strata <span class='op'>=</span> <span class='va'>logRR</span><span class='op'>)</span>
<span class='va'>cv.fold.wf</span> <span class='op'>&lt;-</span> <span class='fu'>vfold_cv</span><span class='op'>(</span><span class='va'>af.train.wf</span>, v <span class='op'>=</span> <span class='fl'>10</span>, repeats <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span>
<span class='va'>spatial.cv.fold.wf</span> <span class='op'>&lt;-</span> <span class='fu'>spatial_clustering_cv</span><span class='op'>(</span><span class='va'>af.train.wf</span>, coords <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Longitude"</span>, <span class='st'>"Latitude"</span><span class='op'>)</span>, v <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="step-4-define-model-metrics">STEP 4: Define model metrics</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Metrics</span>
<span class='va'>multi.metric.wf</span> <span class='op'>&lt;-</span> <span class='fu'>metric_set</span><span class='op'>(</span><span class='fu'>yardstick</span><span class='fu'>::</span><span class='va'><a href='https://rdrr.io/pkg/yardstick/man/rmse.html'>rmse</a></span>, <span class='fu'>yardstick</span><span class='fu'>::</span><span class='va'><a href='https://rdrr.io/pkg/yardstick/man/rsq.html'>rsq</a></span>, <span class='fu'>yardstick</span><span class='fu'>::</span><span class='va'><a href='https://rdrr.io/pkg/yardstick/man/ccc.html'>ccc</a></span>, <span class='fu'>yardstick</span><span class='fu'>::</span><span class='va'><a href='https://rdrr.io/pkg/yardstick/man/mae.html'>mae</a></span><span class='op'>)</span>

<span class='va'>model.control.wf</span> <span class='op'>&lt;-</span> <span class='fu'>control_stack_grid</span><span class='op'>(</span><span class='op'>)</span> <span class='co'># save_pred = TRUE, save_workflow = TRUE.</span>
<span class='va'>model.control.linear.wf</span> <span class='op'>&lt;-</span> <span class='fu'>control_resamples</span><span class='op'>(</span>save_pred <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="step-5-create-pre-processing-recipies">STEP 5: Create pre-processing recipies</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>base_recipe</span> <span class='op'>&lt;-</span> 
  <span class='fu'>recipe</span><span class='op'>(</span>formula <span class='op'>=</span> <span class='va'>logRR</span> <span class='op'>~</span> <span class='va'>.</span>, data <span class='op'>=</span> <span class='va'>af.train.wf</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>update_role</span><span class='op'>(</span><span class='va'>Site.Type</span>, new_role <span class='op'>=</span> <span class='st'>"predictor"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># alters an existing role in the recipe to variables.</span>
  <span class='fu'>update_role</span><span class='op'>(</span><span class='va'>PrName</span>, <span class='co'># or assigns an initial role to variables that do not yet have a declared role.</span>
              <span class='va'>Out.SubInd</span>,
              <span class='va'>Out.SubInd.Code</span>,
              <span class='va'>Product</span>,
              <span class='va'>Latitude</span>,
              <span class='va'>Longitude</span>,
              <span class='va'>Tree</span>,
              new_role <span class='op'>=</span> <span class='st'>"sample ID"</span><span class='op'>)</span> 
<span class='co'># ------------------------------------------------------------------------------------------------------------------------------------------------</span>
   

<span class='va'>impute_mean_recipe</span> <span class='op'>&lt;-</span> 
  <span class='va'>base_recipe</span> <span class='op'>%&gt;%</span>
  <span class='fu'>step_impute_mean</span><span class='op'>(</span><span class='fu'>all_numeric_predictors</span><span class='op'>(</span><span class='op'>)</span>, skip <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>step_novel</span><span class='op'>(</span><span class='va'>Site.Type</span>, skip <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>step_dummy</span><span class='op'>(</span><span class='va'>Site.Type</span>, one_hot <span class='op'>=</span> <span class='cn'>TRUE</span>, naming <span class='op'>=</span> <span class='fu'>partial</span><span class='op'>(</span><span class='va'>dummy_names</span>,sep <span class='op'>=</span> <span class='st'>"_"</span><span class='op'>)</span>, skip <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>step_zv</span><span class='op'>(</span><span class='fu'>all_predictors</span><span class='op'>(</span><span class='op'>)</span>, skip <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># remove any columns with a single unique value</span>
  <span class='fu'>step_nzv</span><span class='op'>(</span><span class='fu'>all_predictors</span><span class='op'>(</span><span class='op'>)</span>, skip <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
  

<span class='va'>impute_knn_recipe</span> <span class='op'>&lt;-</span> 
  <span class='va'>base_recipe</span> <span class='op'>%&gt;%</span>
  <span class='fu'>step_impute_knn</span><span class='op'>(</span><span class='fu'>all_numeric_predictors</span><span class='op'>(</span><span class='op'>)</span>, skip <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>step_novel</span><span class='op'>(</span><span class='va'>Site.Type</span>, skip <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>step_dummy</span><span class='op'>(</span><span class='va'>Site.Type</span>, one_hot <span class='op'>=</span> <span class='cn'>TRUE</span>, naming <span class='op'>=</span> <span class='fu'>partial</span><span class='op'>(</span><span class='va'>dummy_names</span>,sep <span class='op'>=</span> <span class='st'>"_"</span><span class='op'>)</span>, skip <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>step_zv</span><span class='op'>(</span><span class='fu'>all_predictors</span><span class='op'>(</span><span class='op'>)</span>, skip <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># remove any columns with a single unique value</span>
  <span class='fu'>step_nzv</span><span class='op'>(</span><span class='fu'>all_predictors</span><span class='op'>(</span><span class='op'>)</span>, skip <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> 
   

<span class='va'>normalize_recipe</span> <span class='op'>&lt;-</span> 
  <span class='va'>base_recipe</span> <span class='op'>%&gt;%</span>
  <span class='fu'>step_impute_linear</span><span class='op'>(</span><span class='fu'>all_numeric_predictors</span><span class='op'>(</span><span class='op'>)</span>, impute_with <span class='op'>=</span> <span class='fu'>imp_vars</span><span class='op'>(</span><span class='va'>Longitude</span>, <span class='va'>Latitude</span><span class='op'>)</span>, skip <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># create linear regression models to impute missing data.</span>
  <span class='fu'>step_novel</span><span class='op'>(</span><span class='va'>Site.Type</span>, skip <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>step_dummy</span><span class='op'>(</span><span class='va'>Site.Type</span>, one_hot <span class='op'>=</span> <span class='cn'>TRUE</span>, naming <span class='op'>=</span> <span class='fu'>partial</span><span class='op'>(</span><span class='va'>dummy_names</span>,sep <span class='op'>=</span> <span class='st'>"_"</span><span class='op'>)</span>, skip <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>step_zv</span><span class='op'>(</span><span class='fu'>all_predictors</span><span class='op'>(</span><span class='op'>)</span>, skip <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># remove any columns with a single unique value</span>
  <span class='fu'>step_nzv</span><span class='op'>(</span><span class='fu'>all_predictors</span><span class='op'>(</span><span class='op'>)</span>, skip <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>step_normalize</span><span class='op'>(</span><span class='fu'>all_numeric_predictors</span><span class='op'>(</span><span class='op'>)</span>, skip <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='co'># normalize numeric data: standard deviation of one and a mean of zero.</span>

<span class='va'>rm_corr_recipe</span> <span class='op'>&lt;-</span> 
  <span class='va'>base_recipe</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>step_impute_linear</span><span class='op'>(</span><span class='fu'>all_numeric_predictors</span><span class='op'>(</span><span class='op'>)</span>, impute_with <span class='op'>=</span> <span class='fu'>imp_vars</span><span class='op'>(</span><span class='va'>Longitude</span>, <span class='va'>Latitude</span><span class='op'>)</span>, skip <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># create linear regression models to impute missing data.</span>
  <span class='fu'>step_novel</span><span class='op'>(</span><span class='va'>Site.Type</span>, skip <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>step_dummy</span><span class='op'>(</span><span class='va'>Site.Type</span>, one_hot <span class='op'>=</span> <span class='cn'>TRUE</span>, naming <span class='op'>=</span> <span class='fu'>partial</span><span class='op'>(</span><span class='va'>dummy_names</span>,sep <span class='op'>=</span> <span class='st'>"_"</span><span class='op'>)</span>, skip <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>step_zv</span><span class='op'>(</span><span class='fu'>all_predictors</span><span class='op'>(</span><span class='op'>)</span>, skip <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># remove any columns with a single unique value</span>
  <span class='fu'>step_nzv</span><span class='op'>(</span><span class='fu'>all_predictors</span><span class='op'>(</span><span class='op'>)</span>, skip <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>step_corr</span><span class='op'>(</span><span class='fu'>all_numeric_predictors</span><span class='op'>(</span><span class='op'>)</span>, threshold <span class='op'>=</span> <span class='fl'>0.8</span>, method <span class='op'>=</span> <span class='st'>"pearson"</span>, skip <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>

<span class='va'>interact_recipe</span> <span class='op'>&lt;-</span> 
  <span class='va'>base_recipe</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>step_impute_linear</span><span class='op'>(</span><span class='fu'>all_numeric_predictors</span><span class='op'>(</span><span class='op'>)</span>, impute_with <span class='op'>=</span> <span class='fu'>imp_vars</span><span class='op'>(</span><span class='va'>Longitude</span>, <span class='va'>Latitude</span><span class='op'>)</span>, skip <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># create linear regression models to impute missing data.</span>
  <span class='fu'>step_novel</span><span class='op'>(</span><span class='va'>Site.Type</span>, skip <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>step_dummy</span><span class='op'>(</span><span class='va'>Site.Type</span>, one_hot <span class='op'>=</span> <span class='cn'>TRUE</span>, naming <span class='op'>=</span> <span class='fu'>partial</span><span class='op'>(</span><span class='va'>dummy_names</span>,sep <span class='op'>=</span> <span class='st'>"_"</span><span class='op'>)</span>, skip <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>step_zv</span><span class='op'>(</span><span class='fu'>all_predictors</span><span class='op'>(</span><span class='op'>)</span>, skip <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># remove any columns with a single unique value</span>
  <span class='fu'>step_nzv</span><span class='op'>(</span><span class='fu'>all_predictors</span><span class='op'>(</span><span class='op'>)</span>, skip <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>step_interact</span><span class='op'>(</span><span class='op'>~</span> <span class='fu'>all_numeric_predictors</span><span class='op'>(</span><span class='op'>)</span><span class='op'>:</span><span class='fu'>all_numeric_predictors</span><span class='op'>(</span><span class='op'>)</span>, skip <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p><strong>Note:</strong> To view how the recipe pre-process the data simply pipe it into a prep() function to prepare it, then a juice() function to extract it and then its a good idea to make use of the glimpse() function to easily see each variable.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>impute_knn_recipe</span> <span class='op'>%&gt;%</span> <span class='fu'>prep</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>juice</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>glimpse</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Rows: 3,615
Columns: 45
$ PrName                &lt;fct&gt; Agroforestry Pruning, Agroforestry Pru…
$ Out.SubInd            &lt;fct&gt; Biomass Yield, Biomass Yield, Biomass …
$ Product               &lt;fct&gt; Maize, Maize, Maize, Maize, Maize, Mai…
$ Tree                  &lt;fct&gt; Leucaena leucocephala, Gliricidia sepi…
$ Out.SubInd.Code       &lt;fct&gt; BiY, BiY, BiY, BiY, BiY, BiY, BiY, BiY…
$ Latitude              &lt;dbl&gt; 8.73400, -15.47300, -15.47300, -15.473…
$ Longitude             &lt;dbl&gt; 38.9860, 35.4502, 35.4502, 35.4502, 35…
$ Bio01_MT_Annu         &lt;dbl&gt; 22.19247, 22.12917, 22.12917, 22.12917…
$ Bio02_MDR             &lt;dbl&gt; 11.75548, 11.75417, 11.75417, 11.75417…
$ Bio03_Iso             &lt;dbl&gt; 83.89650, 83.66040, 83.66040, 83.66040…
$ Bio04_TS              &lt;dbl&gt; 62.03211, 62.61968, 62.61968, 62.61968…
$ Bio05_TWM             &lt;dbl&gt; 29.61383, 29.52500, 29.52500, 29.52500…
$ Bio06_MinTCM          &lt;dbl&gt; 15.60048, 15.47500, 15.47500, 15.47500…
$ Bio07_TAR             &lt;dbl&gt; 14.01334, 14.05000, 14.05000, 14.05000…
$ Bio08_MT_WetQ         &lt;dbl&gt; 22.49166, 22.44167, 22.44167, 22.44167…
$ Bio09_MT_DryQ         &lt;dbl&gt; 22.55358, 22.67500, 22.67500, 22.67500…
$ Bio10_MT_WarQ         &lt;dbl&gt; 22.96846, 22.90000, 22.90000, 22.90000…
$ Bio11_MT_ColQ         &lt;dbl&gt; 21.39976, 21.30833, 21.30833, 21.30833…
$ Bio12_Pecip_Annu      &lt;dbl&gt; 1525.327, 1629.000, 1629.000, 1629.000…
$ Bio13_Precip_WetM     &lt;dbl&gt; 238.0945, 248.7500, 248.7500, 248.7500…
$ Bio14_Precip_DryM     &lt;dbl&gt; 52.88835, 51.50000, 51.50000, 51.50000…
$ Bio15_Precip_S        &lt;dbl&gt; 42.46361, 41.85934, 41.85934, 41.85934…
$ Bio16_Precip_WetQ     &lt;dbl&gt; 584.07, 625.25, 625.25, 625.25, 625.25…
$ Bio17_Precip_DryQ     &lt;dbl&gt; 219.1557, 239.2500, 239.2500, 239.2500…
$ iSDA_Depth_to_bedrock &lt;dbl&gt; 199.37, 200.00, 200.00, 200.00, 200.00…
$ iSDA_SAND_conc        &lt;dbl&gt; 34.606, 58.164, 58.164, 58.164, 58.164…
$ iSDA_CLAY_conc        &lt;dbl&gt; 33.946, 21.706, 21.706, 21.706, 21.706…
$ iSDA_SILT_conc        &lt;dbl&gt; 27.684, 14.706, 14.706, 14.706, 14.706…
$ iSDA_FE_Bulk_dens     &lt;dbl&gt; 125.788, 137.686, 137.686, 137.686, 13…
$ iSDA_log_C_tot        &lt;dbl&gt; 30.250, 31.802, 31.802, 31.802, 31.802…
$ iSDA_log_Ca           &lt;dbl&gt; 78.846, 69.792, 69.792, 69.792, 69.792…
$ iSDA_log_eCEC         &lt;dbl&gt; 32.958, 23.772, 23.772, 23.772, 23.772…
$ iSDA_log_Fe           &lt;dbl&gt; 31.412, 37.594, 37.594, 37.594, 37.594…
$ iSDA_log_K            &lt;dbl&gt; 56.624, 46.930, 46.930, 46.930, 46.930…
$ iSDA_log_Mg           &lt;dbl&gt; 63.74, 56.42, 56.42, 56.42, 56.42, 56.…
$ iSDA_log_N            &lt;dbl&gt; 75.998, 50.764, 50.764, 50.764, 50.764…
$ iSDA_log_SOC          &lt;dbl&gt; 24.214, 18.410, 18.410, 18.410, 18.410…
$ iSDA_log_P            &lt;dbl&gt; 27.828, 24.036, 24.036, 24.036, 24.036…
$ iSDA_log_S            &lt;dbl&gt; 18.43, 13.60, 13.60, 13.60, 13.60, 13.…
$ iSDA_pH               &lt;dbl&gt; 68.080, 55.762, 55.762, 55.762, 55.762…
$ ASTER_Altitude        &lt;dbl&gt; 1954.44, 713.24, 713.24, 713.24, 713.2…
$ ASTER_Slope           &lt;dbl&gt; 5.75, 0.83, 0.83, 0.83, 0.83, 0.83, 0.…
$ logRR                 &lt;dbl&gt; -0.12386948, -0.10301172, -0.26980672,…
$ Site.Type_Farm        &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Site.Type_Station     &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…</code></pre>
</div>
<p>A recipe object is of the class “recipe” and can also be viewed using the summary() function. This will show the different feature types:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>impute_knn_recipe</span><span class='op'>)</span> 
</code></pre>
</div>
<pre><code># A tibble: 44 × 4
   variable        type    role      source  
   &lt;chr&gt;           &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;   
 1 PrName          nominal sample ID original
 2 Out.SubInd      nominal sample ID original
 3 Product         nominal sample ID original
 4 Site.Type       nominal predictor original
 5 Tree            nominal sample ID original
 6 Out.SubInd.Code nominal sample ID original
 7 Latitude        numeric sample ID original
 8 Longitude       numeric sample ID original
 9 Bio01_MT_Annu   numeric predictor original
10 Bio02_MDR       numeric predictor original
# … with 34 more rows</code></pre>
</div>
<h2 id="step-6-defining-model-specifications">STEP 6: Defining model specifications</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>lm_spec</span> <span class='op'>&lt;-</span> <span class='fu'>linear_reg</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_mode</span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_engine</span><span class='op'>(</span><span class='st'>"lm"</span><span class='op'>)</span> 

<span class='va'>glm_spec</span> <span class='op'>&lt;-</span> <span class='fu'>linear_reg</span><span class='op'>(</span>
  penalty <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span>,
  mixture <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>set_engine</span><span class='op'>(</span><span class='st'>"glmnet"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_mode</span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span>

<span class='va'>cart_spec</span> <span class='op'>&lt;-</span> 
   <span class='fu'>decision_tree</span><span class='op'>(</span>cost_complexity <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span>, 
                 min_n <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>set_engine</span><span class='op'>(</span><span class='st'>"rpart"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>set_mode</span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span>

<span class='va'>mars_spec</span> <span class='op'>&lt;-</span> 
   <span class='fu'>mars</span><span class='op'>(</span>prod_degree <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>  <span class='co'>#&lt;- use GCV to choose terms</span>
   <span class='fu'>set_engine</span><span class='op'>(</span><span class='st'>"earth"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>set_mode</span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span>

<span class='va'>knn_spec</span> <span class='op'>&lt;-</span> 
   <span class='fu'>nearest_neighbor</span><span class='op'>(</span>neighbors <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span>, 
                    weight_func <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>set_engine</span><span class='op'>(</span><span class='st'>"kknn"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>set_mode</span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span>

<span class='va'>svm_p_spec</span> <span class='op'>&lt;-</span> 
   <span class='fu'>svm_poly</span><span class='op'>(</span>cost <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span>, 
            degree <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>set_engine</span><span class='op'>(</span><span class='st'>"kernlab"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>set_mode</span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span>

<span class='va'>cubist_spec</span> <span class='op'>&lt;-</span> 
   <span class='fu'>cubist_rules</span><span class='op'>(</span>committees <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span>, 
                neighbors <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>set_engine</span><span class='op'>(</span><span class='st'>"Cubist"</span><span class='op'>)</span> 

<span class='va'>nnet_spec</span> <span class='op'>&lt;-</span> 
   <span class='fu'>mlp</span><span class='op'>(</span>hidden_units <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span>, 
       penalty <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span>, 
       epochs <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>set_engine</span><span class='op'>(</span><span class='st'>"nnet"</span>, MaxNWts <span class='op'>=</span> <span class='fl'>2600</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>set_mode</span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span>

<span class='va'>rf_spec</span> <span class='op'>&lt;-</span> 
   <span class='fu'>rand_forest</span><span class='op'>(</span>mtry <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span>, 
               min_n <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span>, 
               trees <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>set_engine</span><span class='op'>(</span><span class='st'>"ranger"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>set_mode</span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span>

<span class='va'>xgb_spec</span> <span class='op'>&lt;-</span> 
   <span class='fu'>boost_tree</span><span class='op'>(</span>tree_depth <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span>, 
              learn_rate <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span>, 
              loss_reduction <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span>, 
              min_n <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span>, 
              sample_size <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span>, 
              trees <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>set_engine</span><span class='op'>(</span><span class='st'>"xgboost"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>set_mode</span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="step-7-integrating-pre-processing-and-model-specification-into-a-workflowset">STEP 7: Integrating pre-processing and model specification into a workflowset</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>wflwset_setup</span> <span class='op'>&lt;-</span> 
   <span class='fu'>workflow_set</span><span class='op'>(</span>
      preproc <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>impute_mean <span class='op'>=</span> <span class='va'>impute_mean_recipe</span>,
                     impute_knn <span class='op'>=</span> <span class='va'>impute_knn_recipe</span>,
                     normalized <span class='op'>=</span> <span class='va'>normalize_recipe</span>,
                     rm_corr <span class='op'>=</span> <span class='va'>rm_corr_recipe</span>,
                     interaction <span class='op'>=</span> <span class='va'>interact_recipe</span><span class='op'>)</span>,
      models <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>lm <span class='op'>=</span> <span class='va'>lm_spec</span>,
                    glm <span class='op'>=</span> <span class='va'>glm_spec</span>, 
                    cart <span class='op'>=</span> <span class='va'>cart_spec</span>, 
                    mars <span class='op'>=</span> <span class='va'>mars_spec</span>,
                    knn <span class='op'>=</span> <span class='va'>knn_spec</span>,
                    svm_p <span class='op'>=</span> <span class='va'>svm_p_spec</span>,
                    cubist <span class='op'>=</span> <span class='va'>cubist_spec</span>,
                    nnet <span class='op'>=</span> <span class='va'>nnet_spec</span>,
                    RF <span class='op'>=</span> <span class='va'>rf_spec</span>,
                    XGB <span class='op'>=</span> <span class='va'>xgb_spec</span><span class='op'>)</span>,
      cross <span class='op'>=</span> <span class='cn'>TRUE</span>
   <span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span> <span class='va'>wflwset_setup</span>, file <span class='op'>=</span> <span class='fu'>here</span><span class='fu'>::</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"TidyModWflSet_OUTPUT"</span>, <span class='st'>"wflwset_setup.RDS"</span><span class='op'>)</span><span class='op'>)</span> 
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>wflwset_setup</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>readRDS</a></span><span class='op'>(</span><span class='fu'>here</span><span class='fu'>::</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"TidyModWflSet_OUTPUT"</span>, <span class='st'>"wflwset_setup.RDS"</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>wflwset_setup</span>
</code></pre>
</div>
</div>
<p>We see very clearly that a workflowset contains all possible combinations of model specifications and pre-processing steps. A powerful way to test several models on different forms of pre-processing specifications to scan and find the best setup.</p>
<h2 id="step-8-tuning-workflowsets-using-tune_grid-or-tune_race_anova">STEP 8: Tuning workflowsets using tune_grid() or tune_race_anova()</h2>
<p>There are different ways we can tune/fit our workflowsets. The more traditional one is using tune_grid() from the tune package, that is part of tidymodels. With tune_grid() we will compute a set of performance metrics (e.g. MAE or RMSE) for a pre-defined set of tuning parameters that correspond to a model or recipe across one or more resamples of the data. Hence all set combinations of (hyper)-parameters for the models are used to tune the models individually. This can sometimes cause really long and expensive model tuning.</p>
<p>A more effecient alternative to tune_grid() is the tune_race_anova() from the finetune package. Instead of tuning the individual models based on all possible combinations of (hyper)-parameters tune_race_anova() computes a set of performance metrics (e.g. MAE or RMSE) for a pre-defined set of tuning parameters that correspond to a model or recipe across one or more resamples of the data. After an initial number of resamples have been evaluated, the process eliminates tuning parameter combinations that are unlikely to be the best results using a repeated measure ANOVA model. This approach is significantly more efficient, as not all (hyper)-parameter combination will have to be used in the model tuning process, but only the ones that in a step-wise manner improve model performance.</p>
<h3 id="using-tune_grid">Using tune_grid()</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"> <span class='co'># Initializing parallel processing </span>
 <span class='fu'>doParallel</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/doParallel/man/registerDoParallel.html'>registerDoParallel</a></span><span class='op'>(</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>123</span><span class='op'>)</span>

<span class='va'>wflwset_setup_res</span> <span class='op'>&lt;-</span> 
   <span class='va'>wflwset_setup</span> <span class='op'>%&gt;%</span> 
   <span class='co'># The first argument is a function name from the {{tune}} package such as `tune_grid()`, `fit_resamples()`, etc.</span>
   <span class='fu'>workflow_map</span><span class='op'>(</span>fn        <span class='op'>=</span> <span class='st'>"tune_grid"</span>, 
                resamples <span class='op'>=</span> <span class='va'>cv.fold.wf</span>, 
                grid      <span class='op'>=</span> <span class='fl'>5</span>, 
                metrics   <span class='op'>=</span> <span class='va'>multi.metric.wf</span>, 
                verbose   <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='co'># Terminating parallel session</span>
<span class='fu'>parallelStop</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h3 id="using-tune_race_anova">Using tune_race_anova()</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>race_ctrl</span> <span class='op'>&lt;-</span>
   <span class='fu'>control_race</span><span class='op'>(</span>
      save_pred <span class='op'>=</span> <span class='cn'>TRUE</span>,
      parallel_over <span class='op'>=</span> <span class='st'>"everything"</span>,
      save_workflow <span class='op'>=</span> <span class='cn'>TRUE</span>
   <span class='op'>)</span>

 <span class='co'># Initializing parallel processing </span>
 <span class='fu'>doParallel</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/doParallel/man/registerDoParallel.html'>registerDoParallel</a></span><span class='op'>(</span><span class='op'>)</span>

<span class='va'>wflwset_setup_race_res</span> <span class='op'>&lt;-</span>
   <span class='va'>wflwset_setup</span> <span class='op'>%&gt;%</span>
   <span class='fu'>workflow_map</span><span class='op'>(</span>fn        <span class='op'>=</span> <span class='st'>"tune_race_anova"</span>, 
                seed      <span class='op'>=</span> <span class='fl'>1503</span>,
                resamples <span class='op'>=</span> <span class='va'>cv.fold.wf</span>, 
                metrics   <span class='op'>=</span> <span class='va'>multi.metric.wf</span>, 
                verbose   <span class='op'>=</span> <span class='cn'>TRUE</span>, 
                grid      <span class='op'>=</span> <span class='fl'>5</span>,
                control   <span class='op'>=</span> <span class='va'>race_ctrl</span>
   <span class='op'>)</span>

<span class='co'># Terminating parallel session</span>
<span class='fu'>parallelStop</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="step-9-assessing-results-of-the-tuned-workflowsets">STEP 9: Assessing results of the tuned workflowsets</h2>
<h3 id="from-tune_grid">From tune_grid()</h3>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># -------------------------------------------------------------------</span>
<span class='co'># LOAD THE TUNED (tune_race_anova) WORKFLOWSET DATA</span>

<span class='va'>wflwset_setup_race_res</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>readRDS</a></span><span class='op'>(</span><span class='fu'>here</span><span class='fu'>::</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"TidyModWflSet_OUTPUT"</span>, <span class='st'>"wflwset_setup_race_res.RDS"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>#Error: There were 1 workflows that had no results.</span>

<span class='co'># Removing the result that caused the error for not having a result</span>

<span class='va'>wflwset_setup_race_res_clean</span> <span class='op'>&lt;-</span> <span class='va'>wflwset_setup_race_res</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>wflow_id</span> <span class='op'>!=</span> <span class='st'>"interaction_nnet"</span><span class='op'>)</span> 
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-screen-inset shaded">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># -------------------------------------------------------------------</span>
<span class='fu'>autoplot</span><span class='op'>(</span><span class='va'>wflwset_setup_race_res_clean</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-10"></span>
<img src="TIDYMODELSWFS_files/figure-html5/unnamed-chunk-10-1.png" alt="Results of the tune race anova workflowset tuning" width="768" />
<p class="caption">
Figure 1: Results of the tune race anova workflowset tuning
</p>
</div>
</div>
<div class="layout-chunk" data-layout="l-screen-inset shaded">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>wflwset_setup_race_res_clean_no_linear</span> <span class='op'>&lt;-</span> <span class='va'>wflwset_setup_race_res_clean</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'>str_detect</span><span class='op'>(</span><span class='va'>wflow_id</span>, <span class='st'>"_lm"</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'>autoplot</span><span class='op'>(</span><span class='va'>wflwset_setup_race_res_clean_no_linear</span><span class='op'>)</span> 
</code></pre>
</div>
</details>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-11"></span>
<img src="TIDYMODELSWFS_files/figure-html5/unnamed-chunk-11-1.png" alt="Results of the tune race anova workflowset tuning after lm models have been excluded" width="768" />
<p class="caption">
Figure 2: Results of the tune race anova workflowset tuning after lm models have been excluded
</p>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>rank_results</span><span class='op'>(</span><span class='va'>wflwset_setup_race_res_clean_no_linear</span>, 
             rank_metric <span class='op'>=</span> <span class='st'>"rmse"</span>, 
             select_best <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>rank</span>, <span class='va'>mean</span>, <span class='va'>model</span>, <span class='va'>wflow_id</span>, <span class='va'>.config</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>arrange</span><span class='op'>(</span><span class='fu'>desc</span><span class='op'>(</span><span class='op'>-</span><span class='va'>rank</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code># A tibble: 176 × 5
    rank  mean model       wflow_id       .config             
   &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;          &lt;chr&gt;               
 1     1 0.539 rand_forest normalized_RF  Preprocessor1_Model5
 2     1 0.430 rand_forest normalized_RF  Preprocessor1_Model5
 3     1 0.588 rand_forest normalized_RF  Preprocessor1_Model5
 4     1 0.365 rand_forest normalized_RF  Preprocessor1_Model5
 5     2 0.539 rand_forest rm_corr_RF     Preprocessor1_Model5
 6     2 0.430 rand_forest rm_corr_RF     Preprocessor1_Model5
 7     2 0.588 rand_forest rm_corr_RF     Preprocessor1_Model5
 8     2 0.365 rand_forest rm_corr_RF     Preprocessor1_Model5
 9     3 0.537 rand_forest interaction_RF Preprocessor1_Model2
10     3 0.430 rand_forest interaction_RF Preprocessor1_Model2
# … with 166 more rows</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>rank_results</span><span class='op'>(</span><span class='va'>wflwset_setup_race_res_clean_no_linear</span>, 
             rank_metric <span class='op'>=</span> <span class='st'>"ccc"</span>, 
             select_best <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>rank</span>, <span class='va'>mean</span>, <span class='va'>model</span>, <span class='va'>wflow_id</span>, <span class='va'>.config</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>arrange</span><span class='op'>(</span><span class='fu'>desc</span><span class='op'>(</span><span class='op'>-</span><span class='va'>rank</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code># A tibble: 176 × 5
    rank  mean model         wflow_id        .config             
   &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;           &lt;chr&gt;               
 1     1 0.541 decision_tree normalized_cart Preprocessor1_Model2
 2     1 0.430 decision_tree normalized_cart Preprocessor1_Model2
 3     1 0.590 decision_tree normalized_cart Preprocessor1_Model2
 4     1 0.363 decision_tree normalized_cart Preprocessor1_Model2
 5     2 0.541 decision_tree rm_corr_cart    Preprocessor1_Model2
 6     2 0.430 decision_tree rm_corr_cart    Preprocessor1_Model2
 7     2 0.590 decision_tree rm_corr_cart    Preprocessor1_Model2
 8     2 0.362 decision_tree rm_corr_cart    Preprocessor1_Model2
 9     3 0.540 rand_forest   normalized_RF   Preprocessor1_Model4
10     3 0.430 rand_forest   normalized_RF   Preprocessor1_Model4
# … with 166 more rows</code></pre>
</div>
<h2 id="step-10-finalizing-models">STEP 10: Finalizing models</h2>
<p>Similar to what we wnet through in Part 3: Analysing with Tidymodels, we also have to finalize the models from the tuning results using the best performing (hyper)-parameter configurations. We are going to do this last fitting of the models using the training set. The first step is to pick a workflow to finalize. Since random fores models (RF), boosted tree models (XGB), decision tree models (cart) and generalized linier models (glm) worked well, we’ll extract the best configurations from the sets, update the parameters with the numerically best settings, and fit to the training set.</p>
<h3 id="extracting-best-performing-models-configurations">Extracting best performing models configurations</h3>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>rf_wf_best_rmse_results_of_race</span> <span class='op'>&lt;-</span> 
   <span class='va'>wflwset_setup_race_res_clean</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>extract_workflow_set_result</span><span class='op'>(</span><span class='st'>"normalized_RF"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>select_best</span><span class='op'>(</span>metric <span class='op'>=</span> <span class='st'>"rmse"</span><span class='op'>)</span>

<span class='va'>xgb_wf_best_rmse_results_of_race</span> <span class='op'>&lt;-</span> 
   <span class='va'>wflwset_setup_race_res_clean</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>extract_workflow_set_result</span><span class='op'>(</span><span class='st'>"interaction_XGB"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>select_best</span><span class='op'>(</span>metric <span class='op'>=</span> <span class='st'>"rmse"</span><span class='op'>)</span>

<span class='va'>cart_wf_best_rmse_results_of_race</span> <span class='op'>&lt;-</span> 
   <span class='va'>wflwset_setup_race_res_clean</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>extract_workflow_set_result</span><span class='op'>(</span><span class='st'>"rm_corr_cart"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>select_best</span><span class='op'>(</span>metric <span class='op'>=</span> <span class='st'>"rmse"</span><span class='op'>)</span>

<span class='va'>glm_wf_best_rmse_results_of_race</span> <span class='op'>&lt;-</span> 
   <span class='va'>wflwset_setup_race_res_clean</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>extract_workflow_set_result</span><span class='op'>(</span><span class='st'>"interaction_glm"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>select_best</span><span class='op'>(</span>metric <span class='op'>=</span> <span class='st'>"rmse"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<h3 id="performing-last-fitting-on-the-whole-dataset-traningset-testingset">Performing last fitting on the whole dataset (traningset + testingset)</h3>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>rf_best_race_last_fit</span> <span class='op'>&lt;-</span> 
   <span class='va'>wflwset_setup_race_res_clean</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>extract_workflow</span><span class='op'>(</span><span class='st'>"normalized_RF"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>finalize_workflow</span><span class='op'>(</span><span class='va'>rf_wf_best_rmse_results_of_race</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>last_fit</span><span class='op'>(</span>split <span class='op'>=</span> <span class='va'>af.split.wf</span><span class='op'>)</span>

<span class='va'>xgb_best_race_last_fit</span> <span class='op'>&lt;-</span> 
   <span class='va'>wflwset_setup_race_res_clean</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>extract_workflow</span><span class='op'>(</span><span class='st'>"interaction_XGB"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>finalize_workflow</span><span class='op'>(</span><span class='va'>xgb_wf_best_rmse_results_of_race</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>last_fit</span><span class='op'>(</span>split <span class='op'>=</span> <span class='va'>af.split.wf</span><span class='op'>)</span>

<span class='va'>cart_best_race_last_fit</span> <span class='op'>&lt;-</span> 
   <span class='va'>wflwset_setup_race_res_clean</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>extract_workflow</span><span class='op'>(</span><span class='st'>"rm_corr_cart"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>finalize_workflow</span><span class='op'>(</span><span class='va'>cart_wf_best_rmse_results_of_race</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>last_fit</span><span class='op'>(</span>split <span class='op'>=</span> <span class='va'>af.split.wf</span><span class='op'>)</span>

<span class='va'>glm_best_race_last_fit</span> <span class='op'>&lt;-</span> 
   <span class='va'>wflwset_setup_race_res_clean</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>extract_workflow</span><span class='op'>(</span><span class='st'>"interaction_glm"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>finalize_workflow</span><span class='op'>(</span><span class='va'>glm_wf_best_rmse_results_of_race</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>last_fit</span><span class='op'>(</span>split <span class='op'>=</span> <span class='va'>af.split.wf</span><span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>collect_metrics</span><span class='op'>(</span><span class='va'>rf_best_race_last_fit</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code># A tibble: 2 × 4
  .metric .estimator .estimate .config             
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
1 rmse    standard       0.600 Preprocessor1_Model1
2 rsq     standard       0.393 Preprocessor1_Model1</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>rf_wflowset_last_fit_plot</span> <span class='op'>&lt;-</span> 
  <span class='va'>rf_best_race_last_fit</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>collect_predictions</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>logRR</span>, y <span class='op'>=</span> <span class='va'>.pred</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>geom_abline</span><span class='op'>(</span>col <span class='op'>=</span> <span class='st'>"red"</span>, lty <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='co'>#geom_smooth(method = "gam", linetype = "dashed", col = "black", size = 1) +</span>
  <span class='fu'>geom_jitter</span><span class='op'>(</span>width <span class='op'>=</span> <span class='fl'>0.5</span>, height <span class='op'>=</span> <span class='fl'>0.2</span>, alpha <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>coord_obs_pred</span><span class='op'>(</span>ratio <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>labs</span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"Observed logRR"</span>, y <span class='op'>=</span> <span class='st'>"Predicted logRR"</span><span class='op'>)</span>

<span class='va'>rf_wflowset_last_fit_plot</span>
</code></pre>
</div>
</details>
<p><img src="TIDYMODELSWFS_files/figure-html5/unnamed-chunk-17-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>rf_best_race_last_fit</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>collect_predictions</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>arrange</span><span class='op'>(</span><span class='fu'>desc</span><span class='op'>(</span><span class='va'>.pred</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code># A tibble: 904 × 5
   id               .pred  .row logRR .config             
   &lt;chr&gt;            &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;               
 1 train/test split  2.08  1276 2.23  Preprocessor1_Model1
 2 train/test split  2.08  1284 2.27  Preprocessor1_Model1
 3 train/test split  2.08  1289 1.78  Preprocessor1_Model1
 4 train/test split  1.76   301 0.699 Preprocessor1_Model1
 5 train/test split  1.76   302 2.13  Preprocessor1_Model1
 6 train/test split  1.76   305 2.56  Preprocessor1_Model1
 7 train/test split  1.76   308 1.94  Preprocessor1_Model1
 8 train/test split  1.74  1638 2.08  Preprocessor1_Model1
 9 train/test split  1.74  1641 2.07  Preprocessor1_Model1
10 train/test split  1.74  1674 1.56  Preprocessor1_Model1
# … with 894 more rows</code></pre>
</div>
<h2 id="step-11-explaining-models-and-predictions">STEP 11: Explaining models and predictions</h2>
<p>We suggested that model performance, as measured by appropriate metrics (like RMSE for regression or area under the ROC curve for classification), can be important for all applications of modeling. Similarly, model explanations, answering why a model makes the predictions it does, can be important whether the purpose of your model is largely descriptive, to test a hypothesis, or to make a prediction. Answering the question “why?” allows modeling practitioners to understand which features were important in predictions and even how model predictions would change under different values for the features.</p>
<p>For some models, like linear regression, it is usually clear how to explain why the model makes the predictions it does. The structure of a linear model contains coefficients for each predictor that are typically straightforward to interpret. For other models, like random forests that can capture non-linear behavior by design, it is less transparent how to explain the model’s predictions from only the structure of the model itself. Instead, we can apply model explainer algorithms to generate understanding of predictions.</p>
<p><strong>Notes:</strong> There are two types of model explanations, global and local. Global model explanations provide an overall understanding aggregated over a whole set of observations; local model explanations provide information about a prediction for a single observation.</p>
<p>The tidymodels framework does not itself contain software for model explanations. Instead, models trained and evaluated with tidymodels can be explained with other, supplementary software in R packages such as lime, vip, and DALEX. We ourselves often choose:</p>
<p>vip functions when we want to use model-based methods that take advantage of model structure (and are often faster), and DALEX functions when we want to use model-agnostic methods that can be applied to any model.</p>
<p>Let’s build model-agnostic explainers for both of these models to find out why they make the predictions they do. We can use the DALEXtra add-on package for DALEX, which provides support for tidymodels. Biecek and Burzykowski (2021) provide a thorough exploration of how to use DALEX for model explanations; this chapter only summarizes some important approaches, specific to tidymodels. To compute any kind of model explanation, global or local, using DALEX, we first create an explainer for each model.</p>
<p>Creating trained workflows for each of the four models</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>rf_best_race_trained_wf</span> <span class='op'>&lt;-</span> 
   <span class='va'>wflwset_setup_race_res_clean</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>extract_workflow</span><span class='op'>(</span><span class='st'>"normalized_RF"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>finalize_workflow</span><span class='op'>(</span><span class='va'>rf_wf_best_rmse_results_of_race</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>fit</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>af.train.wf</span><span class='op'>)</span>

<span class='va'>xgb_best_race_trained_wf</span> <span class='op'>&lt;-</span> 
   <span class='va'>wflwset_setup_race_res_clean</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>extract_workflow</span><span class='op'>(</span><span class='st'>"interaction_XGB"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>finalize_workflow</span><span class='op'>(</span><span class='va'>xgb_wf_best_rmse_results_of_race</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>fit</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>af.train.wf</span><span class='op'>)</span>

<span class='va'>cart_best_race_trained_wf</span> <span class='op'>&lt;-</span> 
   <span class='va'>wflwset_setup_race_res_clean</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>extract_workflow</span><span class='op'>(</span><span class='st'>"rm_corr_cart"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>finalize_workflow</span><span class='op'>(</span><span class='va'>cart_wf_best_rmse_results_of_race</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>fit</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>af.train.wf</span><span class='op'>)</span>

<span class='va'>glm_best_race_trained_wf</span> <span class='op'>&lt;-</span> 
   <span class='va'>wflwset_setup_race_res_clean</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>extract_workflow</span><span class='op'>(</span><span class='st'>"interaction_glm"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>finalize_workflow</span><span class='op'>(</span><span class='va'>glm_wf_best_rmse_results_of_race</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>fit</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>af.train.wf</span><span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<p>Generating explainers for each of the four models</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>vip_features</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"PrName"</span>, <span class='st'>"Out.SubInd"</span>, <span class='st'>"Product"</span>, <span class='st'>"Tree"</span>, <span class='st'>"Out.SubInd.Code"</span>,<span class='st'>"Site.Type"</span>, <span class='st'>"Latitude"</span>, <span class='st'>"Longitude"</span>, 
                  <span class='st'>"Bio01_MT_Annu"</span>, <span class='st'>"Bio02_MDR"</span>, <span class='st'>"Bio03_Iso"</span>, <span class='st'>"Bio04_TS"</span>, <span class='st'>"Bio05_TWM"</span>, <span class='st'>"Bio06_MinTCM"</span>, <span class='st'>"Bio07_TAR"</span>, <span class='st'>"Bio08_MT_WetQ"</span>, <span class='st'>"Bio09_MT_DryQ"</span>, <span class='st'>"Bio10_MT_WarQ"</span>, <span class='st'>"Bio11_MT_ColQ"</span>,
                  <span class='st'>"Bio12_Pecip_Annu"</span>, <span class='st'>"Bio13_Precip_WetM"</span>, <span class='st'>"Bio14_Precip_DryM"</span>, <span class='st'>"Bio15_Precip_S"</span>, <span class='st'>"Bio16_Precip_WetQ"</span>, <span class='st'>"Bio17_Precip_DryQ"</span>, <span class='st'>"iSDA_Depth_to_bedrock"</span>, <span class='st'>"iSDA_SAND_conc"</span>,
                  <span class='st'>"iSDA_CLAY_conc"</span>, <span class='st'>"iSDA_SILT_conc"</span>, <span class='st'>"iSDA_log_C_tot"</span>, <span class='st'>"iSDA_FE_Bulk_dens"</span>, <span class='st'>"iSDA_log_Ca"</span>, <span class='st'>"iSDA_log_eCEC"</span>, <span class='st'>"iSDA_log_Fe"</span>, <span class='st'>"iSDA_log_K"</span>, <span class='st'>"iSDA_log_Mg"</span>, <span class='st'>"iSDA_log_N"</span>,
                  <span class='st'>"iSDA_log_SOC"</span>, <span class='st'>"iSDA_log_P"</span>, <span class='st'>"iSDA_log_S"</span>, <span class='st'>"iSDA_pH"</span>, <span class='st'>"ASTER_Altitude"</span>, <span class='st'>"ASTER_Slope"</span><span class='op'>)</span>

<span class='va'>vip_train</span> <span class='op'>&lt;-</span> 
  <span class='va'>af.train.wf</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='fu'>all_of</span><span class='op'>(</span><span class='va'>vip_features</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>explainer_rf</span> <span class='op'>&lt;-</span> 
  <span class='fu'>explain_tidymodels</span><span class='op'>(</span>
    <span class='va'>rf_best_race_trained_wf</span>, 
    data <span class='op'>=</span> <span class='va'>vip_train</span>, 
    y <span class='op'>=</span> <span class='va'>af.train.wf</span><span class='op'>$</span><span class='va'>logRR</span>,
    label <span class='op'>=</span> <span class='st'>"Random Forest with normalized data"</span>,
    verbose <span class='op'>=</span> <span class='cn'>FALSE</span>
  <span class='op'>)</span>

<span class='va'>explainer_xgb</span> <span class='op'>&lt;-</span> 
  <span class='fu'>explain_tidymodels</span><span class='op'>(</span>
    <span class='va'>xgb_best_race_trained_wf</span>, 
    data <span class='op'>=</span> <span class='va'>vip_train</span>, 
    y <span class='op'>=</span> <span class='va'>af.train.wf</span><span class='op'>$</span><span class='va'>logRR</span>,
    label <span class='op'>=</span> <span class='st'>"XGBoost with interactions"</span>,
    verbose <span class='op'>=</span> <span class='cn'>FALSE</span>
  <span class='op'>)</span>

<span class='va'>explainer_cart</span> <span class='op'>&lt;-</span> 
    <span class='fu'>explain_tidymodels</span><span class='op'>(</span>
    <span class='va'>cart_best_race_trained_wf</span>, 
    data <span class='op'>=</span> <span class='va'>vip_train</span>, 
    y <span class='op'>=</span> <span class='va'>af.train.wf</span><span class='op'>$</span><span class='va'>logRR</span>,
    label <span class='op'>=</span> <span class='st'>"Cart with removed correlations"</span>,
    verbose <span class='op'>=</span> <span class='cn'>FALSE</span>
  <span class='op'>)</span>

<span class='va'>explainer_glm</span> <span class='op'>&lt;-</span> 
  <span class='fu'>explain_tidymodels</span><span class='op'>(</span>
    <span class='va'>glm_best_race_trained_wf</span>, 
    data <span class='op'>=</span> <span class='va'>vip_train</span>, 
    y <span class='op'>=</span> <span class='va'>af.train.wf</span><span class='op'>$</span><span class='va'>logRR</span>,
    label <span class='op'>=</span> <span class='st'>"glm with interactions"</span>,
    verbose <span class='op'>=</span> <span class='cn'>FALSE</span>
  <span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<p>Local explanations</p>
<p>Observed low logRR</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>af.train.wf</span> <span class='op'>%&gt;%</span>
  <span class='fu'>relocate</span><span class='op'>(</span><span class='va'>logRR</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>arrange</span><span class='op'>(</span><span class='fu'>desc</span><span class='op'>(</span><span class='op'>-</span><span class='va'>logRR</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>PrName</span> <span class='op'>==</span> <span class='st'>"Agroforestry Pruning-Alleycropping"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code># A tibble: 725 × 44
   logRR PrName    Out.SubInd Product Site.Type Tree   Out.SubInd.Code
   &lt;dbl&gt; &lt;fct&gt;     &lt;fct&gt;      &lt;fct&gt;   &lt;fct&gt;     &lt;fct&gt;  &lt;fct&gt;          
 1 -2.15 Agrofore… Biomass Y… Maize   Station   Grevi… BiY            
 2 -1.81 Agrofore… Crop Yield Maize   Station   Senna… CrY            
 3 -1.80 Agrofore… Crop Yield Sorghum Farm      Leuca… CrY            
 4 -1.69 Agrofore… Crop Yield Maize   Station   Senna… CrY            
 5 -1.52 Agrofore… Crop Yield Maize   Station   Senna… CrY            
 6 -1.51 Agrofore… Crop Yield Common… Station   Maeso… CrY            
 7 -1.46 Agrofore… Biomass Y… Common… Station   Markh… BiY            
 8 -1.40 Agrofore… Crop Yield Maize   Station   Melia… CrY            
 9 -1.39 Agrofore… Crop Yield Sorghum Farm      Leuca… CrY            
10 -1.30 Agrofore… Crop Yield Sorghum Farm      Azadi… CrY            
# … with 715 more rows, and 37 more variables: Latitude &lt;dbl&gt;,
#   Longitude &lt;dbl&gt;, Bio01_MT_Annu &lt;dbl&gt;, Bio02_MDR &lt;dbl&gt;,
#   Bio03_Iso &lt;dbl&gt;, Bio04_TS &lt;dbl&gt;, Bio05_TWM &lt;dbl&gt;,
#   Bio06_MinTCM &lt;dbl&gt;, Bio07_TAR &lt;dbl&gt;, Bio08_MT_WetQ &lt;dbl&gt;,
#   Bio09_MT_DryQ &lt;dbl&gt;, Bio10_MT_WarQ &lt;dbl&gt;, Bio11_MT_ColQ &lt;dbl&gt;,
#   Bio12_Pecip_Annu &lt;dbl&gt;, Bio13_Precip_WetM &lt;dbl&gt;,
#   Bio14_Precip_DryM &lt;dbl&gt;, Bio15_Precip_S &lt;dbl&gt;, …</code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>vip_train_1</span> <span class='op'>&lt;-</span> <span class='va'>vip_train</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>PrName</span> <span class='op'>==</span> <span class='st'>"Agroforestry Pruning-Alleycropping"</span> <span class='op'>&amp;</span> 
                  <span class='va'>Out.SubInd</span> <span class='op'>==</span> <span class='st'>"Crop Yield"</span> <span class='op'>&amp;</span> 
                  <span class='va'>Product</span> <span class='op'>==</span> <span class='st'>"Maize"</span> <span class='op'>&amp;</span> 
                  <span class='va'>Tree</span> <span class='op'>==</span> <span class='st'>"Senna siamea"</span> <span class='op'>&amp;</span> 
                  <span class='va'>Site.Type</span> <span class='op'>==</span> <span class='st'>"Station"</span> <span class='op'>&amp;</span> 
                  <span class='va'>Latitude</span> <span class='op'>==</span> <span class='op'>-</span><span class='fl'>1.58240</span> <span class='op'>&amp;</span> 
                  <span class='va'>Longitude</span> <span class='op'>==</span> <span class='fl'>37.24320</span><span class='op'>)</span>

<span class='va'>obs_1</span> <span class='op'>&lt;-</span> <span class='va'>vip_train_1</span><span class='op'>[</span><span class='fl'>1</span>,<span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>ml.data.no.outliers.wf</span> <span class='op'>%&gt;%</span>
  <span class='fu'>rationalize</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>step_impute_mean</span><span class='op'>(</span><span class='fu'>all_numeric</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>relocate</span><span class='op'>(</span><span class='va'>logRR</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>Out.SubInd</span>, <span class='va'>Product</span>, <span class='va'>Site.Type</span>, <span class='va'>Tree</span>, <span class='va'>Out.SubInd.Code</span>, <span class='va'>Latitude</span>, <span class='va'>Latitude</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>PrName</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>summarise</span><span class='op'>(</span><span class='fu'>across</span><span class='op'>(</span><span class='fu'>everything</span><span class='op'>(</span><span class='op'>)</span>, <span class='va'>mean</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>PrName</span> <span class='op'>==</span> <span class='st'>"Agroforestry Fallow"</span> <span class='op'>|</span> 
                <span class='va'>PrName</span> <span class='op'>==</span> <span class='st'>"Agroforestry Pruning"</span><span class='op'>|</span> 
                <span class='va'>PrName</span> <span class='op'>==</span> <span class='st'>"Alleycropping"</span><span class='op'>|</span> 
                <span class='va'>PrName</span> <span class='op'>==</span> <span class='st'>"Parklands"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>arrange</span><span class='op'>(</span><span class='fu'>desc</span><span class='op'>(</span><span class='va'>logRR</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code># A tibble: 4 × 39
  PrName    logRR Longitude Bio01_MT_Annu Bio02_MDR Bio03_Iso Bio04_TS
  &lt;fct&gt;     &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 Agrofor…  0.649      9.19          18.1      11.3      56.2     326.
2 Agrofor…  0.406     19.6           NA        NA        NA        NA 
3 Parklan… -0.123      8.68          23.9      11.0      68.2     180.
4 Alleycr… -0.199     26.6           21.0      11.2      68.1     186.
# … with 32 more variables: Bio05_TWM &lt;dbl&gt;, Bio06_MinTCM &lt;dbl&gt;,
#   Bio07_TAR &lt;dbl&gt;, Bio08_MT_WetQ &lt;dbl&gt;, Bio09_MT_DryQ &lt;dbl&gt;,
#   Bio10_MT_WarQ &lt;dbl&gt;, Bio11_MT_ColQ &lt;dbl&gt;, Bio12_Pecip_Annu &lt;dbl&gt;,
#   Bio13_Precip_WetM &lt;dbl&gt;, Bio14_Precip_DryM &lt;dbl&gt;,
#   Bio15_Precip_S &lt;dbl&gt;, Bio16_Precip_WetQ &lt;dbl&gt;,
#   Bio17_Precip_DryQ &lt;dbl&gt;, iSDA_Depth_to_bedrock &lt;dbl&gt;,
#   iSDA_SAND_conc &lt;dbl&gt;, iSDA_CLAY_conc &lt;dbl&gt;, …</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>ml.data.no.outliers.wf</span> <span class='op'>%&gt;%</span>
  <span class='fu'>rationalize</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>step_impute_mean</span><span class='op'>(</span><span class='fu'>all_numeric</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>relocate</span><span class='op'>(</span><span class='va'>logRR</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>Out.SubInd</span>, <span class='va'>Product</span>, <span class='va'>Site.Type</span>, <span class='va'>Tree</span>, <span class='va'>Out.SubInd.Code</span>, <span class='va'>Latitude</span>, <span class='va'>Latitude</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>PrName</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
<span class='co'># summarise(across(everything(), mean)) %&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>PrName</span> <span class='op'>==</span> <span class='st'>"Agroforestry Fallow"</span> <span class='op'>|</span> 
                <span class='va'>PrName</span> <span class='op'>==</span> <span class='st'>"Agroforestry Pruning"</span><span class='op'>|</span> 
                <span class='va'>PrName</span> <span class='op'>==</span> <span class='st'>"Alleycropping"</span><span class='op'>|</span> 
                <span class='va'>PrName</span> <span class='op'>==</span> <span class='st'>"Parklands"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_boxplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/reorder.factor.html'>reorder</a></span><span class='op'>(</span><span class='va'>PrName</span>, <span class='va'>iSDA_SAND_conc</span><span class='op'>)</span>, y <span class='op'>=</span> <span class='va'>iSDA_SAND_conc</span>, col <span class='op'>=</span> <span class='va'>PrName</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_jitter</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/reorder.factor.html'>reorder</a></span><span class='op'>(</span><span class='va'>PrName</span>, <span class='va'>iSDA_SAND_conc</span><span class='op'>)</span>, y <span class='op'>=</span> <span class='va'>iSDA_SAND_conc</span>, col <span class='op'>=</span> <span class='va'>PrName</span><span class='op'>)</span>, height <span class='op'>=</span> <span class='fl'>0.4</span>, width <span class='op'>=</span> <span class='fl'>0.1</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_lucid</span><span class='op'>(</span>plot.title.size <span class='op'>=</span> <span class='fl'>25</span>,
              axis.text.size <span class='op'>=</span> <span class='fl'>15</span>,
              legend.title.size <span class='op'>=</span> <span class='fl'>20</span>,
              legend.text.size <span class='op'>=</span> <span class='fl'>20</span>,
              axis.title.size <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"none"</span>, axis.text.x <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>60</span>, hjust<span class='op'>=</span><span class='fl'>1</span><span class='op'>)</span>, plot.margin<span class='op'>=</span><span class='fu'>unit</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>6</span>,<span class='fl'>1</span>,<span class='fl'>6</span><span class='op'>)</span>,<span class='st'>"cm"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="TIDYMODELSWFS_files/figure-html5/unnamed-chunk-23-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>ml.data.no.outliers.wf</span> <span class='op'>%&gt;%</span>
  <span class='fu'>rationalize</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>drop_na</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>relocate</span><span class='op'>(</span><span class='va'>logRR</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>Out.SubInd</span>, <span class='va'>Product</span>, <span class='va'>Site.Type</span>, <span class='va'>Tree</span>, <span class='va'>Out.SubInd.Code</span>, <span class='va'>Latitude</span>, <span class='va'>Longitude</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>PrName</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
<span class='co'># summarise(across(everything(), mean)) %&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>PrName</span> <span class='op'>==</span> <span class='st'>"Agroforestry Fallow"</span> <span class='op'>|</span> 
                <span class='va'>PrName</span> <span class='op'>==</span> <span class='st'>"Agroforestry Pruning"</span><span class='op'>|</span> 
                <span class='va'>PrName</span> <span class='op'>==</span> <span class='st'>"Alleycropping"</span><span class='op'>|</span> 
                <span class='va'>PrName</span> <span class='op'>==</span> <span class='st'>"Parklands"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>PrName</span>, x <span class='op'>=</span> <span class='va'>iSDA_SAND_conc</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>stat_density_ridges</span><span class='op'>(</span>quantile_lines <span class='op'>=</span> <span class='cn'>TRUE</span>, quantiles <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.025</span>, <span class='fl'>0.50</span>, <span class='fl'>0.975</span><span class='op'>)</span>, col <span class='op'>=</span> <span class='st'>"orange"</span>, alpha <span class='op'>=</span> <span class='fl'>0.5</span>, size <span class='op'>=</span> <span class='fl'>0.2</span>, scale <span class='op'>=</span> <span class='fl'>2</span>,
                       jittered_points <span class='op'>=</span> <span class='cn'>TRUE</span>, position <span class='op'>=</span> <span class='fu'>position_points_jitter</span><span class='op'>(</span>width <span class='op'>=</span> <span class='fl'>5</span>, height <span class='op'>=</span> <span class='fl'>0.05</span><span class='op'>)</span>, point_shape <span class='op'>=</span> <span class='st'>'|'</span>, bandwidth <span class='op'>=</span> <span class='fl'>6</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_lucid</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>xlab</span><span class='op'>(</span><span class='st'>"Sand concentration %"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>ylab</span><span class='op'>(</span><span class='st'>""</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>ggtitle</span><span class='op'>(</span><span class='st'>"SAND concentration (%)"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="TIDYMODELSWFS_files/figure-html5/unnamed-chunk-24-1.png" width="624" /></p>
</div>
<p>Bio15_Precip_S</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>ml.data.no.outliers.wf</span> <span class='op'>%&gt;%</span>
  <span class='fu'>rationalize</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>drop_na</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>relocate</span><span class='op'>(</span><span class='va'>logRR</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>Out.SubInd</span>, <span class='va'>Product</span>, <span class='va'>Site.Type</span>, <span class='va'>Tree</span>, <span class='va'>Out.SubInd.Code</span>, <span class='va'>Latitude</span>, <span class='va'>Longitude</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>PrName</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
<span class='co'># summarise(across(everything(), mean)) %&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>PrName</span> <span class='op'>==</span> <span class='st'>"Agroforestry Fallow"</span> <span class='op'>|</span> 
                <span class='va'>PrName</span> <span class='op'>==</span> <span class='st'>"Agroforestry Pruning"</span><span class='op'>|</span> 
                <span class='va'>PrName</span> <span class='op'>==</span> <span class='st'>"Alleycropping"</span><span class='op'>|</span> 
                <span class='va'>PrName</span> <span class='op'>==</span> <span class='st'>"Parklands"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>PrName</span>, x <span class='op'>=</span> <span class='va'>Bio14_Precip_DryM</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>stat_density_ridges</span><span class='op'>(</span>quantile_lines <span class='op'>=</span> <span class='cn'>TRUE</span>, quantiles <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.025</span>, <span class='fl'>0.50</span>, <span class='fl'>0.975</span><span class='op'>)</span>, col <span class='op'>=</span> <span class='st'>"midnightblue"</span>, alpha <span class='op'>=</span> <span class='fl'>0.5</span>, size <span class='op'>=</span> <span class='fl'>0.2</span>, scale <span class='op'>=</span> <span class='fl'>2</span>,
                       jittered_points <span class='op'>=</span> <span class='cn'>TRUE</span>, position <span class='op'>=</span> <span class='fu'>position_points_jitter</span><span class='op'>(</span>width <span class='op'>=</span> <span class='fl'>50</span>, height <span class='op'>=</span> <span class='fl'>0.05</span><span class='op'>)</span>, point_shape <span class='op'>=</span> <span class='st'>'|'</span>, , bandwidth <span class='op'>=</span> <span class='fl'>3.75</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_lucid</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>xlab</span><span class='op'>(</span><span class='st'>"Precipitation (driest month)"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>ylab</span><span class='op'>(</span><span class='st'>""</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>ggtitle</span><span class='op'>(</span><span class='st'>"Precipitation (driest month) [mm]"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="TIDYMODELSWFS_files/figure-html5/unnamed-chunk-25-1.png" width="624" /></p>
</div>
<p>Bio02_MDR</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>ml.data.no.outliers.wf</span> <span class='op'>%&gt;%</span>
  <span class='fu'>rationalize</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>drop_na</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>relocate</span><span class='op'>(</span><span class='va'>logRR</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>Out.SubInd</span>, <span class='va'>Product</span>, <span class='va'>Site.Type</span>, <span class='va'>Tree</span>, <span class='va'>Out.SubInd.Code</span>, <span class='va'>Latitude</span>, <span class='va'>Longitude</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>PrName</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
<span class='co'># summarise(across(everything(), mean)) %&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>PrName</span> <span class='op'>==</span> <span class='st'>"Agroforestry Fallow"</span> <span class='op'>|</span> 
                <span class='va'>PrName</span> <span class='op'>==</span> <span class='st'>"Agroforestry Pruning"</span><span class='op'>|</span> 
                <span class='va'>PrName</span> <span class='op'>==</span> <span class='st'>"Alleycropping"</span><span class='op'>|</span> 
                <span class='va'>PrName</span> <span class='op'>==</span> <span class='st'>"Parklands"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>PrName</span>, x <span class='op'>=</span> <span class='va'>Bio05_TWM</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>stat_density_ridges</span><span class='op'>(</span>quantile_lines <span class='op'>=</span> <span class='cn'>TRUE</span>, quantiles <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.025</span>, <span class='fl'>0.50</span>, <span class='fl'>0.975</span><span class='op'>)</span>, col <span class='op'>=</span> <span class='st'>"darkgreen"</span>, alpha <span class='op'>=</span> <span class='fl'>0.5</span>, size <span class='op'>=</span> <span class='fl'>0.2</span>, scale <span class='op'>=</span> <span class='fl'>2</span>,
                       jittered_points <span class='op'>=</span> <span class='cn'>TRUE</span>, position <span class='op'>=</span> <span class='fu'>position_points_jitter</span><span class='op'>(</span>width <span class='op'>=</span> <span class='fl'>50</span>, height <span class='op'>=</span> <span class='fl'>0.05</span><span class='op'>)</span>, point_shape <span class='op'>=</span> <span class='st'>'|'</span>, bandwidth <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_lucid</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>xlab</span><span class='op'>(</span><span class='st'>"Temperature (max temperature of warmest month)"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>ylab</span><span class='op'>(</span><span class='st'>""</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>ggtitle</span><span class='op'>(</span><span class='st'>"Temperature (max temperature of warmest month) [°C]"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="TIDYMODELSWFS_files/figure-html5/unnamed-chunk-26-1.png" width="624" /></p>
</div>
<p>Local model explanations provide information about a prediction for a single observation. For example, let’s consider an observation of Agroforestry Pruning-Alleycropping for the outcome Maize Crop Yield conducted at a Station with the agroforestry tree being Melia azedarach. This observation has:</p>
<ul>
<li><p>logRR = -1.812378756</p></li>
<li><p>Latitude = 0.46667<br />
</p></li>
<li><p>Longitude = 33.45000<br />
</p></li>
<li><p>Bio01_MT_Annu = 24.22083<br />
</p></li>
<li><p>Bio02_MDR = 10.708333</p></li>
<li><p>Bio03_Iso = 60.58500<br />
</p></li>
<li><p>Bio04_TS = 128.08553<br />
</p></li>
<li><p>Bio05_TWM = 33.30000 &lt;- change these values</p></li>
<li><p>Bio06_MinTCM = 15.625000<br />
</p></li>
<li><p>Bio07_TAR = 17.674999</p></li>
<li><p>Bio08_MT_WetQ = 22.962501</p></li>
<li><p>Bio09_MT_DryQ = 24.53333</p></li>
<li><p>Bio10_MT_WarQ = 26.00833</p></li>
<li><p>Bio11_MT_ColQ = 22.962501</p></li>
<li><p>Bio12_Pecip_Annu = 1790.25000</p></li>
<li><p>Bio13_Precip_WetM = 310.750000</p></li>
<li><p>Bio14_Precip_DryM = 5.0000000</p></li>
<li><p>Bio15_Precip_S = 78.79493</p></li>
<li><p>Bio16_Precip_WetQ = 884.50000</p></li>
<li><p>Bio17_Precip_DryQ = 25.00000000</p></li>
<li><p>iSDA_Depth_to_bedrock = 200.00</p></li>
<li><p>iSDA_SAND_conc = 34.890</p></li>
<li><p>iSDA_CLAY_conc = 42.212</p></li>
<li><p>iSDA_SILT_conc = 24.680</p></li>
<li><p>iSDA_FE_Bulk_dens = 139.494</p></li>
<li><p>iSDA_log_C_tot = 29.362</p></li>
<li><p>iSDA_log_Ca = 68.194</p></li>
<li><p>iSDA_log_eCEC = 24.928</p></li>
<li><p>iSDA_log_Fe = 44.742</p></li>
<li><p>iSDA_log_K = 43.894</p></li>
<li><p>iSDA_log_Mg = 50.79</p></li>
<li><p>iSDA_log_N = 63.370</p></li>
<li><p>iSDA_log_SOC = 23.020</p></li>
<li><p>iSDA_log_P = 19.512</p></li>
<li><p>iSDA_log_S = 22.45</p></li>
<li><p>iSDA_pH = 56.886</p></li>
<li><p>ASTER_Altitude = 1184.43</p></li>
<li><p>ASTER_Slope = 2.79</p></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>rf_breakdown</span> <span class='op'>&lt;-</span> <span class='fu'>predict_parts</span><span class='op'>(</span>explainer <span class='op'>=</span> <span class='va'>explainer_rf</span>, new_observation <span class='op'>=</span> <span class='va'>obs_1</span><span class='op'>)</span>
<span class='va'>rf_breakdown</span> <span class='op'>%&gt;%</span> <span class='fu'>arrange</span><span class='op'>(</span><span class='fu'>desc</span><span class='op'>(</span><span class='op'>-</span><span class='va'>contribution</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>                                                                      contribution
Random Forest with normalized data: prediction                              -0.330
Random Forest with normalized data: iSDA_SILT_conc = 16.748                 -0.183
Random Forest with normalized data: iSDA_log_K = 53.296                     -0.088
Random Forest with normalized data: Bio14_Precip_DryM = 42                  -0.080
Random Forest with normalized data: iSDA_log_Ca = 67.774                    -0.074
Random Forest with normalized data: iSDA_SAND_conc = 48.582                 -0.053
Random Forest with normalized data: Bio16_Precip_WetQ = 585                 -0.049
Random Forest with normalized data: iSDA_CLAY_conc = 33.402                 -0.047
Random Forest with normalized data: Bio05_TWM = 27.5                        -0.033
Random Forest with normalized data: Bio13_Precip_WetM = 227                 -0.023
Random Forest with normalized data: iSDA_pH = 59.784                        -0.022
Random Forest with normalized data: Bio08_MT_WetQ = 21.7999992370605        -0.018
Random Forest with normalized data: iSDA_Depth_to_bedrock = 199.99          -0.014
Random Forest with normalized data: Bio12_Pecip_Annu = 1316                 -0.013
Random Forest with normalized data: Bio01_MT_Annu = 21.6166667938232        -0.012
Random Forest with normalized data: iSDA_log_C_tot = 27.514                 -0.008
Random Forest with normalized data: Bio10_MT_WarQ = 22.283332824707         -0.008
Random Forest with normalized data: Bio02_MDR = 9.71666717529297            -0.007
Random Forest with normalized data: Bio15_Precip_S = 53.0450210571289       -0.007
Random Forest with normalized data: Bio06_MinTCM = 15.8000001907349         -0.006
Random Forest with normalized data: Bio17_Precip_DryQ = 168                 -0.005
Random Forest with normalized data: iSDA_log_eCEC = 27.786                  -0.002
Random Forest with normalized data: iSDA_log_N = 60.844                     -0.001
Random Forest with normalized data: Bio03_Iso = 83.0484390258789            -0.001
Random Forest with normalized data: Bio09_MT_DryQ = 20.9166660308838        -0.001
Random Forest with normalized data: Latitude = -1.5824                       0.000
Random Forest with normalized data: PrName = 5                               0.000
Random Forest with normalized data: Out.SubInd = 4                           0.000
Random Forest with normalized data: Product = 2                              0.000
Random Forest with normalized data: Tree = 30                                0.000
Random Forest with normalized data: Out.SubInd.Code = 4                      0.000
Random Forest with normalized data: Longitude = 37.2432                      0.000
Random Forest with normalized data: ASTER_Slope = 4.2                        0.000
Random Forest with normalized data: Bio11_MT_ColQ = 20.9166660308838         0.001
Random Forest with normalized data: iSDA_log_S = 17.79                       0.001
Random Forest with normalized data: iSDA_log_Fe = 35.182                     0.001
Random Forest with normalized data: iSDA_log_SOC = 22.29                     0.001
Random Forest with normalized data: Site.Type = 2                            0.004
Random Forest with normalized data: iSDA_log_Mg = 55.09                      0.004
Random Forest with normalized data: iSDA_log_P = 24.798                      0.004
Random Forest with normalized data: Bio07_TAR = 11.6999998092651             0.006
Random Forest with normalized data: iSDA_FE_Bulk_dens = 132.154              0.008
Random Forest with normalized data: ASTER_Altitude = 1578.35                 0.028
Random Forest with normalized data: Bio04_TS = 52.8863792419434              0.028
Random Forest with normalized data: intercept                                0.335</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>xgb_breakdown</span> <span class='op'>&lt;-</span> <span class='fu'>predict_parts</span><span class='op'>(</span>explainer <span class='op'>=</span> <span class='va'>explainer_xgb</span>, new_observation <span class='op'>=</span> <span class='va'>obs_1</span><span class='op'>)</span>
<span class='va'>xgb_breakdown</span> <span class='op'>%&gt;%</span> <span class='fu'>arrange</span><span class='op'>(</span><span class='fu'>desc</span><span class='op'>(</span><span class='op'>-</span><span class='va'>contribution</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>                                                             contribution
XGBoost with interactions: prediction                              -0.311
XGBoost with interactions: iSDA_SAND_conc = 48.582                 -0.130
XGBoost with interactions: iSDA_SILT_conc = 16.748                 -0.115
XGBoost with interactions: iSDA_CLAY_conc = 33.402                 -0.106
XGBoost with interactions: iSDA_log_C_tot = 27.514                 -0.099
XGBoost with interactions: iSDA_log_SOC = 22.29                    -0.077
XGBoost with interactions: iSDA_log_eCEC = 27.786                  -0.052
XGBoost with interactions: iSDA_log_Ca = 67.774                    -0.046
XGBoost with interactions: Bio12_Pecip_Annu = 1316                 -0.044
XGBoost with interactions: iSDA_log_K = 53.296                     -0.033
XGBoost with interactions: Bio16_Precip_WetQ = 585                 -0.030
XGBoost with interactions: iSDA_log_S = 17.79                      -0.024
XGBoost with interactions: iSDA_FE_Bulk_dens = 132.154             -0.020
XGBoost with interactions: iSDA_log_N = 60.844                     -0.019
XGBoost with interactions: Bio04_TS = 52.8863792419434             -0.017
XGBoost with interactions: iSDA_log_Fe = 35.182                    -0.013
XGBoost with interactions: Bio15_Precip_S = 53.0450210571289       -0.012
XGBoost with interactions: Bio07_TAR = 11.6999998092651            -0.010
XGBoost with interactions: Bio01_MT_Annu = 21.6166667938232        -0.009
XGBoost with interactions: iSDA_pH = 59.784                        -0.009
XGBoost with interactions: Bio02_MDR = 9.71666717529297            -0.008
XGBoost with interactions: iSDA_Depth_to_bedrock = 199.99          -0.007
XGBoost with interactions: Bio14_Precip_DryM = 42                  -0.007
XGBoost with interactions: Bio06_MinTCM = 15.8000001907349         -0.005
XGBoost with interactions: Bio17_Precip_DryQ = 168                 -0.003
XGBoost with interactions: Bio10_MT_WarQ = 22.283332824707         -0.002
XGBoost with interactions: Latitude = -1.5824                       0.000
XGBoost with interactions: Bio09_MT_DryQ = 20.9166660308838         0.000
XGBoost with interactions: Site.Type = 2                            0.000
XGBoost with interactions: PrName = 5                               0.000
XGBoost with interactions: Out.SubInd = 4                           0.000
XGBoost with interactions: Product = 2                              0.000
XGBoost with interactions: Tree = 30                                0.000
XGBoost with interactions: Out.SubInd.Code = 4                      0.000
XGBoost with interactions: Longitude = 37.2432                      0.000
XGBoost with interactions: Bio11_MT_ColQ = 20.9166660308838         0.001
XGBoost with interactions: Bio05_TWM = 27.5                         0.003
XGBoost with interactions: Bio13_Precip_WetM = 227                  0.004
XGBoost with interactions: iSDA_log_Mg = 55.09                      0.007
XGBoost with interactions: iSDA_log_P = 24.798                      0.014
XGBoost with interactions: Bio03_Iso = 83.0484390258789             0.017
XGBoost with interactions: Bio08_MT_WetQ = 21.7999992370605         0.023
XGBoost with interactions: ASTER_Slope = 4.2                        0.032
XGBoost with interactions: ASTER_Altitude = 1578.35                 0.146
XGBoost with interactions: intercept                                0.338</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cart_breakdown</span> <span class='op'>&lt;-</span> <span class='fu'>predict_parts</span><span class='op'>(</span>explainer <span class='op'>=</span> <span class='va'>explainer_cart</span>, new_observation <span class='op'>=</span> <span class='va'>obs_1</span><span class='op'>)</span>
<span class='va'>cart_breakdown</span> <span class='op'>%&gt;%</span> <span class='fu'>arrange</span><span class='op'>(</span><span class='fu'>desc</span><span class='op'>(</span><span class='op'>-</span><span class='va'>contribution</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>                                                                  contribution
Cart with removed correlations: iSDA_SILT_conc = 16.748                 -0.761
Cart with removed correlations: prediction                              -0.331
Cart with removed correlations: iSDA_pH = 59.784                        -0.188
Cart with removed correlations: Bio16_Precip_WetQ = 585                 -0.121
Cart with removed correlations: Bio15_Precip_S = 53.0450210571289       -0.053
Cart with removed correlations: iSDA_CLAY_conc = 33.402                 -0.025
Cart with removed correlations: iSDA_log_N = 60.844                     -0.012
Cart with removed correlations: Bio14_Precip_DryM = 42                  -0.006
Cart with removed correlations: ASTER_Slope = 4.2                        0.000
Cart with removed correlations: iSDA_log_S = 17.79                       0.000
Cart with removed correlations: iSDA_log_C_tot = 27.514                  0.000
Cart with removed correlations: iSDA_log_P = 24.798                      0.000
Cart with removed correlations: Bio05_TWM = 27.5                         0.000
Cart with removed correlations: Latitude = -1.5824                       0.000
Cart with removed correlations: Site.Type = 2                            0.000
Cart with removed correlations: iSDA_log_Ca = 67.774                     0.000
Cart with removed correlations: Bio09_MT_DryQ = 20.9166660308838         0.000
Cart with removed correlations: Longitude = 37.2432                      0.000
Cart with removed correlations: iSDA_log_Fe = 35.182                     0.000
Cart with removed correlations: Bio08_MT_WetQ = 21.7999992370605         0.000
Cart with removed correlations: PrName = 5                               0.000
Cart with removed correlations: Out.SubInd = 4                           0.000
Cart with removed correlations: Product = 2                              0.000
Cart with removed correlations: Tree = 30                                0.000
Cart with removed correlations: Out.SubInd.Code = 4                      0.000
Cart with removed correlations: Bio01_MT_Annu = 21.6166667938232         0.000
Cart with removed correlations: Bio03_Iso = 83.0484390258789             0.000
Cart with removed correlations: Bio06_MinTCM = 15.8000001907349          0.000
Cart with removed correlations: Bio07_TAR = 11.6999998092651             0.000
Cart with removed correlations: Bio10_MT_WarQ = 22.283332824707          0.000
Cart with removed correlations: Bio11_MT_ColQ = 20.9166660308838         0.000
Cart with removed correlations: Bio12_Pecip_Annu = 1316                  0.000
Cart with removed correlations: Bio13_Precip_WetM = 227                  0.000
Cart with removed correlations: Bio17_Precip_DryQ = 168                  0.000
Cart with removed correlations: iSDA_Depth_to_bedrock = 199.99           0.000
Cart with removed correlations: iSDA_SAND_conc = 48.582                  0.000
Cart with removed correlations: iSDA_FE_Bulk_dens = 132.154              0.000
Cart with removed correlations: iSDA_log_eCEC = 27.786                   0.000
Cart with removed correlations: iSDA_log_Mg = 55.09                      0.000
Cart with removed correlations: iSDA_log_SOC = 22.29                     0.000
Cart with removed correlations: ASTER_Altitude = 1578.35                 0.001
Cart with removed correlations: Bio02_MDR = 9.71666717529297             0.006
Cart with removed correlations: iSDA_log_K = 53.296                      0.089
Cart with removed correlations: intercept                                0.335
Cart with removed correlations: Bio04_TS = 52.8863792419434              0.404</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>glm_breakdown</span> <span class='op'>&lt;-</span> <span class='fu'>predict_parts</span><span class='op'>(</span>explainer <span class='op'>=</span> <span class='va'>explainer_glm</span>, new_observation <span class='op'>=</span> <span class='va'>obs_1</span><span class='op'>)</span>
<span class='va'>glm_breakdown</span>
</code></pre>
</div>
</details>
<pre><code>                                                         contribution
glm with interactions: intercept                                0.335
glm with interactions: Bio17_Precip_DryQ = 168                  1.185
glm with interactions: Bio07_TAR = 11.6999998092651            -0.907
glm with interactions: Bio03_Iso = 83.0484390258789             0.569
glm with interactions: ASTER_Altitude = 1578.35                 0.604
glm with interactions: iSDA_log_SOC = 22.29                    -0.535
glm with interactions: iSDA_log_Ca = 67.774                     0.436
glm with interactions: Bio14_Precip_DryM = 42                  -0.371
glm with interactions: Bio16_Precip_WetQ = 585                 -0.257
glm with interactions: Bio02_MDR = 9.71666717529297             0.331
glm with interactions: Bio15_Precip_S = 53.0450210571289       -0.289
glm with interactions: Bio04_TS = 52.8863792419434             -0.665
glm with interactions: Bio11_MT_ColQ = 20.9166660308838         0.303
glm with interactions: Bio05_TWM = 27.5                        -0.172
glm with interactions: Bio13_Precip_WetM = 227                 -0.109
glm with interactions: Bio06_MinTCM = 15.8000001907349          0.039
glm with interactions: iSDA_SAND_conc = 48.582                 -0.192
glm with interactions: Bio08_MT_WetQ = 21.7999992370605        -0.047
glm with interactions: iSDA_CLAY_conc = 33.402                  0.031
glm with interactions: Bio10_MT_WarQ = 22.283332824707          0.072
glm with interactions: iSDA_log_eCEC = 27.786                  -0.098
glm with interactions: iSDA_log_K = 53.296                     -0.259
glm with interactions: iSDA_log_P = 24.798                     -0.268
glm with interactions: iSDA_pH = 59.784                        -0.079
glm with interactions: iSDA_log_Mg = 55.09                     -0.118
glm with interactions: ASTER_Slope = 4.2                        0.082
glm with interactions: Bio01_MT_Annu = 21.6166667938232         0.059
glm with interactions: iSDA_log_C_tot = 27.514                 -0.025
glm with interactions: iSDA_SILT_conc = 16.748                  0.024
glm with interactions: Bio09_MT_DryQ = 20.9166660308838         0.051
glm with interactions: iSDA_FE_Bulk_dens = 132.154              0.010
glm with interactions: iSDA_log_S = 17.79                      -0.010
glm with interactions: iSDA_log_N = 60.844                      0.135
glm with interactions: Bio12_Pecip_Annu = 1316                  0.048
glm with interactions: Site.Type = 2                           -0.194
glm with interactions: iSDA_Depth_to_bedrock = 199.99          -0.012
glm with interactions: Longitude = 37.2432                      0.000
glm with interactions: iSDA_log_Fe = 35.182                    -0.036
glm with interactions: Latitude = -1.5824                       0.000
glm with interactions: PrName = 5                               0.000
glm with interactions: Out.SubInd = 4                           0.000
glm with interactions: Product = 2                              0.000
glm with interactions: Tree = 30                                0.000
glm with interactions: Out.SubInd.Code = 4                      0.000
glm with interactions: prediction                              -0.329</code></pre>
</div>
<p>Model break-down explanations like these depend on the order of the features.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>predict_parts_rf</span> <span class='op'>&lt;-</span> <span class='fu'>predict_parts</span><span class='op'>(</span>explainer <span class='op'>=</span> <span class='va'>explainer_rf</span>, 
                                  new_observation <span class='op'>=</span> <span class='va'>obs_1</span>,
                                  order <span class='op'>=</span> <span class='va'>rf_breakdown</span><span class='op'>$</span><span class='va'>variable_name</span><span class='op'>)</span>

<span class='va'>predict_parts_rf</span>
</code></pre>
</div>
</details>
<pre><code>                                                                      contribution
Random Forest with normalized data: intercept                                0.335
Random Forest with normalized data: iSDA_SILT_conc = 16.748                 -0.183
Random Forest with normalized data: ASTER_Altitude = 1578.35                 0.028
Random Forest with normalized data: Bio04_TS = 52.8863792419434              0.028
Random Forest with normalized data: iSDA_SAND_conc = 48.582                 -0.053
Random Forest with normalized data: iSDA_log_K = 53.296                     -0.088
Random Forest with normalized data: iSDA_log_eCEC = 27.786                  -0.002
Random Forest with normalized data: ASTER_Slope = 4.2                        0.000
Random Forest with normalized data: iSDA_FE_Bulk_dens = 132.154              0.008
Random Forest with normalized data: iSDA_pH = 59.784                        -0.022
Random Forest with normalized data: Bio14_Precip_DryM = 42                  -0.080
Random Forest with normalized data: iSDA_CLAY_conc = 33.402                 -0.047
Random Forest with normalized data: Bio16_Precip_WetQ = 585                 -0.049
Random Forest with normalized data: iSDA_log_P = 24.798                      0.004
Random Forest with normalized data: iSDA_log_Ca = 67.774                    -0.074
Random Forest with normalized data: Bio15_Precip_S = 53.0450210571289       -0.007
Random Forest with normalized data: iSDA_log_SOC = 22.29                     0.001
Random Forest with normalized data: Bio10_MT_WarQ = 22.283332824707         -0.008
Random Forest with normalized data: iSDA_Depth_to_bedrock = 199.99          -0.014
Random Forest with normalized data: Bio07_TAR = 11.6999998092651             0.006
Random Forest with normalized data: Bio17_Precip_DryQ = 168                 -0.005
Random Forest with normalized data: Site.Type = 2                            0.004
Random Forest with normalized data: Bio09_MT_DryQ = 20.9166660308838        -0.001
Random Forest with normalized data: iSDA_log_Mg = 55.09                      0.004
Random Forest with normalized data: Bio11_MT_ColQ = 20.9166660308838         0.001
Random Forest with normalized data: Bio05_TWM = 27.5                        -0.033
Random Forest with normalized data: Latitude = -1.5824                       0.000
Random Forest with normalized data: Bio02_MDR = 9.71666717529297            -0.007
Random Forest with normalized data: Bio12_Pecip_Annu = 1316                 -0.013
Random Forest with normalized data: Longitude = 37.2432                      0.000
Random Forest with normalized data: iSDA_log_S = 17.79                       0.001
Random Forest with normalized data: Bio03_Iso = 83.0484390258789            -0.001
Random Forest with normalized data: Bio06_MinTCM = 15.8000001907349         -0.006
Random Forest with normalized data: Bio13_Precip_WetM = 227                 -0.023
Random Forest with normalized data: iSDA_log_N = 60.844                     -0.001
Random Forest with normalized data: iSDA_log_Fe = 35.182                     0.001
Random Forest with normalized data: iSDA_log_C_tot = 27.514                 -0.008
Random Forest with normalized data: Bio01_MT_Annu = 21.6166667938232        -0.012
Random Forest with normalized data: Bio08_MT_WetQ = 21.7999992370605        -0.018
Random Forest with normalized data: PrName = 5                               0.000
Random Forest with normalized data: Out.SubInd = 4                           0.000
Random Forest with normalized data: Product = 2                              0.000
Random Forest with normalized data: Tree = 30                                0.000
Random Forest with normalized data: Out.SubInd.Code = 4                      0.000
Random Forest with normalized data: prediction                              -0.330</code></pre>
</div>
<p>We can use the fact that these break-down explanations change based on order to compute the most important features over all (or many) possible orderings. This is the idea behind Shapley Additive Explanations (Lundberg and Lee 2017), where the average contributions of features are computed under different combinations or “coalitions” of feature orderings. Let’s compute SHAP attributions for our duplex, using B = 20 random orderings. (<a href="https://ema.drwhy.ai/breakDown.html" class="uri">https://ema.drwhy.ai/breakDown.html</a>).</p>
<p>We could use the default plot method from DALEX by calling plot(shap_obs_1), or we can access the underlying data and create a custom plot.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>shap_obs_1_rf</span> <span class='op'>&lt;-</span> <span class='fu'>predict_parts</span><span class='op'>(</span>explainer <span class='op'>=</span> <span class='va'>explainer_rf</span>, 
                               new_observation <span class='op'>=</span> <span class='va'>obs_1</span>, 
                               type <span class='op'>=</span> <span class='st'>"shap"</span>,
                               B <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span>

<span class='va'>shap_obs_1_rf</span>
</code></pre>
</div>
</details>
<pre><code>                                                                                         min
Random Forest with normalized data: ASTER_Altitude = 1578                       -0.085368241
Random Forest with normalized data: ASTER_Slope = 4.2                           -0.021789249
Random Forest with normalized data: Bio01_MT_Annu = 21.62                       -0.011996620
Random Forest with normalized data: Bio02_MDR = 9.717                           -0.009299092
Random Forest with normalized data: Bio03_Iso = 83.05                           -0.013765550
Random Forest with normalized data: Bio04_TS = 52.89                            -0.029046787
Random Forest with normalized data: Bio05_TWM = 27.5                            -0.041762783
Random Forest with normalized data: Bio06_MinTCM = 15.8                         -0.007803686
Random Forest with normalized data: Bio07_TAR = 11.7                            -0.003790884
Random Forest with normalized data: Bio08_MT_WetQ = 21.8                        -0.014366326
Random Forest with normalized data: Bio09_MT_DryQ = 20.92                       -0.002822711
Random Forest with normalized data: Bio10_MT_WarQ = 22.28                       -0.013462255
Random Forest with normalized data: Bio11_MT_ColQ = 20.92                       -0.005401931
Random Forest with normalized data: Bio12_Pecip_Annu = 1316                     -0.020103502
Random Forest with normalized data: Bio13_Precip_WetM = 227                     -0.026251862
Random Forest with normalized data: Bio14_Precip_DryM = 42                      -0.151433450
Random Forest with normalized data: Bio15_Precip_S = 53.05                      -0.009333022
Random Forest with normalized data: Bio16_Precip_WetQ = 585                     -0.057642892
Random Forest with normalized data: Bio17_Precip_DryQ = 168                     -0.007951676
Random Forest with normalized data: iSDA_CLAY_conc = 33.4                       -0.098965359
Random Forest with normalized data: iSDA_Depth_to_bedrock = 200                 -0.018945382
Random Forest with normalized data: iSDA_FE_Bulk_dens = 132.2                   -0.031964898
Random Forest with normalized data: iSDA_log_C_tot = 27.51                      -0.008315572
Random Forest with normalized data: iSDA_log_Ca = 67.77                         -0.124764036
Random Forest with normalized data: iSDA_log_eCEC = 27.79                       -0.004792442
Random Forest with normalized data: iSDA_log_Fe = 35.18                         -0.002279208
Random Forest with normalized data: iSDA_log_K = 53.3                           -0.122779232
Random Forest with normalized data: iSDA_log_Mg = 55.09                         -0.001941956
Random Forest with normalized data: iSDA_log_N = 60.84                          -0.011510828
Random Forest with normalized data: iSDA_log_P = 24.8                           -0.005299180
Random Forest with normalized data: iSDA_log_S = 17.79                          -0.005892905
Random Forest with normalized data: iSDA_log_SOC = 22.29                        -0.019948262
Random Forest with normalized data: iSDA_pH = 59.78                             -0.067685537
Random Forest with normalized data: iSDA_SAND_conc = 48.58                      -0.075731329
Random Forest with normalized data: iSDA_SILT_conc = 16.75                      -0.456205240
Random Forest with normalized data: Latitude = -1.582                           -0.012474958
Random Forest with normalized data: Longitude = 37.24                           -0.003151692
Random Forest with normalized data: Out.SubInd = Crop Yield                      0.000000000
Random Forest with normalized data: Out.SubInd.Code = CrY                        0.000000000
Random Forest with normalized data: PrName = Agroforestry Pruning-Alleycropping  0.000000000
Random Forest with normalized data: Product = Maize                              0.000000000
Random Forest with normalized data: Site.Type = Station                          0.001246342
Random Forest with normalized data: Tree = Senna siamea                          0.000000000
                                                                                           q1
Random Forest with normalized data: ASTER_Altitude = 1578                       -3.649778e-02
Random Forest with normalized data: ASTER_Slope = 4.2                           -1.129421e-02
Random Forest with normalized data: Bio01_MT_Annu = 21.62                       -1.074899e-02
Random Forest with normalized data: Bio02_MDR = 9.717                           -5.369947e-03
Random Forest with normalized data: Bio03_Iso = 83.05                           -5.318216e-03
Random Forest with normalized data: Bio04_TS = 52.89                            -1.437588e-02
Random Forest with normalized data: Bio05_TWM = 27.5                            -2.635513e-02
Random Forest with normalized data: Bio06_MinTCM = 15.8                         -3.726800e-03
Random Forest with normalized data: Bio07_TAR = 11.7                             9.190267e-04
Random Forest with normalized data: Bio08_MT_WetQ = 21.8                        -7.454669e-03
Random Forest with normalized data: Bio09_MT_DryQ = 20.92                        3.426585e-03
Random Forest with normalized data: Bio10_MT_WarQ = 22.28                       -7.171556e-03
Random Forest with normalized data: Bio11_MT_ColQ = 20.92                       -2.931869e-04
Random Forest with normalized data: Bio12_Pecip_Annu = 1316                     -1.070390e-02
Random Forest with normalized data: Bio13_Precip_WetM = 227                     -1.676428e-02
Random Forest with normalized data: Bio14_Precip_DryM = 42                      -1.057247e-01
Random Forest with normalized data: Bio15_Precip_S = 53.05                      -4.217553e-03
Random Forest with normalized data: Bio16_Precip_WetQ = 585                     -4.685373e-02
Random Forest with normalized data: Bio17_Precip_DryQ = 168                     -3.598718e-03
Random Forest with normalized data: iSDA_CLAY_conc = 33.4                       -6.828954e-02
Random Forest with normalized data: iSDA_Depth_to_bedrock = 200                 -1.474026e-02
Random Forest with normalized data: iSDA_FE_Bulk_dens = 132.2                   -2.153958e-02
Random Forest with normalized data: iSDA_log_C_tot = 27.51                      -5.250850e-03
Random Forest with normalized data: iSDA_log_Ca = 67.77                         -7.022042e-02
Random Forest with normalized data: iSDA_log_eCEC = 27.79                        6.669540e-03
Random Forest with normalized data: iSDA_log_Fe = 35.18                         -1.055308e-04
Random Forest with normalized data: iSDA_log_K = 53.3                           -1.053998e-01
Random Forest with normalized data: iSDA_log_Mg = 55.09                          4.887728e-04
Random Forest with normalized data: iSDA_log_N = 60.84                          -3.126224e-03
Random Forest with normalized data: iSDA_log_P = 24.8                            3.769077e-03
Random Forest with normalized data: iSDA_log_S = 17.79                          -3.631425e-03
Random Forest with normalized data: iSDA_log_SOC = 22.29                        -1.183887e-02
Random Forest with normalized data: iSDA_pH = 59.78                             -5.043370e-02
Random Forest with normalized data: iSDA_SAND_conc = 48.58                      -7.066870e-02
Random Forest with normalized data: iSDA_SILT_conc = 16.75                      -3.795036e-01
Random Forest with normalized data: Latitude = -1.582                           -2.949350e-03
Random Forest with normalized data: Longitude = 37.24                           -2.931024e-06
Random Forest with normalized data: Out.SubInd = Crop Yield                      0.000000e+00
Random Forest with normalized data: Out.SubInd.Code = CrY                        0.000000e+00
Random Forest with normalized data: PrName = Agroforestry Pruning-Alleycropping  0.000000e+00
Random Forest with normalized data: Product = Maize                              0.000000e+00
Random Forest with normalized data: Site.Type = Station                          3.088265e-03
Random Forest with normalized data: Tree = Senna siamea                          0.000000e+00
                                                                                       median
Random Forest with normalized data: ASTER_Altitude = 1578                        3.303210e-02
Random Forest with normalized data: ASTER_Slope = 4.2                            9.352991e-03
Random Forest with normalized data: Bio01_MT_Annu = 21.62                       -8.579408e-03
Random Forest with normalized data: Bio02_MDR = 9.717                           -1.248427e-03
Random Forest with normalized data: Bio03_Iso = 83.05                           -3.638750e-03
Random Forest with normalized data: Bio04_TS = 52.89                             2.567171e-02
Random Forest with normalized data: Bio05_TWM = 27.5                            -1.522176e-02
Random Forest with normalized data: Bio06_MinTCM = 15.8                         -5.598774e-04
Random Forest with normalized data: Bio07_TAR = 11.7                             3.034566e-03
Random Forest with normalized data: Bio08_MT_WetQ = 21.8                        -3.608673e-03
Random Forest with normalized data: Bio09_MT_DryQ = 20.92                        6.136941e-03
Random Forest with normalized data: Bio10_MT_WarQ = 22.28                        6.878026e-04
Random Forest with normalized data: Bio11_MT_ColQ = 20.92                        3.150855e-03
Random Forest with normalized data: Bio12_Pecip_Annu = 1316                     -4.912708e-03
Random Forest with normalized data: Bio13_Precip_WetM = 227                     -5.530671e-03
Random Forest with normalized data: Bio14_Precip_DryM = 42                      -7.132560e-02
Random Forest with normalized data: Bio15_Precip_S = 53.05                       4.718604e-03
Random Forest with normalized data: Bio16_Precip_WetQ = 585                     -3.405507e-02
Random Forest with normalized data: Bio17_Precip_DryQ = 168                     -6.193553e-04
Random Forest with normalized data: iSDA_CLAY_conc = 33.4                       -3.787151e-02
Random Forest with normalized data: iSDA_Depth_to_bedrock = 200                 -6.519023e-03
Random Forest with normalized data: iSDA_FE_Bulk_dens = 132.2                   -1.045432e-02
Random Forest with normalized data: iSDA_log_C_tot = 27.51                      -2.976676e-03
Random Forest with normalized data: iSDA_log_Ca = 67.77                         -5.699009e-02
Random Forest with normalized data: iSDA_log_eCEC = 27.79                        8.195866e-03
Random Forest with normalized data: iSDA_log_Fe = 35.18                          1.375444e-03
Random Forest with normalized data: iSDA_log_K = 53.3                           -9.101084e-02
Random Forest with normalized data: iSDA_log_Mg = 55.09                          7.174604e-03
Random Forest with normalized data: iSDA_log_N = 60.84                          -2.174202e-03
Random Forest with normalized data: iSDA_log_P = 24.8                            5.554033e-03
Random Forest with normalized data: iSDA_log_S = 17.79                          -1.847781e-03
Random Forest with normalized data: iSDA_log_SOC = 22.29                        -9.596346e-03
Random Forest with normalized data: iSDA_pH = 59.78                             -3.019971e-02
Random Forest with normalized data: iSDA_SAND_conc = 48.58                      -6.798895e-02
Random Forest with normalized data: iSDA_SILT_conc = 16.75                      -2.996857e-01
Random Forest with normalized data: Latitude = -1.582                           -2.803374e-04
Random Forest with normalized data: Longitude = 37.24                            8.274155e-05
Random Forest with normalized data: Out.SubInd = Crop Yield                      0.000000e+00
Random Forest with normalized data: Out.SubInd.Code = CrY                        0.000000e+00
Random Forest with normalized data: PrName = Agroforestry Pruning-Alleycropping  0.000000e+00
Random Forest with normalized data: Product = Maize                              0.000000e+00
Random Forest with normalized data: Site.Type = Station                          3.809577e-03
Random Forest with normalized data: Tree = Senna siamea                          0.000000e+00
                                                                                         mean
Random Forest with normalized data: ASTER_Altitude = 1578                        3.663359e-02
Random Forest with normalized data: ASTER_Slope = 4.2                            3.037880e-03
Random Forest with normalized data: Bio01_MT_Annu = 21.62                       -7.510433e-03
Random Forest with normalized data: Bio02_MDR = 9.717                           -1.248427e-03
Random Forest with normalized data: Bio03_Iso = 83.05                           -1.068609e-03
Random Forest with normalized data: Bio04_TS = 52.89                             2.437068e-02
Random Forest with normalized data: Bio05_TWM = 27.5                            -1.522176e-02
Random Forest with normalized data: Bio06_MinTCM = 15.8                         -1.196191e-03
Random Forest with normalized data: Bio07_TAR = 11.7                             3.034566e-03
Random Forest with normalized data: Bio08_MT_WetQ = 21.8                        -4.573455e-03
Random Forest with normalized data: Bio09_MT_DryQ = 20.92                        4.560425e-03
Random Forest with normalized data: Bio10_MT_WarQ = 22.28                        6.878026e-04
Random Forest with normalized data: Bio11_MT_ColQ = 20.92                        3.150855e-03
Random Forest with normalized data: Bio12_Pecip_Annu = 1316                     -7.468702e-03
Random Forest with normalized data: Bio13_Precip_WetM = 227                     -9.299994e-03
Random Forest with normalized data: Bio14_Precip_DryM = 42                      -7.741584e-02
Random Forest with normalized data: Bio15_Precip_S = 53.05                       3.930579e-03
Random Forest with normalized data: Bio16_Precip_WetQ = 585                     -3.405507e-02
Random Forest with normalized data: Bio17_Precip_DryQ = 168                      2.991939e-05
Random Forest with normalized data: iSDA_CLAY_conc = 33.4                       -4.363178e-02
Random Forest with normalized data: iSDA_Depth_to_bedrock = 200                 -4.859102e-03
Random Forest with normalized data: iSDA_FE_Bulk_dens = 132.2                   -1.045432e-02
Random Forest with normalized data: iSDA_log_C_tot = 27.51                      -2.373658e-03
Random Forest with normalized data: iSDA_log_Ca = 67.77                         -5.699009e-02
Random Forest with normalized data: iSDA_log_eCEC = 27.79                        9.188033e-03
Random Forest with normalized data: iSDA_log_Fe = 35.18                          4.522886e-03
Random Forest with normalized data: iSDA_log_K = 53.3                           -9.101084e-02
Random Forest with normalized data: iSDA_log_Mg = 55.09                          1.186520e-02
Random Forest with normalized data: iSDA_log_N = 60.84                          -3.126224e-03
Random Forest with normalized data: iSDA_log_P = 24.8                            5.792612e-03
Random Forest with normalized data: iSDA_log_S = 17.79                          -1.847781e-03
Random Forest with normalized data: iSDA_log_SOC = 22.29                        -7.211423e-03
Random Forest with normalized data: iSDA_pH = 59.78                             -3.620111e-02
Random Forest with normalized data: iSDA_SAND_conc = 48.58                      -6.169285e-02
Random Forest with normalized data: iSDA_SILT_conc = 16.75                      -2.996857e-01
Random Forest with normalized data: Latitude = -1.582                           -1.486552e-03
Random Forest with normalized data: Longitude = 37.24                            5.578808e-05
Random Forest with normalized data: Out.SubInd = Crop Yield                      0.000000e+00
Random Forest with normalized data: Out.SubInd.Code = CrY                        0.000000e+00
Random Forest with normalized data: PrName = Agroforestry Pruning-Alleycropping  0.000000e+00
Random Forest with normalized data: Product = Maize                              0.000000e+00
Random Forest with normalized data: Site.Type = Station                          4.029912e-03
Random Forest with normalized data: Tree = Senna siamea                          0.000000e+00
                                                                                           q3
Random Forest with normalized data: ASTER_Altitude = 1578                        0.1185307841
Random Forest with normalized data: ASTER_Slope = 4.2                            0.0137304936
Random Forest with normalized data: Bio01_MT_Annu = 21.62                       -0.0063015252
Random Forest with normalized data: Bio02_MDR = 9.717                            0.0024774092
Random Forest with normalized data: Bio03_Iso = 83.05                            0.0049686038
Random Forest with normalized data: Bio04_TS = 52.89                             0.0461471139
Random Forest with normalized data: Bio05_TWM = 27.5                            -0.0055918711
Random Forest with normalized data: Bio06_MinTCM = 15.8                          0.0016927448
Random Forest with normalized data: Bio07_TAR = 11.7                             0.0052748741
Random Forest with normalized data: Bio08_MT_WetQ = 21.8                         0.0003117081
Random Forest with normalized data: Bio09_MT_DryQ = 20.92                        0.0069071492
Random Forest with normalized data: Bio10_MT_WarQ = 22.28                        0.0097478915
Random Forest with normalized data: Bio11_MT_ColQ = 20.92                        0.0060017058
Random Forest with normalized data: Bio12_Pecip_Annu = 1316                     -0.0042320449
Random Forest with normalized data: Bio13_Precip_WetM = 227                     -0.0028835615
Random Forest with normalized data: Bio14_Precip_DryM = 42                      -0.0511628389
Random Forest with normalized data: Bio15_Precip_S = 53.05                       0.0101800572
Random Forest with normalized data: Bio16_Precip_WetQ = 585                     -0.0189797971
Random Forest with normalized data: Bio17_Precip_DryQ = 168                      0.0044083656
Random Forest with normalized data: iSDA_CLAY_conc = 33.4                       -0.0187187087
Random Forest with normalized data: iSDA_Depth_to_bedrock = 200                  0.0031831627
Random Forest with normalized data: iSDA_FE_Bulk_dens = 132.2                   -0.0040329542
Random Forest with normalized data: iSDA_log_C_tot = 27.51                       0.0016330161
Random Forest with normalized data: iSDA_log_Ca = 67.77                         -0.0269535880
Random Forest with normalized data: iSDA_log_eCEC = 27.79                        0.0099879916
Random Forest with normalized data: iSDA_log_Fe = 35.18                          0.0065379625
Random Forest with normalized data: iSDA_log_K = 53.3                           -0.0766093167
Random Forest with normalized data: iSDA_log_Mg = 55.09                          0.0214558194
Random Forest with normalized data: iSDA_log_N = 60.84                          -0.0008330949
Random Forest with normalized data: iSDA_log_P = 24.8                            0.0088267275
Random Forest with normalized data: iSDA_log_S = 17.79                          -0.0001045684
Random Forest with normalized data: iSDA_log_SOC = 22.29                         0.0007327724
Random Forest with normalized data: iSDA_pH = 59.78                             -0.0201140842
Random Forest with normalized data: iSDA_SAND_conc = 48.58                      -0.0529136976
Random Forest with normalized data: iSDA_SILT_conc = 16.75                      -0.2136054833
Random Forest with normalized data: Latitude = -1.582                            0.0011583074
Random Forest with normalized data: Longitude = 37.24                            0.0004637487
Random Forest with normalized data: Out.SubInd = Crop Yield                      0.0000000000
Random Forest with normalized data: Out.SubInd.Code = CrY                        0.0000000000
Random Forest with normalized data: PrName = Agroforestry Pruning-Alleycropping  0.0000000000
Random Forest with normalized data: Product = Maize                              0.0000000000
Random Forest with normalized data: Site.Type = Station                          0.0050108426
Random Forest with normalized data: Tree = Senna siamea                          0.0000000000
                                                                                          max
Random Forest with normalized data: ASTER_Altitude = 1578                        0.1498372981
Random Forest with normalized data: ASTER_Slope = 4.2                            0.0304217731
Random Forest with normalized data: Bio01_MT_Annu = 21.62                        0.0030496105
Random Forest with normalized data: Bio02_MDR = 9.717                            0.0064712768
Random Forest with normalized data: Bio03_Iso = 83.05                            0.0120473699
Random Forest with normalized data: Bio04_TS = 52.89                             0.0892603723
Random Forest with normalized data: Bio05_TWM = 27.5                             0.0048513495
Random Forest with normalized data: Bio06_MinTCM = 15.8                          0.0067117877
Random Forest with normalized data: Bio07_TAR = 11.7                             0.0084967973
Random Forest with normalized data: Bio08_MT_WetQ = 21.8                         0.0010338871
Random Forest with normalized data: Bio09_MT_DryQ = 20.92                        0.0088761555
Random Forest with normalized data: Bio10_MT_WarQ = 22.28                        0.0190042523
Random Forest with normalized data: Bio11_MT_ColQ = 20.92                        0.0104384616
Random Forest with normalized data: Bio12_Pecip_Annu = 1316                     -0.0018032096
Random Forest with normalized data: Bio13_Precip_WetM = 227                      0.0012745901
Random Forest with normalized data: Bio14_Precip_DryM = 42                      -0.0289922046
Random Forest with normalized data: Bio15_Precip_S = 53.05                       0.0146573467
Random Forest with normalized data: Bio16_Precip_WetQ = 585                     -0.0156811821
Random Forest with normalized data: Bio17_Precip_DryQ = 168                      0.0090304737
Random Forest with normalized data: iSDA_CLAY_conc = 33.4                       -0.0008967557
Random Forest with normalized data: iSDA_Depth_to_bedrock = 200                  0.0109334722
Random Forest with normalized data: iSDA_FE_Bulk_dens = 132.2                    0.0168902304
Random Forest with normalized data: iSDA_log_C_tot = 27.51                       0.0041379863
Random Forest with normalized data: iSDA_log_Ca = 67.77                         -0.0059544621
Random Forest with normalized data: iSDA_log_eCEC = 27.79                        0.0291775902
Random Forest with normalized data: iSDA_log_Fe = 35.18                          0.0235134948
Random Forest with normalized data: iSDA_log_K = 53.3                           -0.0496997019
Random Forest with normalized data: iSDA_log_Mg = 55.09                          0.0340869273
Random Forest with normalized data: iSDA_log_N = 60.84                           0.0006285435
Random Forest with normalized data: iSDA_log_P = 24.8                            0.0175203873
Random Forest with normalized data: iSDA_log_S = 17.79                           0.0031264189
Random Forest with normalized data: iSDA_log_SOC = 22.29                         0.0031198131
Random Forest with normalized data: iSDA_pH = 59.78                             -0.0135236274
Random Forest with normalized data: iSDA_SAND_conc = 48.58                      -0.0374562159
Random Forest with normalized data: iSDA_SILT_conc = 16.75                      -0.1512151569
Random Forest with normalized data: Latitude = -1.582                            0.0055562437
Random Forest with normalized data: Longitude = 37.24                            0.0015292152
Random Forest with normalized data: Out.SubInd = Crop Yield                      0.0000000000
Random Forest with normalized data: Out.SubInd.Code = CrY                        0.0000000000
Random Forest with normalized data: PrName = Agroforestry Pruning-Alleycropping  0.0000000000
Random Forest with normalized data: Product = Maize                              0.0000000000
Random Forest with normalized data: Site.Type = Station                          0.0072881169
Random Forest with normalized data: Tree = Senna siamea                          0.0000000000</code></pre>
</div>
<p>Accessing the underlying data and creating a custom plot</p>
<p>The box plots display the distribution of contributions across all the orderings we tried, and the bars display the average attribution for each feature.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>shap_obs_1_rf_plot</span> <span class='op'>&lt;-</span> 
  <span class='va'>shap_obs_1_rf</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>variable</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>mean_val <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>contribution</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>variable <span class='op'>=</span> <span class='fu'>fct_reorder</span><span class='op'>(</span><span class='va'>variable</span>, <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span><span class='va'>mean_val</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>contribution</span>, <span class='va'>variable</span>, fill <span class='op'>=</span> <span class='va'>mean_val</span> <span class='op'>&gt;</span> <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_col</span><span class='op'>(</span>data <span class='op'>=</span> <span class='op'>~</span><span class='fu'>distinct</span><span class='op'>(</span><span class='va'>.</span>, <span class='va'>variable</span>, <span class='va'>mean_val</span><span class='op'>)</span>, 
           <span class='fu'>aes</span><span class='op'>(</span><span class='va'>mean_val</span>, <span class='va'>variable</span><span class='op'>)</span>, 
           alpha <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_boxplot</span><span class='op'>(</span>width <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>y <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span>


<span class='va'>shap_obs_1_rf_plot</span>
</code></pre>
</div>
</details>
<p><img src="TIDYMODELSWFS_files/figure-html5/unnamed-chunk-33-1.png" width="624" /></p>
</div>
<p>What about a different individual observation in our data set? Let’s look at one of our observation that has a relatively high logRR value of 1.458. This observation has Alleycropping practice with the outcome Crop Yield for product Maize conducted at a Station with the agroforestry tree being Desmodium intortum This observation has following biophysical predictor features:</p>
<p>Observed high logRR</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>af.train.wf</span> <span class='op'>%&gt;%</span>
  <span class='fu'>relocate</span><span class='op'>(</span><span class='va'>logRR</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>arrange</span><span class='op'>(</span><span class='fu'>desc</span><span class='op'>(</span><span class='va'>logRR</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>PrName</span> <span class='op'>==</span> <span class='st'>"Agroforestry Pruning-Alleycropping"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code># A tibble: 725 × 44
   logRR PrName    Out.SubInd Product Site.Type Tree   Out.SubInd.Code
   &lt;dbl&gt; &lt;fct&gt;     &lt;fct&gt;      &lt;fct&gt;   &lt;fct&gt;     &lt;fct&gt;  &lt;fct&gt;          
 1  3.05 Agrofore… Crop Yield Maize   Station   Senna… CrY            
 2  2.71 Agrofore… Crop Yield Maize   Farm      Leuca… CrY            
 3  2.49 Agrofore… Crop Yield Maize   Farm      Leuca… CrY            
 4  2.44 Agrofore… Crop Yield Maize   Farm      Leuca… CrY            
 5  2.30 Agrofore… Crop Yield Maize   Station   Senna… CrY            
 6  2.20 Agrofore… Crop Yield Maize   Farm      Leuca… CrY            
 7  1.97 Agrofore… Crop Yield Maize   Station   Senna… CrY            
 8  1.90 Agrofore… Crop Yield Maize   Farm      Leuca… CrY            
 9  1.85 Agrofore… Crop Yield Maize   Station   Gliri… CrY            
10  1.78 Agrofore… Crop Yield Maize   Station   Gliri… CrY            
# … with 715 more rows, and 37 more variables: Latitude &lt;dbl&gt;,
#   Longitude &lt;dbl&gt;, Bio01_MT_Annu &lt;dbl&gt;, Bio02_MDR &lt;dbl&gt;,
#   Bio03_Iso &lt;dbl&gt;, Bio04_TS &lt;dbl&gt;, Bio05_TWM &lt;dbl&gt;,
#   Bio06_MinTCM &lt;dbl&gt;, Bio07_TAR &lt;dbl&gt;, Bio08_MT_WetQ &lt;dbl&gt;,
#   Bio09_MT_DryQ &lt;dbl&gt;, Bio10_MT_WarQ &lt;dbl&gt;, Bio11_MT_ColQ &lt;dbl&gt;,
#   Bio12_Pecip_Annu &lt;dbl&gt;, Bio13_Precip_WetM &lt;dbl&gt;,
#   Bio14_Precip_DryM &lt;dbl&gt;, Bio15_Precip_S &lt;dbl&gt;, …</code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>vip_train_2</span> <span class='op'>&lt;-</span> <span class='va'>vip_train</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>PrName</span> <span class='op'>==</span> <span class='st'>"Agroforestry Pruning-Alleycropping"</span> <span class='op'>&amp;</span> 
                  <span class='va'>Out.SubInd</span> <span class='op'>==</span> <span class='st'>"Crop Yield"</span> <span class='op'>&amp;</span> 
                  <span class='va'>Product</span> <span class='op'>==</span> <span class='st'>"Maize"</span> <span class='op'>&amp;</span> 
                  <span class='va'>Tree</span> <span class='op'>==</span> <span class='st'>"Senna siamea"</span> <span class='op'>&amp;</span> 
                  <span class='va'>Site.Type</span> <span class='op'>==</span> <span class='st'>"Station"</span> <span class='op'>&amp;</span> 
                  <span class='va'>Latitude</span> <span class='op'>==</span> <span class='fl'>7.49800</span> <span class='op'>&amp;</span> 
                  <span class='va'>Longitude</span> <span class='op'>==</span> <span class='fl'>3.90300</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span><span class='fu'>across</span><span class='op'>(</span><span class='fu'>where</span><span class='op'>(</span><span class='va'>is.numeric</span><span class='op'>)</span>, <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>.</span>, <span class='fl'>8</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>obs_2</span> <span class='op'>&lt;-</span> <span class='va'>vip_train_2</span><span class='op'>[</span><span class='fl'>1</span>,<span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<ul>
<li><p>logRR = 3.047025568</p></li>
<li><p>Latitude = -0.43100<br />
</p></li>
<li><p>Longitude = 34.20800<br />
</p></li>
<li><p>Bio01_MT_Annu = 15.78542<br />
</p></li>
<li><p>Bio02_MDR = 14.079167</p></li>
<li><p>Bio03_Iso = 79.09644<br />
</p></li>
<li><p>Bio04_TS = 65.36565<br />
</p></li>
<li><p>Bio05_TWM = 25.20000<br />
</p></li>
<li><p>Bio06_MinTCM = 7.400000<br />
</p></li>
<li><p>Bio07_TAR = 17.800000</p></li>
<li><p>Bio08_MT_WetQ = 16.58333</p></li>
<li><p>Bio09_MT_DryQ = 15.90833</p></li>
<li><p>Bio10_MT_WarQ = 16.65000</p></li>
<li><p>Bio11_MT_ColQ = 15.06250</p></li>
<li><p>Bio12_Pecip_Annu = 816.00000</p></li>
<li><p>Bio13_Precip_WetM = 128.25000</p></li>
<li><p>Bio14_Precip_DryM = 20.2500000</p></li>
<li><p>Bio15_Precip_S = 55.87148 &lt;- change these values</p></li>
<li><p>Bio16_Precip_WetQ = 300.00000</p></li>
<li><p>Bio17_Precip_DryQ = 94.00000000</p></li>
<li><p>iSDA_Depth_to_bedrock = 200.00</p></li>
<li><p>iSDA_SAND_conc = 41.296</p></li>
<li><p>iSDA_CLAY_conc = 33.072</p></li>
<li><p>iSDA_SILT_conc = 22.456</p></li>
<li><p>iSDA_FE_Bulk_dens = 131.328</p></li>
<li><p>iSDA_log_C_tot = 31.534</p></li>
<li><p>iSDA_log_Ca = 67.792</p></li>
<li><p>iSDA_log_eCEC = 27.962</p></li>
<li><p>iSDA_log_Fe = 37.530</p></li>
<li><p>iSDA_log_K = 55.520</p></li>
<li><p>iSDA_log_Mg = 53.61</p></li>
<li><p>iSDA_log_N = 66.422</p></li>
<li><p>iSDA_log_SOC = 21.866</p></li>
<li><p>iSDA_log_P = 31.078</p></li>
<li><p>iSDA_log_S = 33.40</p></li>
<li><p>iSDA_pH = 61.378</p></li>
<li><p>ASTER_Altitude = 1147.29</p></li>
<li><p>ASTER_Slope = 1.78</p></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>shap_obs_2_rf</span> <span class='op'>&lt;-</span> 
  <span class='fu'>predict_parts</span><span class='op'>(</span>explainer <span class='op'>=</span> <span class='va'>explainer_rf</span>, 
                new_observation <span class='op'>=</span> <span class='va'>obs_2</span>, 
                type <span class='op'>=</span> <span class='st'>"shap"</span>,
                B <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span>

<span class='va'>shap_obs_2_rf</span>
</code></pre>
</div>
</details>
<pre><code>                                                                                          min
Random Forest with normalized data: ASTER_Altitude = 218.8                      -0.2413360482
Random Forest with normalized data: ASTER_Slope = 2.39                          -0.0034194508
Random Forest with normalized data: Bio01_MT_Annu = 16.98                       -0.0060876497
Random Forest with normalized data: Bio02_MDR = 11.22                           -0.0048735637
Random Forest with normalized data: Bio03_Iso = 51.93                           -0.0027591610
Random Forest with normalized data: Bio04_TS = 377.2                            -0.0143210659
Random Forest with normalized data: Bio05_TWM = 28.4                            -0.0013499454
Random Forest with normalized data: Bio06_MinTCM = 6.8                          -0.0032153972
Random Forest with normalized data: Bio07_TAR = 21.6                            -0.0080519342
Random Forest with normalized data: Bio08_MT_WetQ = 12.32                       -0.0049331385
Random Forest with normalized data: Bio09_MT_DryQ = 21.45                       -0.0011637847
Random Forest with normalized data: Bio10_MT_WarQ = 21.45                       -0.0211508273
Random Forest with normalized data: Bio11_MT_ColQ = 12.32                       -0.0050692743
Random Forest with normalized data: Bio12_Pecip_Annu = 737                      -0.0128695840
Random Forest with normalized data: Bio13_Precip_WetM = 120                     -0.0191628714
Random Forest with normalized data: Bio14_Precip_DryM = 20                       0.0054769448
Random Forest with normalized data: Bio15_Precip_S = 62.46                      -0.0034409268
Random Forest with normalized data: Bio16_Precip_WetQ = 341                      0.0008373432
Random Forest with normalized data: Bio17_Precip_DryQ = 67                      -0.0024917171
Random Forest with normalized data: iSDA_CLAY_conc = 19.6                       -0.0528058894
Random Forest with normalized data: iSDA_Depth_to_bedrock = 200                 -0.0186626501
Random Forest with normalized data: iSDA_FE_Bulk_dens = 141.1                   -0.0106824178
Random Forest with normalized data: iSDA_log_C_tot = 29.26                      -0.0052690155
Random Forest with normalized data: iSDA_log_Ca = 61.96                          0.0054583049
Random Forest with normalized data: iSDA_log_eCEC = 20.28                        0.0081928640
Random Forest with normalized data: iSDA_log_Fe = 38.79                          0.0066883005
Random Forest with normalized data: iSDA_log_K = 41.31                          -0.0301565806
Random Forest with normalized data: iSDA_log_Mg = 45.69                         -0.0084910877
Random Forest with normalized data: iSDA_log_N = 55.75                          -0.0223520813
Random Forest with normalized data: iSDA_log_P = 20.14                          -0.0207019444
Random Forest with normalized data: iSDA_log_S = 19.34                          -0.0043009837
Random Forest with normalized data: iSDA_log_SOC = 17.99                        -0.0018825769
Random Forest with normalized data: iSDA_pH = 60.59                             -0.0135461971
Random Forest with normalized data: iSDA_SAND_conc = 63.19                       0.0104864582
Random Forest with normalized data: iSDA_SILT_conc = 13.49                       0.0074155335
Random Forest with normalized data: Latitude = 7.498                            -0.0112687196
Random Forest with normalized data: Longitude = 3.903                           -0.0063918113
Random Forest with normalized data: Out.SubInd = Crop Yield                      0.0000000000
Random Forest with normalized data: Out.SubInd.Code = CrY                        0.0000000000
Random Forest with normalized data: PrName = Agroforestry Pruning-Alleycropping  0.0000000000
Random Forest with normalized data: Product = Maize                              0.0000000000
Random Forest with normalized data: Site.Type = Station                          0.0033461683
Random Forest with normalized data: Tree = Senna siamea                          0.0000000000
                                                                                           q1
Random Forest with normalized data: ASTER_Altitude = 218.8                      -0.1718120911
Random Forest with normalized data: ASTER_Slope = 2.39                           0.0037919848
Random Forest with normalized data: Bio01_MT_Annu = 16.98                       -0.0011409895
Random Forest with normalized data: Bio02_MDR = 11.22                           -0.0023090251
Random Forest with normalized data: Bio03_Iso = 51.93                            0.0006990018
Random Forest with normalized data: Bio04_TS = 377.2                            -0.0102228470
Random Forest with normalized data: Bio05_TWM = 28.4                             0.0003386013
Random Forest with normalized data: Bio06_MinTCM = 6.8                          -0.0003059173
Random Forest with normalized data: Bio07_TAR = 21.6                            -0.0016991926
Random Forest with normalized data: Bio08_MT_WetQ = 12.32                       -0.0030776112
Random Forest with normalized data: Bio09_MT_DryQ = 21.45                        0.0002953544
Random Forest with normalized data: Bio10_MT_WarQ = 21.45                       -0.0111695587
Random Forest with normalized data: Bio11_MT_ColQ = 12.32                       -0.0029331674
Random Forest with normalized data: Bio12_Pecip_Annu = 737                      -0.0072302303
Random Forest with normalized data: Bio13_Precip_WetM = 120                     -0.0101459721
Random Forest with normalized data: Bio14_Precip_DryM = 20                       0.0068452761
Random Forest with normalized data: Bio15_Precip_S = 62.46                      -0.0002349702
Random Forest with normalized data: Bio16_Precip_WetQ = 341                      0.0081437740
Random Forest with normalized data: Bio17_Precip_DryQ = 67                      -0.0003143049
Random Forest with normalized data: iSDA_CLAY_conc = 19.6                       -0.0158543540
Random Forest with normalized data: iSDA_Depth_to_bedrock = 200                 -0.0083550365
Random Forest with normalized data: iSDA_FE_Bulk_dens = 141.1                   -0.0018845169
Random Forest with normalized data: iSDA_log_C_tot = 29.26                      -0.0040194527
Random Forest with normalized data: iSDA_log_Ca = 61.96                          0.0148873311
Random Forest with normalized data: iSDA_log_eCEC = 20.28                        0.0224058274
Random Forest with normalized data: iSDA_log_Fe = 38.79                          0.0090165360
Random Forest with normalized data: iSDA_log_K = 41.31                          -0.0112652009
Random Forest with normalized data: iSDA_log_Mg = 45.69                         -0.0038861999
Random Forest with normalized data: iSDA_log_N = 55.75                          -0.0156536445
Random Forest with normalized data: iSDA_log_P = 20.14                          -0.0094423584
Random Forest with normalized data: iSDA_log_S = 19.34                          -0.0019752852
Random Forest with normalized data: iSDA_log_SOC = 17.99                         0.0020828844
Random Forest with normalized data: iSDA_pH = 60.59                             -0.0063019672
Random Forest with normalized data: iSDA_SAND_conc = 63.19                       0.0420129543
Random Forest with normalized data: iSDA_SILT_conc = 13.49                       0.1125998954
Random Forest with normalized data: Latitude = 7.498                            -0.0086720344
Random Forest with normalized data: Longitude = 3.903                           -0.0018522265
Random Forest with normalized data: Out.SubInd = Crop Yield                      0.0000000000
Random Forest with normalized data: Out.SubInd.Code = CrY                        0.0000000000
Random Forest with normalized data: PrName = Agroforestry Pruning-Alleycropping  0.0000000000
Random Forest with normalized data: Product = Maize                              0.0000000000
Random Forest with normalized data: Site.Type = Station                          0.0043495682
Random Forest with normalized data: Tree = Senna siamea                          0.0000000000
                                                                                       median
Random Forest with normalized data: ASTER_Altitude = 218.8                      -1.127767e-01
Random Forest with normalized data: ASTER_Slope = 2.39                           5.038891e-03
Random Forest with normalized data: Bio01_MT_Annu = 16.98                        1.777257e-03
Random Forest with normalized data: Bio02_MDR = 11.22                           -7.012580e-04
Random Forest with normalized data: Bio03_Iso = 51.93                            3.935940e-03
Random Forest with normalized data: Bio04_TS = 377.2                            -3.327840e-03
Random Forest with normalized data: Bio05_TWM = 28.4                             1.550933e-03
Random Forest with normalized data: Bio06_MinTCM = 6.8                           1.808308e-03
Random Forest with normalized data: Bio07_TAR = 21.6                             2.655091e-03
Random Forest with normalized data: Bio08_MT_WetQ = 12.32                       -1.558511e-03
Random Forest with normalized data: Bio09_MT_DryQ = 21.45                        3.012257e-03
Random Forest with normalized data: Bio10_MT_WarQ = 21.45                       -1.726570e-03
Random Forest with normalized data: Bio11_MT_ColQ = 12.32                       -1.897767e-03
Random Forest with normalized data: Bio12_Pecip_Annu = 737                      -6.770267e-04
Random Forest with normalized data: Bio13_Precip_WetM = 120                     -4.936892e-03
Random Forest with normalized data: Bio14_Precip_DryM = 20                       1.386736e-02
Random Forest with normalized data: Bio15_Precip_S = 62.46                       1.828500e-03
Random Forest with normalized data: Bio16_Precip_WetQ = 341                      1.634973e-02
Random Forest with normalized data: Bio17_Precip_DryQ = 67                       2.446689e-04
Random Forest with normalized data: iSDA_CLAY_conc = 19.6                        1.318456e-02
Random Forest with normalized data: iSDA_Depth_to_bedrock = 200                 -2.719444e-03
Random Forest with normalized data: iSDA_FE_Bulk_dens = 141.1                    2.345542e-02
Random Forest with normalized data: iSDA_log_C_tot = 29.26                      -1.208675e-03
Random Forest with normalized data: iSDA_log_Ca = 61.96                          2.576340e-02
Random Forest with normalized data: iSDA_log_eCEC = 20.28                        3.053216e-02
Random Forest with normalized data: iSDA_log_Fe = 38.79                          1.049400e-02
Random Forest with normalized data: iSDA_log_K = 41.31                          -1.841424e-03
Random Forest with normalized data: iSDA_log_Mg = 45.69                         -2.234639e-03
Random Forest with normalized data: iSDA_log_N = 55.75                          -1.202785e-02
Random Forest with normalized data: iSDA_log_P = 20.14                          -4.036027e-03
Random Forest with normalized data: iSDA_log_S = 19.34                          -7.052287e-04
Random Forest with normalized data: iSDA_log_SOC = 17.99                         6.906871e-03
Random Forest with normalized data: iSDA_pH = 60.59                             -4.467944e-03
Random Forest with normalized data: iSDA_SAND_conc = 63.19                       5.453691e-02
Random Forest with normalized data: iSDA_SILT_conc = 13.49                       1.447453e-01
Random Forest with normalized data: Latitude = 7.498                            -3.529958e-03
Random Forest with normalized data: Longitude = 3.903                           -3.936695e-05
Random Forest with normalized data: Out.SubInd = Crop Yield                      0.000000e+00
Random Forest with normalized data: Out.SubInd.Code = CrY                        0.000000e+00
Random Forest with normalized data: PrName = Agroforestry Pruning-Alleycropping  0.000000e+00
Random Forest with normalized data: Product = Maize                              0.000000e+00
Random Forest with normalized data: Site.Type = Station                          4.942382e-03
Random Forest with normalized data: Tree = Senna siamea                          0.000000e+00
                                                                                         mean
Random Forest with normalized data: ASTER_Altitude = 218.8                      -0.1127766999
Random Forest with normalized data: ASTER_Slope = 2.39                           0.0064832559
Random Forest with normalized data: Bio01_MT_Annu = 16.98                        0.0033954507
Random Forest with normalized data: Bio02_MDR = 11.22                           -0.0012587779
Random Forest with normalized data: Bio03_Iso = 51.93                            0.0053375055
Random Forest with normalized data: Bio04_TS = 377.2                             0.0090214697
Random Forest with normalized data: Bio05_TWM = 28.4                             0.0030479696
Random Forest with normalized data: Bio06_MinTCM = 6.8                           0.0016756997
Random Forest with normalized data: Bio07_TAR = 21.6                             0.0026550915
Random Forest with normalized data: Bio08_MT_WetQ = 12.32                       -0.0016593249
Random Forest with normalized data: Bio09_MT_DryQ = 21.45                        0.0033135827
Random Forest with normalized data: Bio10_MT_WarQ = 21.45                       -0.0024840620
Random Forest with normalized data: Bio11_MT_ColQ = 12.32                       -0.0017422313
Random Forest with normalized data: Bio12_Pecip_Annu = 737                      -0.0005893544
Random Forest with normalized data: Bio13_Precip_WetM = 120                     -0.0049368922
Random Forest with normalized data: Bio14_Precip_DryM = 20                       0.0121765972
Random Forest with normalized data: Bio15_Precip_S = 62.46                       0.0024849431
Random Forest with normalized data: Bio16_Precip_WetQ = 341                      0.0157762217
Random Forest with normalized data: Bio17_Precip_DryQ = 67                       0.0002446689
Random Forest with normalized data: iSDA_CLAY_conc = 19.6                        0.0247514440
Random Forest with normalized data: iSDA_Depth_to_bedrock = 200                 -0.0034543637
Random Forest with normalized data: iSDA_FE_Bulk_dens = 141.1                    0.0173049026
Random Forest with normalized data: iSDA_log_C_tot = 29.26                      -0.0019062750
Random Forest with normalized data: iSDA_log_Ca = 61.96                          0.0274416080
Random Forest with normalized data: iSDA_log_eCEC = 20.28                        0.0274773175
Random Forest with normalized data: iSDA_log_Fe = 38.79                          0.0109135443
Random Forest with normalized data: iSDA_log_K = 41.31                          -0.0018414237
Random Forest with normalized data: iSDA_log_Mg = 45.69                          0.0033049739
Random Forest with normalized data: iSDA_log_N = 55.75                          -0.0123074738
Random Forest with normalized data: iSDA_log_P = 20.14                          -0.0056406364
Random Forest with normalized data: iSDA_log_S = 19.34                          -0.0010196773
Random Forest with normalized data: iSDA_log_SOC = 17.99                         0.0069068708
Random Forest with normalized data: iSDA_pH = 60.59                             -0.0042909821
Random Forest with normalized data: iSDA_SAND_conc = 63.19                       0.0600700523
Random Forest with normalized data: iSDA_SILT_conc = 13.49                       0.1447452837
Random Forest with normalized data: Latitude = 7.498                            -0.0048447778
Random Forest with normalized data: Longitude = 3.903                           -0.0007912958
Random Forest with normalized data: Out.SubInd = Crop Yield                      0.0000000000
Random Forest with normalized data: Out.SubInd.Code = CrY                        0.0000000000
Random Forest with normalized data: PrName = Agroforestry Pruning-Alleycropping  0.0000000000
Random Forest with normalized data: Product = Maize                              0.0000000000
Random Forest with normalized data: Site.Type = Station                          0.0051091095
Random Forest with normalized data: Tree = Senna siamea                          0.0000000000
                                                                                           q3
Random Forest with normalized data: ASTER_Altitude = 218.8                      -0.0142088070
Random Forest with normalized data: ASTER_Slope = 2.39                           0.0105572389
Random Forest with normalized data: Bio01_MT_Annu = 16.98                        0.0060006611
Random Forest with normalized data: Bio02_MDR = 11.22                            0.0001670807
Random Forest with normalized data: Bio03_Iso = 51.93                            0.0101655898
Random Forest with normalized data: Bio04_TS = 377.2                             0.0285079227
Random Forest with normalized data: Bio05_TWM = 28.4                             0.0050122677
Random Forest with normalized data: Bio06_MinTCM = 6.8                           0.0038578333
Random Forest with normalized data: Bio07_TAR = 21.6                             0.0077332172
Random Forest with normalized data: Bio08_MT_WetQ = 12.32                       -0.0002244711
Random Forest with normalized data: Bio09_MT_DryQ = 21.45                        0.0063586944
Random Forest with normalized data: Bio10_MT_WarQ = 21.45                        0.0074639749
Random Forest with normalized data: Bio11_MT_ColQ = 12.32                       -0.0006566245
Random Forest with normalized data: Bio12_Pecip_Annu = 737                       0.0062416301
Random Forest with normalized data: Bio13_Precip_WetM = 120                      0.0008447005
Random Forest with normalized data: Bio14_Precip_DryM = 20                       0.0162457384
Random Forest with normalized data: Bio15_Precip_S = 62.46                       0.0069621691
Random Forest with normalized data: Bio16_Precip_WetQ = 341                      0.0232596954
Random Forest with normalized data: Bio17_Precip_DryQ = 67                       0.0006422846
Random Forest with normalized data: iSDA_CLAY_conc = 19.6                        0.0712747988
Random Forest with normalized data: iSDA_Depth_to_bedrock = 200                  0.0019156967
Random Forest with normalized data: iSDA_FE_Bulk_dens = 141.1                    0.0319911615
Random Forest with normalized data: iSDA_log_C_tot = 29.26                      -0.0003382253
Random Forest with normalized data: iSDA_log_Ca = 61.96                          0.0392803577
Random Forest with normalized data: iSDA_log_eCEC = 20.28                        0.0344551002
Random Forest with normalized data: iSDA_log_Fe = 38.79                          0.0137782574
Random Forest with normalized data: iSDA_log_K = 41.31                           0.0098034279
Random Forest with normalized data: iSDA_log_Mg = 45.69                          0.0071592061
Random Forest with normalized data: iSDA_log_N = 55.75                          -0.0094089350
Random Forest with normalized data: iSDA_log_P = 20.14                          -0.0002897825
Random Forest with normalized data: iSDA_log_S = 19.34                           0.0007968772
Random Forest with normalized data: iSDA_log_SOC = 17.99                         0.0117357132
Random Forest with normalized data: iSDA_pH = 60.59                             -0.0031815212
Random Forest with normalized data: iSDA_SAND_conc = 63.19                       0.0921599279
Random Forest with normalized data: iSDA_SILT_conc = 13.49                       0.1904868322
Random Forest with normalized data: Latitude = 7.498                            -0.0024302043
Random Forest with normalized data: Longitude = 3.903                            0.0005387541
Random Forest with normalized data: Out.SubInd = Crop Yield                      0.0000000000
Random Forest with normalized data: Out.SubInd.Code = CrY                        0.0000000000
Random Forest with normalized data: PrName = Agroforestry Pruning-Alleycropping  0.0000000000
Random Forest with normalized data: Product = Maize                              0.0000000000
Random Forest with normalized data: Site.Type = Station                          0.0057073220
Random Forest with normalized data: Tree = Senna siamea                          0.0000000000
                                                                                          max
Random Forest with normalized data: ASTER_Altitude = 218.8                       0.0005379280
Random Forest with normalized data: ASTER_Slope = 2.39                           0.0146472313
Random Forest with normalized data: Bio01_MT_Annu = 16.98                        0.0163678984
Random Forest with normalized data: Bio02_MDR = 11.22                            0.0006855466
Random Forest with normalized data: Bio03_Iso = 51.93                            0.0147684074
Random Forest with normalized data: Bio04_TS = 377.2                             0.0364001688
Random Forest with normalized data: Bio05_TWM = 28.4                             0.0104652867
Random Forest with normalized data: Bio06_MinTCM = 6.8                           0.0048200404
Random Forest with normalized data: Bio07_TAR = 21.6                             0.0113205287
Random Forest with normalized data: Bio08_MT_WetQ = 12.32                        0.0023022199
Random Forest with normalized data: Bio09_MT_DryQ = 21.45                        0.0086520854
Random Forest with normalized data: Bio10_MT_WarQ = 21.45                        0.0122233249
Random Forest with normalized data: Bio11_MT_ColQ = 12.32                        0.0028567839
Random Forest with normalized data: Bio12_Pecip_Annu = 737                       0.0097747064
Random Forest with normalized data: Bio13_Precip_WetM = 120                      0.0070536282
Random Forest with normalized data: Bio14_Precip_DryM = 20                       0.0195852731
Random Forest with normalized data: Bio15_Precip_S = 62.46                       0.0091168664
Random Forest with normalized data: Bio16_Precip_WetQ = 341                      0.0279629417
Random Forest with normalized data: Bio17_Precip_DryQ = 67                       0.0019175775
Random Forest with normalized data: iSDA_CLAY_conc = 19.6                        0.0988895936
Random Forest with normalized data: iSDA_Depth_to_bedrock = 200                  0.0054981610
Random Forest with normalized data: iSDA_FE_Bulk_dens = 141.1                    0.0415919443
Random Forest with normalized data: iSDA_log_C_tot = 29.26                       0.0008357351
Random Forest with normalized data: iSDA_log_Ca = 61.96                          0.0536130446
Random Forest with normalized data: iSDA_log_eCEC = 20.28                        0.0435565093
Random Forest with normalized data: iSDA_log_Fe = 38.79                          0.0149551247
Random Forest with normalized data: iSDA_log_K = 41.31                           0.0139901823
Random Forest with normalized data: iSDA_log_Mg = 45.69                          0.0271402392
Random Forest with normalized data: iSDA_log_N = 55.75                          -0.0050868606
Random Forest with normalized data: iSDA_log_P = 20.14                           0.0020399510
Random Forest with normalized data: iSDA_log_S = 19.34                           0.0013388769
Random Forest with normalized data: iSDA_log_SOC = 17.99                         0.0159835290
Random Forest with normalized data: iSDA_pH = 60.59                              0.0054492050
Random Forest with normalized data: iSDA_SAND_conc = 63.19                       0.1179477671
Random Forest with normalized data: iSDA_SILT_conc = 13.49                       0.2348439849
Random Forest with normalized data: Latitude = 7.498                             0.0006236379
Random Forest with normalized data: Longitude = 3.903                            0.0021109786
Random Forest with normalized data: Out.SubInd = Crop Yield                      0.0000000000
Random Forest with normalized data: Out.SubInd.Code = CrY                        0.0000000000
Random Forest with normalized data: PrName = Agroforestry Pruning-Alleycropping  0.0000000000
Random Forest with normalized data: Product = Maize                              0.0000000000
Random Forest with normalized data: Site.Type = Station                          0.0072966598
Random Forest with normalized data: Tree = Senna siamea                          0.0000000000</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>shap_obs_2_rf_plot</span> <span class='op'>&lt;-</span> 
  <span class='va'>shap_obs_2_rf</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>variable</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>mean_val <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>contribution</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>variable <span class='op'>=</span> <span class='fu'>fct_reorder</span><span class='op'>(</span><span class='va'>variable</span>, <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span><span class='va'>mean_val</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>contribution</span>, <span class='va'>variable</span>, fill <span class='op'>=</span> <span class='va'>mean_val</span> <span class='op'>&gt;</span> <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_col</span><span class='op'>(</span>data <span class='op'>=</span> <span class='op'>~</span><span class='fu'>distinct</span><span class='op'>(</span><span class='va'>.</span>, <span class='va'>variable</span>, <span class='va'>mean_val</span><span class='op'>)</span>, 
           <span class='fu'>aes</span><span class='op'>(</span><span class='va'>mean_val</span>, <span class='va'>variable</span><span class='op'>)</span>, 
           alpha <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_boxplot</span><span class='op'>(</span>width <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>y <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span>

<span class='va'>shap_obs_2_rf_plot</span>
</code></pre>
</div>
</details>
<p><img src="TIDYMODELSWFS_files/figure-html5/unnamed-chunk-36-1.png" width="624" /></p>
</div>
<p>Global explanations</p>
<p>Global model explanations, also called global feature importance or variable importance, help us understand which features are most important in driving the predictions of these two models overall, aggregated over the whole training set. While the previous section addressed what variables or features are most important in predicting sale price for an individual home, global feature importance addresses what variables are most important for a model in aggregate.</p>
<p><strong>Note:</strong> One way to compute variable importance is to permute the features (Breiman 2001a). We can permute or shuffle the values of a feature, predict from the model, and then measure how much worse the model fits the data compared to before shuffling.</p>
<p>If shuffling a column causes a large degradation in model performance, it is important; if shuffling a column’s values doesn’t make much difference to how the model performs, it must not be an important variable. This approach can be applied to any kind of model (it is model-agnostic) and the results are straightforward to understand.</p>
<p>Using DALEX, we compute this kind of variable importance via the model_parts() function.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>vip_rf</span> <span class='op'>&lt;-</span> <span class='fu'>DALEX</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/DALEX/man/model_parts.html'>model_parts</a></span><span class='op'>(</span><span class='va'>explainer_rf</span>, loss_function <span class='op'>=</span> <span class='va'>loss_root_mean_square</span><span class='op'>)</span>
<span class='va'>vip_xgb</span> <span class='op'>&lt;-</span> <span class='fu'>DALEX</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/DALEX/man/model_parts.html'>model_parts</a></span><span class='op'>(</span><span class='va'>explainer_xgb</span>, loss_function <span class='op'>=</span> <span class='va'>loss_root_mean_square</span><span class='op'>)</span> 
<span class='va'>vip_cart</span> <span class='op'>&lt;-</span> <span class='fu'>DALEX</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/DALEX/man/model_parts.html'>model_parts</a></span><span class='op'>(</span><span class='va'>explainer_cart</span>, loss_function <span class='op'>=</span> <span class='va'>loss_root_mean_square</span><span class='op'>)</span> 
<span class='va'>vip_glm</span> <span class='op'>&lt;-</span> <span class='fu'>DALEX</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/DALEX/man/model_parts.html'>model_parts</a></span><span class='op'>(</span><span class='va'>explainer_glm</span>, loss_function <span class='op'>=</span> <span class='va'>loss_root_mean_square</span><span class='op'>)</span> 
</code></pre>
</div>
</details>
</div>
<p>Again, we could use the default plot method from DALEX by calling e.g. plot(vip_glm) or plot(vip_rf) but the underlying data is available for exploration, analysis, and plotting. Let’s create a function:</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>vip_glm</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="TIDYMODELSWFS_files/figure-html5/unnamed-chunk-38-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>vip_rf</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="TIDYMODELSWFS_files/figure-html5/unnamed-chunk-39-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>ggplot_imp</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>...</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>obj</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>...</span><span class='op'>)</span>
  <span class='va'>metric_name</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/attr.html'>attr</a></span><span class='op'>(</span><span class='va'>obj</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>, <span class='st'>"loss_name"</span><span class='op'>)</span>
  <span class='va'>metric_lab</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='va'>metric_name</span>, 
                      <span class='st'>"after permutations\n(higher indicates more important)"</span><span class='op'>)</span>
  
  <span class='va'>full_vip</span> <span class='op'>&lt;-</span> <span class='fu'>bind_rows</span><span class='op'>(</span><span class='va'>obj</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>variable</span> <span class='op'>!=</span> <span class='st'>"_baseline_"</span><span class='op'>)</span>
  
  <span class='va'>perm_vals</span> <span class='op'>&lt;-</span> <span class='va'>full_vip</span> <span class='op'>%&gt;%</span> 
    <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>variable</span> <span class='op'>==</span> <span class='st'>"_full_model_"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>label</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>summarise</span><span class='op'>(</span>dropout_loss <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>dropout_loss</span><span class='op'>)</span><span class='op'>)</span>
  
  <span class='va'>p</span> <span class='op'>&lt;-</span> <span class='va'>full_vip</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>variable</span> <span class='op'>!=</span> <span class='st'>"_full_model_"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>mutate</span><span class='op'>(</span>variable <span class='op'>=</span> <span class='fu'>fct_reorder</span><span class='op'>(</span><span class='va'>variable</span>, <span class='va'>dropout_loss</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>dropout_loss</span>, <span class='va'>variable</span><span class='op'>)</span><span class='op'>)</span> 
  <span class='kw'>if</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>obj</span><span class='op'>)</span> <span class='op'>&gt;</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='va'>p</span> <span class='op'>&lt;-</span> <span class='va'>p</span> <span class='op'>+</span> 
      <span class='fu'>facet_wrap</span><span class='op'>(</span><span class='fu'>vars</span><span class='op'>(</span><span class='va'>label</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
      <span class='fu'>geom_vline</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>perm_vals</span>, <span class='fu'>aes</span><span class='op'>(</span>xintercept <span class='op'>=</span> <span class='va'>dropout_loss</span>, color <span class='op'>=</span> <span class='va'>label</span><span class='op'>)</span>,
                 size <span class='op'>=</span> <span class='fl'>1.4</span>, lty <span class='op'>=</span> <span class='fl'>2</span>, alpha <span class='op'>=</span> <span class='fl'>0.7</span><span class='op'>)</span> <span class='op'>+</span>
      <span class='fu'>geom_boxplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>color <span class='op'>=</span> <span class='va'>label</span>, fill <span class='op'>=</span> <span class='va'>label</span><span class='op'>)</span>, alpha <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span>
  <span class='op'>}</span> <span class='kw'>else</span> <span class='op'>{</span>
    <span class='va'>p</span> <span class='op'>&lt;-</span> <span class='va'>p</span> <span class='op'>+</span> 
      <span class='fu'>geom_vline</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>perm_vals</span>, <span class='fu'>aes</span><span class='op'>(</span>xintercept <span class='op'>=</span> <span class='va'>dropout_loss</span><span class='op'>)</span>,
                 size <span class='op'>=</span> <span class='fl'>1.4</span>, lty <span class='op'>=</span> <span class='fl'>2</span>, alpha <span class='op'>=</span> <span class='fl'>0.7</span><span class='op'>)</span> <span class='op'>+</span>
      <span class='fu'>geom_boxplot</span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"#91CBD765"</span>, alpha <span class='op'>=</span> <span class='fl'>0.4</span><span class='op'>)</span>
    
  <span class='op'>}</span>
  
  <span class='va'>p</span> <span class='op'>+</span>
    <span class='fu'>theme</span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>labs</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>metric_lab</span>, 
         y <span class='op'>=</span> <span class='cn'>NULL</span>,  fill <span class='op'>=</span> <span class='cn'>NULL</span>,  color <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>pdp_iSDA_SILT</span> <span class='op'>&lt;-</span> <span class='fu'>model_profile</span><span class='op'>(</span><span class='va'>explainer_rf</span>, 
                               N <span class='op'>=</span> <span class='fl'>500</span>, 
                               variables <span class='op'>=</span> <span class='st'>"iSDA_SILT_conc"</span><span class='op'>)</span>

<span class='va'>pdp_iSDA_SILT</span>
</code></pre>
</div>
</details>
<pre><code>Top profiles    : 
         _vname_                            _label_    _x_    _yhat_
1 iSDA_SILT_conc Random Forest with normalized data  7.722 0.5307479
2 iSDA_SILT_conc Random Forest with normalized data  8.420 0.5314569
3 iSDA_SILT_conc Random Forest with normalized data  9.226 0.5266891
4 iSDA_SILT_conc Random Forest with normalized data 10.576 0.5254240
5 iSDA_SILT_conc Random Forest with normalized data 11.314 0.5247119
6 iSDA_SILT_conc Random Forest with normalized data 11.628 0.5217006
  _ids_
1     0
2     0
3     0
4     0
5     0
6     0</code></pre>
</div>
<p>Let’s create another function for plotting the underlying data in this object:</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>ggplot_pdp</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>obj</span>, <span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  
  <span class='va'>p</span> <span class='op'>&lt;-</span> 
    <span class='fu'>as_tibble</span><span class='op'>(</span><span class='va'>obj</span><span class='op'>$</span><span class='va'>agr_profiles</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>`_label_` <span class='op'>=</span> <span class='fu'>stringr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/stringr/man/str_remove.html'>str_remove</a></span><span class='op'>(</span><span class='va'>`_label_`</span>, <span class='st'>"^[^_]*_"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>`_x_`</span>, <span class='va'>`_yhat_`</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_line</span><span class='op'>(</span>data <span class='op'>=</span> <span class='fu'>as_tibble</span><span class='op'>(</span><span class='va'>obj</span><span class='op'>$</span><span class='va'>cp_profiles</span><span class='op'>)</span>,
              <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='op'>{</span><span class='op'>{</span> <span class='va'>x</span> <span class='op'>}</span><span class='op'>}</span>, group <span class='op'>=</span> <span class='va'>`_ids_`</span><span class='op'>)</span>,
              size <span class='op'>=</span> <span class='fl'>0.5</span>, alpha <span class='op'>=</span> <span class='fl'>0.05</span>, color <span class='op'>=</span> <span class='st'>"gray50"</span><span class='op'>)</span>
  
  <span class='va'>num_colors</span> <span class='op'>&lt;-</span> <span class='fu'>n_distinct</span><span class='op'>(</span><span class='va'>obj</span><span class='op'>$</span><span class='va'>agr_profiles</span><span class='op'>$</span><span class='va'>`_label_`</span><span class='op'>)</span>
  
  <span class='kw'>if</span> <span class='op'>(</span><span class='va'>num_colors</span> <span class='op'>&gt;</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='va'>p</span> <span class='op'>&lt;-</span> <span class='va'>p</span> <span class='op'>+</span> <span class='fu'>geom_line</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>color <span class='op'>=</span> <span class='va'>`_label_`</span><span class='op'>)</span>, size <span class='op'>=</span> <span class='fl'>1.2</span>, alpha <span class='op'>=</span> <span class='fl'>0.8</span><span class='op'>)</span>
  <span class='op'>}</span> <span class='kw'>else</span> <span class='op'>{</span>
    <span class='va'>p</span> <span class='op'>&lt;-</span> <span class='va'>p</span> <span class='op'>+</span> <span class='fu'>geom_line</span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"midnightblue"</span>, size <span class='op'>=</span> <span class='fl'>1.2</span>, alpha <span class='op'>=</span> <span class='fl'>0.8</span><span class='op'>)</span>
  <span class='op'>}</span>
  
  <span class='va'>p</span>
<span class='op'>}</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggplot_imp</span><span class='op'>(</span><span class='va'>vip_rf</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="TIDYMODELSWFS_files/figure-html5/unnamed-chunk-43-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggplot_imp</span><span class='op'>(</span><span class='va'>vip_xgb</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="TIDYMODELSWFS_files/figure-html5/unnamed-chunk-44-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggplot_imp</span><span class='op'>(</span><span class='va'>vip_cart</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="TIDYMODELSWFS_files/figure-html5/unnamed-chunk-45-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggplot_imp</span><span class='op'>(</span><span class='va'>vip_glm</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="TIDYMODELSWFS_files/figure-html5/unnamed-chunk-46-1.png" width="624" /></p>
</div>
<p>The dashed line in each panel shows the RMSE for the full model, either the linear model or the random forest model. Features further to the right are more important, because permuting them results in higher RMSE. There is quite a lot of interesting information to learn from this plot; for example, neighborhood is quite important in the linear model with interactions/splines but the second least important feature for the random forest model.</p>
<p>Building global explanations from local explanations</p>
<p>So far in this chapter, we have focused on local model explanations for a single observation (via Shapley additive explanations) and global model explanations for a data set as a whole (via permuting features). It is also possible to build global model explanations up by aggregating local model explanations, as with partial dependence profiles.</p>
<p><strong>Notes:</strong> Partial dependence profiles show how the expected value of a model prediction, like the predicted price of a home in Ames, changes as a function of a feature, like the age or gross living area.</p>
<p>One way to build such a profile is by aggregating or averaging profiles for individual observations. A profile showing how an individual observation’s prediction changes as a function of a given feature is called an ICE (individual conditional expectation) profile or a CP (ceteris paribus) profile. We can compute such individual profiles (for 500 of the observations in our training set) and then aggregate them using the DALEX function model_profile(). pdp = partial dependency plots</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>pdp_iSDA_SILT</span> <span class='op'>&lt;-</span> <span class='fu'>model_profile</span><span class='op'>(</span><span class='va'>explainer_rf</span>, 
                               N <span class='op'>=</span> <span class='fl'>500</span>, 
                               variables <span class='op'>=</span> <span class='st'>"iSDA_SILT_conc"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<p>Let’s create another function for plotting the underlying data in this object:</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>ggplot_pdp</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>obj</span>, <span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  
  <span class='va'>p</span> <span class='op'>&lt;-</span> 
    <span class='fu'>as_tibble</span><span class='op'>(</span><span class='va'>obj</span><span class='op'>$</span><span class='va'>agr_profiles</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>`_label_` <span class='op'>=</span> <span class='fu'>stringr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/stringr/man/str_remove.html'>str_remove</a></span><span class='op'>(</span><span class='va'>`_label_`</span>, <span class='st'>"^[^_]*_"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>`_x_`</span>, <span class='va'>`_yhat_`</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_line</span><span class='op'>(</span>data <span class='op'>=</span> <span class='fu'>as_tibble</span><span class='op'>(</span><span class='va'>obj</span><span class='op'>$</span><span class='va'>cp_profiles</span><span class='op'>)</span>,
              <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='op'>{</span><span class='op'>{</span> <span class='va'>x</span> <span class='op'>}</span><span class='op'>}</span>, group <span class='op'>=</span> <span class='va'>`_ids_`</span><span class='op'>)</span>,
              size <span class='op'>=</span> <span class='fl'>0.5</span>, alpha <span class='op'>=</span> <span class='fl'>0.05</span>, color <span class='op'>=</span> <span class='st'>"gray50"</span><span class='op'>)</span>
  
  <span class='va'>num_colors</span> <span class='op'>&lt;-</span> <span class='fu'>n_distinct</span><span class='op'>(</span><span class='va'>obj</span><span class='op'>$</span><span class='va'>agr_profiles</span><span class='op'>$</span><span class='va'>`_label_`</span><span class='op'>)</span>
  
  <span class='kw'>if</span> <span class='op'>(</span><span class='va'>num_colors</span> <span class='op'>&gt;</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='va'>p</span> <span class='op'>&lt;-</span> <span class='va'>p</span> <span class='op'>+</span> <span class='fu'>geom_line</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>color <span class='op'>=</span> <span class='va'>`_label_`</span><span class='op'>)</span>, size <span class='op'>=</span> <span class='fl'>1.2</span>, alpha <span class='op'>=</span> <span class='fl'>0.8</span><span class='op'>)</span>
  <span class='op'>}</span> <span class='kw'>else</span> <span class='op'>{</span>
    <span class='va'>p</span> <span class='op'>&lt;-</span> <span class='va'>p</span> <span class='op'>+</span> <span class='fu'>geom_line</span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"midnightblue"</span>, size <span class='op'>=</span> <span class='fl'>1.2</span>, alpha <span class='op'>=</span> <span class='fl'>0.8</span><span class='op'>)</span>
  <span class='op'>}</span>
  
  <span class='va'>p</span>
<span class='op'>}</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggplot_pdp</span><span class='op'>(</span><span class='va'>pdp_iSDA_SILT</span>, <span class='va'>iSDA_SILT_conc</span><span class='op'>)</span>  <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"iSDA_SILT_conc"</span>, 
       y <span class='op'>=</span> <span class='st'>"logRR"</span>, 
       color <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="TIDYMODELSWFS_files/figure-html5/unnamed-chunk-49-1.png" width="624" /></p>
</div>
<p>Partial dependence profiles can be computed for any other feature in the model, and also for groups in the data, such as Bldg_Type. Let’s use 1,000 observations for these profiles.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>pdp_Bio04_TS</span> <span class='op'>&lt;-</span> <span class='fu'>model_profile</span><span class='op'>(</span><span class='va'>explainer_rf</span>, 
                              N <span class='op'>=</span> <span class='fl'>500</span>, 
                              variables <span class='op'>=</span> <span class='st'>"Bio04_TS"</span><span class='op'>)</span> 

<span class='va'>pdp_Bio04_TS_sitetype</span> <span class='op'>&lt;-</span> <span class='fu'>model_profile</span><span class='op'>(</span><span class='va'>explainer_rf</span>, 
                              N <span class='op'>=</span> <span class='fl'>500</span>, 
                              variables <span class='op'>=</span> <span class='st'>"Bio04_TS"</span>,
                              groups <span class='op'>=</span> <span class='st'>"Site.Type"</span><span class='op'>)</span> 

<span class='va'>pdp_Bio04_TS_tree</span> <span class='op'>&lt;-</span> <span class='fu'>model_profile</span><span class='op'>(</span><span class='va'>explainer_rf</span>, 
                              N <span class='op'>=</span> <span class='fl'>500</span>, 
                              variables <span class='op'>=</span> <span class='st'>"Bio04_TS"</span>,
                              groups <span class='op'>=</span> <span class='st'>"Tree"</span><span class='op'>)</span> 
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggplot_pdp</span><span class='op'>(</span><span class='va'>pdp_Bio04_TS</span>, <span class='va'>Bio04_TS</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_y_log10</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_color_brewer</span><span class='op'>(</span>palette <span class='op'>=</span> <span class='st'>"Dark2"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"Bio04_TS"</span>, 
       y <span class='op'>=</span> <span class='st'>"logRR"</span>, 
       color <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<img src="TIDYMODELSWFS_files/figure-html5/unnamed-chunk-51-1.png" width="624" />
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggplot_pdp</span><span class='op'>(</span><span class='va'>pdp_Bio04_TS</span>, <span class='va'>Bio04_TS</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_color_brewer</span><span class='op'>(</span>palette <span class='op'>=</span> <span class='st'>"Dark2"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"Bio04_TS"</span>, 
       y <span class='op'>=</span> <span class='st'>"logRR"</span>, 
       color <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<img src="TIDYMODELSWFS_files/figure-html5/unnamed-chunk-51-2.png" width="624" />
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggplot_pdp</span><span class='op'>(</span><span class='va'>pdp_Bio04_TS_sitetype</span>, <span class='va'>Bio04_TS</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_color_brewer</span><span class='op'>(</span>palette <span class='op'>=</span> <span class='st'>"Dark2"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"Bio04_TS"</span>, 
       y <span class='op'>=</span> <span class='st'>"logRR"</span>, 
       color <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="TIDYMODELSWFS_files/figure-html5/unnamed-chunk-51-3.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggplot_pdp</span><span class='op'>(</span><span class='va'>pdp_Bio04_TS_tree</span>, <span class='va'>Bio04_TS</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_color_brewer</span><span class='op'>(</span>palette <span class='op'>=</span> <span class='st'>"Dark2"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"Bio04_TS"</span>, 
       y <span class='op'>=</span> <span class='st'>"logRR"</span>, 
       color <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="TIDYMODELSWFS_files/figure-html5/unnamed-chunk-52-1.png" width="624" /></p>
</div>
<h3 id="explainer">Explainer</h3>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#random forest model</span>
<span class='va'>explainer_rf_continous</span> <span class='op'>&lt;-</span> <span class='fu'>DALEX</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/DALEX/man/explain.html'>explain</a></span><span class='op'>(</span><span class='va'>rf_best_race_trained_wf</span>,
                        data <span class='op'>=</span> <span class='va'>af.train.wf</span>,
                        y <span class='op'>=</span> <span class='va'>af.train.wf</span><span class='op'>$</span><span class='va'>logRR</span>, 
                        label <span class='op'>=</span> <span class='st'>"Random Forest"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>Preparation of a new explainer is initiated
  -&gt; model label       :  Random Forest 
  -&gt; data              :  3615  rows  44  cols 
  -&gt; data              :  tibble converted into a data.frame 
  -&gt; target variable   :  3615  values 
  -&gt; predict function  :  yhat.workflow  will be used ( [33m default [39m )
  -&gt; predicted values  :  No value for predict function target column. ( [33m default [39m )
  -&gt; model_info        :  package tidymodels , ver. 0.1.3 , task regression ( [33m default [39m ) 
  -&gt; predicted values  :  numerical, min =  -1.010322 , mean =  0.3345509 , max =  2.071655  
  -&gt; residual function :  difference between y and yhat ( [33m default [39m )
  -&gt; residuals         :  numerical, min =  -2.327022 , mean =  0.0003935981 , max =  2.509131  
 [32m A new explainer has been created! [39m </code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>explainer_xgb_continous</span> <span class='op'>&lt;-</span> 
  <span class='fu'>DALEX</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/DALEX/man/explain.html'>explain</a></span><span class='op'>(</span><span class='va'>xgb_best_race_trained_wf</span>,
                        data <span class='op'>=</span> <span class='va'>af.train.wf</span>,
                        y <span class='op'>=</span> <span class='va'>af.train.wf</span><span class='op'>$</span><span class='va'>logRR</span>, 
                        label <span class='op'>=</span> <span class='st'>"XGBoost"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>Preparation of a new explainer is initiated
  -&gt; model label       :  XGBoost 
  -&gt; data              :  3615  rows  44  cols 
  -&gt; data              :  tibble converted into a data.frame 
  -&gt; target variable   :  3615  values 
  -&gt; predict function  :  yhat.workflow  will be used ( [33m default [39m )
  -&gt; predicted values  :  No value for predict function target column. ( [33m default [39m )
  -&gt; model_info        :  package tidymodels , ver. 0.1.3 , task regression ( [33m default [39m ) 
  -&gt; predicted values  :  numerical, min =  -0.9243527 , mean =  0.3381429 , max =  2.024677  
  -&gt; residual function :  difference between y and yhat ( [33m default [39m )
  -&gt; residuals         :  numerical, min =  -2.330118 , mean =  -0.003198396 , max =  2.511382  
 [32m A new explainer has been created! [39m </code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>explainer_cart_continous</span> <span class='op'>&lt;-</span> 
    <span class='fu'>DALEX</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/DALEX/man/explain.html'>explain</a></span><span class='op'>(</span><span class='va'>cart_best_race_trained_wf</span>,
                        data <span class='op'>=</span> <span class='va'>af.train.wf</span>,
                        y <span class='op'>=</span> <span class='va'>af.train.wf</span><span class='op'>$</span><span class='va'>logRR</span>, 
                        label <span class='op'>=</span> <span class='st'>"Cart"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>Preparation of a new explainer is initiated
  -&gt; model label       :  Cart 
  -&gt; data              :  3615  rows  44  cols 
  -&gt; data              :  tibble converted into a data.frame 
  -&gt; target variable   :  3615  values 
  -&gt; predict function  :  yhat.workflow  will be used ( [33m default [39m )
  -&gt; predicted values  :  No value for predict function target column. ( [33m default [39m )
  -&gt; model_info        :  package tidymodels , ver. 0.1.3 , task regression ( [33m default [39m ) 
  -&gt; predicted values  :  numerical, min =  -1.229517 , mean =  0.3349445 , max =  2.11079  
  -&gt; residual function :  difference between y and yhat ( [33m default [39m )
  -&gt; residuals         :  numerical, min =  -2.325893 , mean =  -9.650476e-17 , max =  2.508948  
 [32m A new explainer has been created! [39m </code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>rf_hist</span> <span class='op'>&lt;-</span> <span class='fu'>DALEX</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/DALEX/man/model_performance.html'>model_performance</a></span><span class='op'>(</span><span class='va'>explainer_rf_continous</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>rf_hist</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="TIDYMODELSWFS_files/figure-html5/unnamed-chunk-54-1.png" width="624" /></p>
</div>
<p>Model profile</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>model_profile_rf1</span> <span class='op'>&lt;-</span> <span class='fu'>model_profile</span><span class='op'>(</span><span class='va'>explainer_rf_continous</span>, type <span class='op'>=</span> <span class='st'>"partial"</span>, variables <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Bio01_MT_Annu"</span>, <span class='st'>"Bio02_MDR"</span>, <span class='st'>"Bio03_Iso"</span>, <span class='st'>"Bio04_TS"</span>, <span class='st'>"Bio05_TWM"</span>, <span class='st'>"Bio06_MinTCM"</span>, <span class='st'>"Bio07_TAR"</span>, <span class='st'>"Bio08_MT_WetQ"</span>, <span class='st'>"Bio09_MT_DryQ"</span>, <span class='st'>"Bio10_MT_WarQ"</span>, <span class='st'>"Bio11_MT_ColQ"</span>, <span class='st'>"Bio12_Pecip_Annu"</span>, <span class='st'>"Bio13_Precip_WetM"</span>, <span class='st'>"Bio14_Precip_DryM"</span>, <span class='st'>"Bio15_Precip_S"</span>, <span class='st'>"Bio16_Precip_WetQ"</span>, <span class='st'>"Bio17_Precip_DryQ"</span>, <span class='st'>"iSDA_Depth_to_bedrock"</span>, <span class='st'>"iSDA_SAND_conc"</span>, <span class='st'>"iSDA_CLAY_conc"</span>, <span class='st'>"iSDA_SILT_conc"</span>, <span class='st'>"iSDA_log_C_tot"</span>, <span class='st'>"iSDA_FE_Bulk_dens"</span>, <span class='st'>"iSDA_log_Ca"</span>, <span class='st'>"iSDA_log_eCEC"</span>, <span class='st'>"iSDA_log_Fe"</span>, <span class='st'>"iSDA_log_K"</span>, <span class='st'>"iSDA_log_Mg"</span>, <span class='st'>"iSDA_log_N"</span>,<span class='st'>"iSDA_log_SOC"</span>, <span class='st'>"iSDA_log_P"</span>, <span class='st'>"iSDA_log_S"</span>, <span class='st'>"iSDA_pH"</span>, <span class='st'>"ASTER_Slope"</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>model_profile_rf1</span>, variables <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Bio01_MT_Annu"</span>, <span class='st'>"Bio02_MDR"</span>, <span class='st'>"Bio03_Iso"</span>, <span class='st'>"Bio04_TS"</span>, <span class='st'>"Bio05_TWM"</span>, <span class='st'>"Bio06_MinTCM"</span>, <span class='st'>"Bio07_TAR"</span>, <span class='st'>"Bio08_MT_WetQ"</span>, <span class='st'>"Bio09_MT_DryQ"</span>, <span class='st'>"Bio10_MT_WarQ"</span>, <span class='st'>"Bio11_MT_ColQ"</span>, <span class='st'>"Bio12_Pecip_Annu"</span>, <span class='st'>"Bio13_Precip_WetM"</span>, <span class='st'>"Bio14_Precip_DryM"</span>, <span class='st'>"Bio15_Precip_S"</span>, <span class='st'>"Bio16_Precip_WetQ"</span>, <span class='st'>"Bio17_Precip_DryQ"</span>, <span class='st'>"iSDA_Depth_to_bedrock"</span>, <span class='st'>"iSDA_SAND_conc"</span>, <span class='st'>"iSDA_CLAY_conc"</span>, <span class='st'>"iSDA_SILT_conc"</span>, <span class='st'>"iSDA_log_C_tot"</span>, <span class='st'>"iSDA_FE_Bulk_dens"</span>, <span class='st'>"iSDA_log_Ca"</span>, <span class='st'>"iSDA_log_eCEC"</span>, <span class='st'>"iSDA_log_Fe"</span>, <span class='st'>"iSDA_log_K"</span>, <span class='st'>"iSDA_log_Mg"</span>, <span class='st'>"iSDA_log_N"</span>,<span class='st'>"iSDA_log_SOC"</span>, <span class='st'>"iSDA_log_P"</span>, <span class='st'>"iSDA_log_S"</span>, <span class='st'>"iSDA_pH"</span>, <span class='st'>"ASTER_Slope"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'>ggtitle</span><span class='op'>(</span><span class='st'>"Partial dependence profile "</span>, <span class='st'>""</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="TIDYMODELSWFS_files/figure-html5/unnamed-chunk-55-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>model_profile_xgb1</span> <span class='op'>&lt;-</span> <span class='fu'>model_profile</span><span class='op'>(</span><span class='va'>explainer_xgb_continous</span>, type <span class='op'>=</span> <span class='st'>"partial"</span>, variables <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Bio01_MT_Annu"</span>, <span class='st'>"Bio02_MDR"</span>, <span class='st'>"Bio03_Iso"</span>, <span class='st'>"Bio04_TS"</span>, <span class='st'>"Bio05_TWM"</span>, <span class='st'>"Bio06_MinTCM"</span>, <span class='st'>"Bio07_TAR"</span>, <span class='st'>"Bio08_MT_WetQ"</span>, <span class='st'>"Bio09_MT_DryQ"</span>, <span class='st'>"Bio10_MT_WarQ"</span>, <span class='st'>"Bio11_MT_ColQ"</span>, <span class='st'>"Bio12_Pecip_Annu"</span>, <span class='st'>"Bio13_Precip_WetM"</span>, <span class='st'>"Bio14_Precip_DryM"</span>, <span class='st'>"Bio15_Precip_S"</span>, <span class='st'>"Bio16_Precip_WetQ"</span>, <span class='st'>"Bio17_Precip_DryQ"</span>, <span class='st'>"iSDA_Depth_to_bedrock"</span>, <span class='st'>"iSDA_SAND_conc"</span>, <span class='st'>"iSDA_CLAY_conc"</span>, <span class='st'>"iSDA_SILT_conc"</span>, <span class='st'>"iSDA_log_C_tot"</span>, <span class='st'>"iSDA_FE_Bulk_dens"</span>, <span class='st'>"iSDA_log_Ca"</span>, <span class='st'>"iSDA_log_eCEC"</span>, <span class='st'>"iSDA_log_Fe"</span>, <span class='st'>"iSDA_log_K"</span>, <span class='st'>"iSDA_log_Mg"</span>, <span class='st'>"iSDA_log_N"</span>,<span class='st'>"iSDA_log_SOC"</span>, <span class='st'>"iSDA_log_P"</span>, <span class='st'>"iSDA_log_S"</span>, <span class='st'>"iSDA_pH"</span>, <span class='st'>"ASTER_Slope"</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>model_profile_xgb1</span>, variables <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Bio01_MT_Annu"</span>, <span class='st'>"Bio02_MDR"</span>, <span class='st'>"Bio03_Iso"</span>, <span class='st'>"Bio04_TS"</span>, <span class='st'>"Bio05_TWM"</span>, <span class='st'>"Bio06_MinTCM"</span>, <span class='st'>"Bio07_TAR"</span>, <span class='st'>"Bio08_MT_WetQ"</span>, <span class='st'>"Bio09_MT_DryQ"</span>, <span class='st'>"Bio10_MT_WarQ"</span>, <span class='st'>"Bio11_MT_ColQ"</span>, <span class='st'>"Bio12_Pecip_Annu"</span>, <span class='st'>"Bio13_Precip_WetM"</span>, <span class='st'>"Bio14_Precip_DryM"</span>, <span class='st'>"Bio15_Precip_S"</span>, <span class='st'>"Bio16_Precip_WetQ"</span>, <span class='st'>"Bio17_Precip_DryQ"</span>, <span class='st'>"iSDA_Depth_to_bedrock"</span>, <span class='st'>"iSDA_SAND_conc"</span>, <span class='st'>"iSDA_CLAY_conc"</span>, <span class='st'>"iSDA_SILT_conc"</span>, <span class='st'>"iSDA_log_C_tot"</span>, <span class='st'>"iSDA_FE_Bulk_dens"</span>, <span class='st'>"iSDA_log_Ca"</span>, <span class='st'>"iSDA_log_eCEC"</span>, <span class='st'>"iSDA_log_Fe"</span>, <span class='st'>"iSDA_log_K"</span>, <span class='st'>"iSDA_log_Mg"</span>, <span class='st'>"iSDA_log_N"</span>,<span class='st'>"iSDA_log_SOC"</span>, <span class='st'>"iSDA_log_P"</span>, <span class='st'>"iSDA_log_S"</span>, <span class='st'>"iSDA_pH"</span>, <span class='st'>"ASTER_Slope"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'>ggtitle</span><span class='op'>(</span><span class='st'>"Partial dependence profile "</span>, <span class='st'>""</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="TIDYMODELSWFS_files/figure-html5/unnamed-chunk-56-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>model_profile_cart1</span> <span class='op'>&lt;-</span> <span class='fu'>model_profile</span><span class='op'>(</span><span class='va'>explainer_cart_continous</span>, type <span class='op'>=</span> <span class='st'>"partial"</span>, variables <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Bio01_MT_Annu"</span>, <span class='st'>"Bio02_MDR"</span>, <span class='st'>"Bio03_Iso"</span>, <span class='st'>"Bio04_TS"</span>, <span class='st'>"Bio05_TWM"</span>, <span class='st'>"Bio06_MinTCM"</span>, <span class='st'>"Bio07_TAR"</span>, <span class='st'>"Bio08_MT_WetQ"</span>, <span class='st'>"Bio09_MT_DryQ"</span>, <span class='st'>"Bio10_MT_WarQ"</span>, <span class='st'>"Bio11_MT_ColQ"</span>, <span class='st'>"Bio12_Pecip_Annu"</span>, <span class='st'>"Bio13_Precip_WetM"</span>, <span class='st'>"Bio14_Precip_DryM"</span>, <span class='st'>"Bio15_Precip_S"</span>, <span class='st'>"Bio16_Precip_WetQ"</span>, <span class='st'>"Bio17_Precip_DryQ"</span>, <span class='st'>"iSDA_Depth_to_bedrock"</span>, <span class='st'>"iSDA_SAND_conc"</span>, <span class='st'>"iSDA_CLAY_conc"</span>, <span class='st'>"iSDA_SILT_conc"</span>, <span class='st'>"iSDA_log_C_tot"</span>, <span class='st'>"iSDA_FE_Bulk_dens"</span>, <span class='st'>"iSDA_log_Ca"</span>, <span class='st'>"iSDA_log_eCEC"</span>, <span class='st'>"iSDA_log_Fe"</span>, <span class='st'>"iSDA_log_K"</span>, <span class='st'>"iSDA_log_Mg"</span>, <span class='st'>"iSDA_log_N"</span>,<span class='st'>"iSDA_log_SOC"</span>, <span class='st'>"iSDA_log_P"</span>, <span class='st'>"iSDA_log_S"</span>, <span class='st'>"iSDA_pH"</span>, <span class='st'>"ASTER_Slope"</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>model_profile_cart1</span>, variables <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Bio01_MT_Annu"</span>, <span class='st'>"Bio02_MDR"</span>, <span class='st'>"Bio03_Iso"</span>, <span class='st'>"Bio04_TS"</span>, <span class='st'>"Bio05_TWM"</span>, <span class='st'>"Bio06_MinTCM"</span>, <span class='st'>"Bio07_TAR"</span>, <span class='st'>"Bio08_MT_WetQ"</span>, <span class='st'>"Bio09_MT_DryQ"</span>, <span class='st'>"Bio10_MT_WarQ"</span>, <span class='st'>"Bio11_MT_ColQ"</span>, <span class='st'>"Bio12_Pecip_Annu"</span>, <span class='st'>"Bio13_Precip_WetM"</span>, <span class='st'>"Bio14_Precip_DryM"</span>, <span class='st'>"Bio15_Precip_S"</span>, <span class='st'>"Bio16_Precip_WetQ"</span>, <span class='st'>"Bio17_Precip_DryQ"</span>, <span class='st'>"iSDA_Depth_to_bedrock"</span>, <span class='st'>"iSDA_SAND_conc"</span>, <span class='st'>"iSDA_CLAY_conc"</span>, <span class='st'>"iSDA_SILT_conc"</span>, <span class='st'>"iSDA_log_C_tot"</span>, <span class='st'>"iSDA_FE_Bulk_dens"</span>, <span class='st'>"iSDA_log_Ca"</span>, <span class='st'>"iSDA_log_eCEC"</span>, <span class='st'>"iSDA_log_Fe"</span>, <span class='st'>"iSDA_log_K"</span>, <span class='st'>"iSDA_log_Mg"</span>, <span class='st'>"iSDA_log_N"</span>,<span class='st'>"iSDA_log_SOC"</span>, <span class='st'>"iSDA_log_P"</span>, <span class='st'>"iSDA_log_S"</span>, <span class='st'>"iSDA_pH"</span>, <span class='st'>"ASTER_Slope"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'>ggtitle</span><span class='op'>(</span><span class='st'>"Partial dependence profile "</span>, <span class='st'>""</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="TIDYMODELSWFS_files/figure-html5/unnamed-chunk-57-1.png" width="624" /></p>
</div>
<p>#Compare models with common important variables</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#Compare models with common important variables </span>
<span class='va'>model_profile_rf1</span> <span class='op'>&lt;-</span> <span class='fu'>model_profile</span><span class='op'>(</span><span class='va'>explainer_rf_continous</span>, variables <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Bio01_MT_Annu"</span>, <span class='st'>"Bio02_MDR"</span>, <span class='st'>"Bio03_Iso"</span>, <span class='st'>"Bio04_TS"</span>, <span class='st'>"Bio05_TWM"</span>, <span class='st'>"Bio06_MinTCM"</span>, <span class='st'>"Bio07_TAR"</span>, <span class='st'>"Bio08_MT_WetQ"</span>, <span class='st'>"Bio09_MT_DryQ"</span>, <span class='st'>"Bio10_MT_WarQ"</span>, <span class='st'>"Bio11_MT_ColQ"</span>, <span class='st'>"Bio12_Pecip_Annu"</span>, <span class='st'>"Bio13_Precip_WetM"</span>, <span class='st'>"Bio14_Precip_DryM"</span>, <span class='st'>"Bio15_Precip_S"</span>, <span class='st'>"Bio16_Precip_WetQ"</span>, <span class='st'>"Bio17_Precip_DryQ"</span>, <span class='st'>"iSDA_Depth_to_bedrock"</span>, <span class='st'>"iSDA_SAND_conc"</span>, <span class='st'>"iSDA_CLAY_conc"</span>, <span class='st'>"iSDA_SILT_conc"</span>, <span class='st'>"iSDA_log_C_tot"</span>, <span class='st'>"iSDA_FE_Bulk_dens"</span>, <span class='st'>"iSDA_log_Ca"</span>, <span class='st'>"iSDA_log_eCEC"</span>, <span class='st'>"iSDA_log_Fe"</span>, <span class='st'>"iSDA_log_K"</span>, <span class='st'>"iSDA_log_Mg"</span>, <span class='st'>"iSDA_log_N"</span>,<span class='st'>"iSDA_log_SOC"</span>, <span class='st'>"iSDA_log_P"</span>, <span class='st'>"iSDA_log_S"</span>, <span class='st'>"iSDA_pH"</span>, <span class='st'>"ASTER_Slope"</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>model_profile_xgb1</span> <span class='op'>&lt;-</span> <span class='fu'>model_profile</span><span class='op'>(</span><span class='va'>explainer_xgb_continous</span>, variables <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Bio01_MT_Annu"</span>, <span class='st'>"Bio02_MDR"</span>, <span class='st'>"Bio03_Iso"</span>, <span class='st'>"Bio04_TS"</span>, <span class='st'>"Bio05_TWM"</span>, <span class='st'>"Bio06_MinTCM"</span>, <span class='st'>"Bio07_TAR"</span>, <span class='st'>"Bio08_MT_WetQ"</span>, <span class='st'>"Bio09_MT_DryQ"</span>, <span class='st'>"Bio10_MT_WarQ"</span>, <span class='st'>"Bio11_MT_ColQ"</span>, <span class='st'>"Bio12_Pecip_Annu"</span>, <span class='st'>"Bio13_Precip_WetM"</span>, <span class='st'>"Bio14_Precip_DryM"</span>, <span class='st'>"Bio15_Precip_S"</span>, <span class='st'>"Bio16_Precip_WetQ"</span>, <span class='st'>"Bio17_Precip_DryQ"</span>, <span class='st'>"iSDA_Depth_to_bedrock"</span>, <span class='st'>"iSDA_SAND_conc"</span>, <span class='st'>"iSDA_CLAY_conc"</span>, <span class='st'>"iSDA_SILT_conc"</span>, <span class='st'>"iSDA_log_C_tot"</span>, <span class='st'>"iSDA_FE_Bulk_dens"</span>, <span class='st'>"iSDA_log_Ca"</span>, <span class='st'>"iSDA_log_eCEC"</span>, <span class='st'>"iSDA_log_Fe"</span>, <span class='st'>"iSDA_log_K"</span>, <span class='st'>"iSDA_log_Mg"</span>, <span class='st'>"iSDA_log_N"</span>,<span class='st'>"iSDA_log_SOC"</span>, <span class='st'>"iSDA_log_P"</span>, <span class='st'>"iSDA_log_S"</span>, <span class='st'>"iSDA_pH"</span>, <span class='st'>"ASTER_Slope"</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>model_profile_cart1</span> <span class='op'>&lt;-</span> <span class='fu'>model_profile</span><span class='op'>(</span><span class='va'>explainer_cart_continous</span>, variables <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Bio01_MT_Annu"</span>, <span class='st'>"Bio02_MDR"</span>, <span class='st'>"Bio03_Iso"</span>, <span class='st'>"Bio04_TS"</span>, <span class='st'>"Bio05_TWM"</span>, <span class='st'>"Bio06_MinTCM"</span>, <span class='st'>"Bio07_TAR"</span>, <span class='st'>"Bio08_MT_WetQ"</span>, <span class='st'>"Bio09_MT_DryQ"</span>, <span class='st'>"Bio10_MT_WarQ"</span>, <span class='st'>"Bio11_MT_ColQ"</span>, <span class='st'>"Bio12_Pecip_Annu"</span>, <span class='st'>"Bio13_Precip_WetM"</span>, <span class='st'>"Bio14_Precip_DryM"</span>, <span class='st'>"Bio15_Precip_S"</span>, <span class='st'>"Bio16_Precip_WetQ"</span>, <span class='st'>"Bio17_Precip_DryQ"</span>, <span class='st'>"iSDA_Depth_to_bedrock"</span>, <span class='st'>"iSDA_SAND_conc"</span>, <span class='st'>"iSDA_CLAY_conc"</span>, <span class='st'>"iSDA_SILT_conc"</span>, <span class='st'>"iSDA_log_C_tot"</span>, <span class='st'>"iSDA_FE_Bulk_dens"</span>, <span class='st'>"iSDA_log_Ca"</span>, <span class='st'>"iSDA_log_eCEC"</span>, <span class='st'>"iSDA_log_Fe"</span>, <span class='st'>"iSDA_log_K"</span>, <span class='st'>"iSDA_log_Mg"</span>, <span class='st'>"iSDA_log_N"</span>,<span class='st'>"iSDA_log_SOC"</span>, <span class='st'>"iSDA_log_P"</span>, <span class='st'>"iSDA_log_S"</span>, <span class='st'>"iSDA_pH"</span>, <span class='st'>"ASTER_Slope"</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>model_profile_rf1</span>, <span class='va'>model_profile_xgb1</span>, <span class='va'>model_profile_cart1</span>, 
    variables <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Bio01_MT_Annu"</span>, <span class='st'>"Bio02_MDR"</span>, <span class='st'>"Bio03_Iso"</span>, <span class='st'>"Bio04_TS"</span>, <span class='st'>"Bio05_TWM"</span>, <span class='st'>"Bio06_MinTCM"</span>, <span class='st'>"Bio07_TAR"</span>, <span class='st'>"Bio08_MT_WetQ"</span>, <span class='st'>"Bio09_MT_DryQ"</span>, <span class='st'>"Bio10_MT_WarQ"</span>, <span class='st'>"Bio11_MT_ColQ"</span>, <span class='st'>"Bio12_Pecip_Annu"</span>, <span class='st'>"Bio13_Precip_WetM"</span>, <span class='st'>"Bio14_Precip_DryM"</span>, <span class='st'>"Bio15_Precip_S"</span>, <span class='st'>"Bio16_Precip_WetQ"</span>, <span class='st'>"Bio17_Precip_DryQ"</span>, <span class='st'>"iSDA_Depth_to_bedrock"</span>, <span class='st'>"iSDA_SAND_conc"</span>, <span class='st'>"iSDA_CLAY_conc"</span>, <span class='st'>"iSDA_SILT_conc"</span>, <span class='st'>"iSDA_log_C_tot"</span>, <span class='st'>"iSDA_FE_Bulk_dens"</span>, <span class='st'>"iSDA_log_Ca"</span>, <span class='st'>"iSDA_log_eCEC"</span>, <span class='st'>"iSDA_log_Fe"</span>, <span class='st'>"iSDA_log_K"</span>, <span class='st'>"iSDA_log_Mg"</span>, <span class='st'>"iSDA_log_N"</span>,<span class='st'>"iSDA_log_SOC"</span>, <span class='st'>"iSDA_log_P"</span>, <span class='st'>"iSDA_log_S"</span>, <span class='st'>"iSDA_pH"</span>, <span class='st'>"ASTER_Slope"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'>ggtitle</span><span class='op'>(</span><span class='st'>"Partial dependence profile "</span>, <span class='st'>""</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="TIDYMODELSWFS_files/figure-html5/unnamed-chunk-58-1.png" width="624" /></p>
</div>
<p>“Bio01_MT_Annu,” “Bio02_MDR,” “Bio03_Iso,” “Bio04_TS,” “Bio05_TWM,” “Bio06_MinTCM,” “Bio07_TAR,” “Bio08_MT_WetQ,” “Bio09_MT_DryQ,” “Bio10_MT_WarQ,” “Bio11_MT_ColQ,” “Bio12_Pecip_Annu,” “Bio13_Precip_WetM,” “Bio14_Precip_DryM,” “Bio15_Precip_S,” “Bio16_Precip_WetQ,” “Bio17_Precip_DryQ,” “iSDA_Depth_to_bedrock,” “iSDA_SAND_conc,” “iSDA_CLAY_conc,” “iSDA_SILT_conc,” “iSDA_log_C_tot,” “iSDA_FE_Bulk_dens,” “iSDA_log_Ca,” “iSDA_log_eCEC,” “iSDA_log_Fe,” “iSDA_log_K,” “iSDA_log_Mg,” “iSDA_log_N,”“iSDA_log_SOC,” “iSDA_log_P,” “iSDA_log_S,” “iSDA_pH,” “ASTER_Slope”</p>
<p>Instance level</p>
<h1 id="random-forest">Random forest</h1>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>bd_rf_logRR_low</span> <span class='op'>&lt;-</span> 
  <span class='fu'>predict_parts</span><span class='op'>(</span>explainer <span class='op'>=</span> <span class='va'>explainer_rf_continous</span>,
                new_observation <span class='op'>=</span> <span class='va'>obs_1</span>, 
                type <span class='op'>=</span> <span class='st'>"break_down"</span><span class='op'>)</span> 

<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>bd_rf_logRR_low</span>,
     max_features <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>ggtitle</span><span class='op'>(</span><span class='st'>"Break Down profile for Agroforestry Pruning-Alleycropping with a low observed logRR value (-1.82)"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>panel.grid <span class='op'>=</span> <span class='fu'>element_blank</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> 
</code></pre>
</div>
</details>
<p><img src="TIDYMODELSWFS_files/figure-html5/unnamed-chunk-59-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sharp_rf_logRR_low</span> <span class='op'>&lt;-</span> 
  <span class='fu'>predict_parts</span><span class='op'>(</span>explainer <span class='op'>=</span> <span class='va'>explainer_rf_continous</span>,
                new_observation <span class='op'>=</span> <span class='va'>obs_1</span>, 
                type <span class='op'>=</span> <span class='st'>"shap"</span>,
                B <span class='op'>=</span> <span class='fl'>25</span><span class='op'>)</span>
  
  <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>sharp_rf_logRR_low</span>,
       max_features <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span> 
</code></pre>
</div>
</details>
<p><img src="TIDYMODELSWFS_files/figure-html5/unnamed-chunk-60-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>bd_rf_logRR_high</span> <span class='op'>&lt;-</span> 
  <span class='fu'>predict_parts</span><span class='op'>(</span>explainer <span class='op'>=</span> <span class='va'>explainer_rf_continous</span>,
                new_observation <span class='op'>=</span> <span class='va'>obs_2</span>, 
                type <span class='op'>=</span> <span class='st'>"break_down"</span><span class='op'>)</span> 

  <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>bd_rf_logRR_high</span>,
       max_features <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>ggtitle</span><span class='op'>(</span><span class='st'>"Break Down profile for Agroforestry Pruning-Alleycropping with a high observed logRR value (3.04)"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>panel.grid <span class='op'>=</span> <span class='fu'>element_blank</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> 
</code></pre>
</div>
</details>
<p><img src="TIDYMODELSWFS_files/figure-html5/unnamed-chunk-61-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sharp_rf_logRR_high</span> <span class='op'>&lt;-</span> 
  <span class='fu'>predict_parts</span><span class='op'>(</span>explainer <span class='op'>=</span> <span class='va'>explainer_rf_continous</span>,
                new_observation <span class='op'>=</span> <span class='va'>obs_2</span>, 
                type <span class='op'>=</span> <span class='st'>"shap"</span>,
                B <span class='op'>=</span> <span class='fl'>25</span><span class='op'>)</span>
  
  <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>sharp_rf_logRR_high</span>,
       max_features <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span> 
</code></pre>
</div>
</details>
<p><img src="TIDYMODELSWFS_files/figure-html5/unnamed-chunk-62-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>obs_1</span>
</code></pre>
</div>
</details>
<pre><code># A tibble: 1 × 43
  PrName   Out.SubInd Product Tree  Out.SubInd.Code Site.Type Latitude
  &lt;fct&gt;    &lt;fct&gt;      &lt;fct&gt;   &lt;fct&gt; &lt;fct&gt;           &lt;fct&gt;        &lt;dbl&gt;
1 Agrofor… Crop Yield Maize   Senn… CrY             Station      -1.58
# … with 36 more variables: Longitude &lt;dbl&gt;, Bio01_MT_Annu &lt;dbl&gt;,
#   Bio02_MDR &lt;dbl&gt;, Bio03_Iso &lt;dbl&gt;, Bio04_TS &lt;dbl&gt;,
#   Bio05_TWM &lt;dbl&gt;, Bio06_MinTCM &lt;dbl&gt;, Bio07_TAR &lt;dbl&gt;,
#   Bio08_MT_WetQ &lt;dbl&gt;, Bio09_MT_DryQ &lt;dbl&gt;, Bio10_MT_WarQ &lt;dbl&gt;,
#   Bio11_MT_ColQ &lt;dbl&gt;, Bio12_Pecip_Annu &lt;dbl&gt;,
#   Bio13_Precip_WetM &lt;dbl&gt;, Bio14_Precip_DryM &lt;dbl&gt;,
#   Bio15_Precip_S &lt;dbl&gt;, Bio16_Precip_WetQ &lt;dbl&gt;, …</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>ml.data.no.outliers.wf</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>sapply</a></span><span class='op'>(</span><span class='va'>levels</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>$PrName
 [1] &quot;Parklands&quot;                                                  
 [2] &quot;Agroforestry Pruning-Organic Fertilizer&quot;                    
 [3] &quot;Agroforestry Pruning&quot;                                       
 [4] &quot;Agroforestry Pruning-Inorganic Fertilizer&quot;                  
 [5] &quot;Agroforestry Pruning-Alleycropping&quot;                         
 [6] &quot;Alleycropping&quot;                                              
 [7] &quot;Agroforestry Pruning-Alleycropping-Inorganic Fertilizer&quot;    
 [8] &quot;Alleycropping-Inorganic Fertilizer&quot;                         
 [9] &quot;Agroforestry Pruning-Alleycropping-Organic Fertilizer&quot;      
[10] &quot;Agroforestry Pruning-Alleycropping-Reduced Tillage&quot;         
[11] &quot;Agroforestry Pruning-Parklands&quot;                             
[12] &quot;Agroforestry Pruning-Boundary Planting&quot;                     
[13] &quot;Agroforestry Pruning-Boundary Planting-Inorganic Fertilizer&quot;
[14] &quot;Agroforestry Fallow-Agroforestry Pruning&quot;                   
[15] &quot;Agroforestry Fallow-Agroforestry Pruning-Alleycropping&quot;     
[16] &quot;Agroforestry Pruning-Alleycropping-Intercropping&quot;           
[17] &quot;Agroforestry Pruning-Green Manure&quot;                          
[18] &quot;Agroforestry Pruning-Green Manure-Inorganic Fertilizer&quot;     
[19] &quot;Agroforestry Fallow&quot;                                        
[20] &quot;Agroforestry Fallow-Water Harvesting&quot;                       
[21] &quot;Agroforestry Fallow-Agroforestry Pruning-Reduced Tillage&quot;   
[22] &quot;Agroforestry Pruning-Intercropping&quot;                         
[23] &quot;Other Agroforestry&quot;                                         
[24] &quot;Mulch-Other Agroforestry-Reduced Tillage&quot;                   
[25] &quot;Agroforestry Pruning-Reduced Tillage-Water Harvesting&quot;      

$Out.SubInd
 [1] &quot;Biomass Yield&quot;                      
 [2] &quot;Soil Organic Carbon&quot;                
 [3] &quot;Soil Nitrogen&quot;                      
 [4] &quot;Crop Yield&quot;                         
 [5] &quot;Carbon Dioxide Emissions&quot;           
 [6] &quot;Gross Return&quot;                       
 [7] &quot;Marginal Rate of Return&quot;            
 [8] &quot;Beneficial Organisms&quot;               
 [9] &quot;Nitrogen Use Efficiency (ARE AGB)&quot;  
[10] &quot;Cation Exchange Capacity&quot;           
[11] &quot;Phosphorus Use Efficiency (ARE AGB)&quot;
[12] &quot;Potassium Use Efficiency (ARE AGB)&quot; 
[13] &quot;Soil Organic Carbon (Change)&quot;       
[14] &quot;Water Use Efficiency&quot;               
[15] &quot;Soil Moisture&quot;                      
[16] &quot;Labour Person Hours&quot;                
[17] &quot;Labour Cost&quot;                        
[18] &quot;Variable Cost&quot;                      
[19] &quot;Net Return&quot;                         
[20] &quot;Benefit Cost Ratio (NRTC)&quot;          
[21] &quot;Return to Labour&quot;                   
[22] &quot;Gross Margin&quot;                       
[23] &quot;Benefit Cost Ratio (GRVC)&quot;          
[24] &quot;Net Present Value&quot;                  
[25] &quot;Biodiversity&quot;                       
[26] &quot;Phosphorus Agronomic Efficiency&quot;    
[27] &quot;Soil Organic Matter&quot;                
[28] &quot;Nitrogen Factor Productivity&quot;       
[29] &quot;Water Use&quot;                          
[30] &quot;Infiltration Rate&quot;                  
[31] &quot;Runoff&quot;                             
[32] &quot;Erosion&quot;                            
[33] &quot;Soil Total Nitrogen&quot;                
[34] &quot;Soil Carbon Stocks&quot;                 
[35] &quot;Soil Available Nitrogen&quot;            
[36] &quot;Nitrous Oxide Emissions&quot;            
[37] &quot;Methane Emissions&quot;                  
[38] &quot;CO2 Equivalent Emissions&quot;           
[39] &quot;Benefit Cost Ratio (GRTC)&quot;          
[40] &quot;Soil NH4&quot;                           
[41] &quot;Soil NO3&quot;                           
[42] &quot;Land Equivalent Ratio&quot;              

$Product
 [1] &quot;Pearl Millet&quot;         &quot;Maize&quot;               
 [3] &quot;Wheat&quot;                &quot;Sorghum&quot;             
 [5] &quot;Tomato (Total Yield)&quot; &quot;Common Bean&quot;         
 [7] &quot;Okra&quot;                 &quot;Spinach&quot;             
 [9] &quot;Sunflower (Seed)&quot;     &quot;Rice&quot;                
[11] &quot;Sunflower (Oil)&quot;      &quot;Sesame Seed&quot;         
[13] &quot;Eggplant&quot;             &quot;Barley&quot;              
[15] &quot;Finger Millet&quot;        &quot;Soybean&quot;             

$Site.Type
[1] &quot;Farm&quot;    &quot;Station&quot; &quot;Survey&quot; 

$Tree
  [1] &quot;Faidherbia albida&quot;                                                      
  [2] &quot;Aristida sieberiana&quot;                                                    
  [3] &quot;Guiera senegalensis&quot;                                                    
  [4] &quot;Calliandra calothyrsus&quot;                                                 
  [5] &quot;Sesbania sesban&quot;                                                        
  [6] &quot;Leucaena leucocephala&quot;                                                  
  [7] &quot;Leucaena pallida&quot;                                                       
  [8] &quot;Acacia albida&quot;                                                          
  [9] &quot;Albizia gummifera&quot;                                                      
 [10] &quot;Cordia africana&quot;                                                        
 [11] &quot;Croton macrostachyus&quot;                                                   
 [12] &quot;Milletia ferruginea&quot;                                                    
 [13] &quot;Gliricidia sepium&quot;                                                      
 [14] &quot;Unknown_Tree&quot;                                                           
 [15] &quot;Alnus acuminata&quot;                                                        
 [16] &quot;Alnus acuminata.Calliandra calothyrsus.Sesbania sesban&quot;                 
 [17] &quot;Calliandra calothyrsus.Leucaena leucocephala&quot;                           
 [18] &quot;Crotalaria juncea&quot;                                                      
 [19] &quot;Cupressus lusitanica&quot;                                                   
 [20] &quot;Casuarina equisetifolia&quot;                                                
 [21] &quot;Markhamia lutea&quot;                                                        
 [22] &quot;Melia azedarach&quot;                                                        
 [23] &quot;Cordia abyssinica&quot;                                                      
 [24] &quot;Maesopsis eminii&quot;                                                       
 [25] &quot;Senna spectabilis&quot;                                                      
 [26] &quot;Tithonia diversifolia&quot;                                                  
 [27] &quot;Acacia tumida&quot;                                                          
 [28] &quot;Eucalyptus saligna&quot;                                                     
 [29] &quot;Flemingia macrophylla&quot;                                                  
 [30] &quot;Senna siamea&quot;                                                           
 [31] &quot;Leucaena leucocephala.Gliricidia Sepium&quot;                                
 [32] &quot;Croton megalocarpus&quot;                                                    
 [33] &quot;Melia volkensii&quot;                                                        
 [34] &quot;Croton megalocarpus.Melia volkensii.Senna spectabilis.Gliricidia sepium&quot;
 [35] &quot;Pinus patula&quot;                                                           
 [36] &quot;Acacia saligna&quot;                                                         
 [37] &quot;Crotalaria grahamiana&quot;                                                  
 [38] &quot;Grevillea robusta&quot;                                                      
 [39] &quot;Paulownia fortunei&quot;                                                     
 [40] &quot;Entada abyssinica&quot;                                                      
 [41] &quot;Dactyladenia barteri&quot;                                                   
 [42] &quot;Gliricidia&quot;                                                             
 [43] &quot;Flemingia&quot;                                                              
 [44] &quot;Cinnamomum cassia&quot;                                                      
 [45] &quot;Flemingia congesta&quot;                                                     
 [46] &quot;Cassia siamea&quot;                                                          
 [47] &quot;cassia siamea&quot;                                                          
 [48] &quot;Leucaena leucocephala.Acioa barteri&quot;                                    
 [49] &quot;Acioa barteri&quot;                                                          
 [50] &quot;Azadirachta indica&quot;                                                     
 [51] &quot;Parkia biglobosa&quot;                                                       
 [52] &quot;Millettia  thonningii&quot;                                                  
 [53] &quot;Pterocarpus santalinoides&quot;                                              
 [54] &quot;Acacia angustissima&quot;                                                    
 [55] &quot;Tithonia diversifolia.Acacia angustissima&quot;                              
 [56] &quot;Tithonia diversifolia.Calliandra calothyrsus&quot;                           
 [57] &quot;Tithonia diversifolia.Flemingia macrophylla&quot;                            
 [58] &quot;Elaeis guineensis&quot;                                                      
 [59] &quot;Leucaena leucocephala (Var K28)&quot;                                        
 [60] &quot;Cajanus cajan&quot;                                                          
 [61] &quot;Leucaena.Azadirachta indica.Parkia biglobosa&quot;                           
 [62] &quot;Senna siamea.Leucaena leucocephala.Azadirachta indica&quot;                  
 [63] &quot;Vitellaria paradoxa.Parkia biglobosa&quot;                                   
 [64] &quot;Vitellaria paradoxa&quot;                                                    
 [65] &quot;Parkia biglobosa.Vitellaria paradoxa&quot;                                   
 [66] &quot;Parkia biglobosa.Adansonia digitata&quot;                                    
 [67] &quot;Stylosanthes hamata&quot;                                                    
 [68] &quot;Adansonia digitata&quot;                                                     
 [69] &quot;Albizia lebbeck&quot;                                                        
 [70] &quot;Acacia holosericea&quot;                                                     
 [71] &quot;Palm&quot;                                                                   
 [72] &quot;Acacia senegal&quot;                                                         
 [73] &quot;Acacia crassicarpa&quot;                                                     
 [74] &quot;Acacia mangium&quot;                                                         
 [75] &quot;Acacia polyacantha&quot;                                                     
 [76] &quot;Leucaena diversifolia&quot;                                                  
 [77] &quot;Tephrosia vogelii.Sesbania sesban&quot;                                      
 [78] &quot;Alchornea cordifolia&quot;                                                   
 [79] &quot;Uapaca kirkiana.Brachystegia spiciformis.Julbernardia globiflora&quot;       
 [80] &quot;Uapaca kirkiana&quot;                                                        
 [81] &quot;Sesbania rostrata&quot;                                                      
 [82] &quot;Cassia spectabilis&quot;                                                     
 [83] &quot;Grevillea robusta.Cajanus cajan&quot;                                        
 [84] &quot;Tephrosia vogelii&quot;                                                      
 [85] &quot;Sesbania cinerascens&quot;                                                   
 [86] &quot;Senna didymobotrya&quot;                                                     
 [87] &quot;Senna occidentalis&quot;                                                     
 [88] &quot;Eucalyptus camaldulensis&quot;                                               
 [89] &quot;Pueraria phaseoloides&quot;                                                  
 [90] &quot;Acacia leptocarpa&quot;                                                      
 [91] &quot;Gliricida sepium&quot;                                                       
 [92] &quot;Flemingia macrophylla.Gliricidia sepium&quot;                                
 [93] &quot;Cedrela serrata&quot;                                                        
 [94] &quot;Acrocarpus fraxinifolius&quot;                                               
 [95] &quot;Cedrela odorata&quot;                                                        
 [96] &quot;Erythrina poeppigiana&quot;                                                  
 [97] &quot;Albizia chinensis&quot;                                                      
 [98] &quot;Piliostigma reticulatum&quot;                                                
 [99] &quot;Poupartia silvatica-Fernandoa madagascariensis-Tarenna sp&quot;              
[100] &quot;Acacia tortilis&quot;                                                        
[101] &quot;Crotalaria ochrolueca&quot;                                                  
[102] &quot;Desmodium intortum&quot;                                                     
[103] &quot;Bauhinia reticulata&quot;                                                    
[104] &quot;Bauhinia reticulata-Guiera senegalensis&quot;                                
[105] &quot;Acacia sp&quot;                                                              

$Out.SubInd.Code
 [1] &quot;BiY&quot;      &quot;SOC&quot;      &quot;SN&quot;       &quot;CrY&quot;      &quot;CO2&quot;      &quot;GR&quot;      
 [7] &quot;MRR&quot;      &quot;BO&quot;       &quot;NUE-Aag&quot;  &quot;CEC&quot;      &quot;PUE-Aag&quot;  &quot;KUE-Aag&quot; 
[13] &quot;SOCh&quot;     &quot;WUE&quot;      &quot;SM&quot;       &quot;La-ph&quot;    &quot;LC&quot;       &quot;VC&quot;      
[19] &quot;NR&quot;       &quot;BCR-NRTC&quot; &quot;RtL&quot;      &quot;GM&quot;       &quot;BCR-GRVC&quot; &quot;NOV&quot;     
[25] &quot;Bd&quot;       &quot;PAEp&quot;     &quot;SOM&quot;      &quot;NTFP&quot;     &quot;WU&quot;       &quot;In&quot;      
[31] &quot;Ru&quot;       &quot;Er&quot;       &quot;STN&quot;      &quot;SCS&quot;      &quot;SAN&quot;      &quot;NOx&quot;     
[37] &quot;CH4&quot;      &quot;CO2eq&quot;    &quot;BCR-GRTC&quot; &quot;SNH4&quot;     &quot;SNO3&quot;     &quot;LER&quot;     

$Latitude
NULL

$Longitude
NULL

$Bio01_MT_Annu
NULL

$Bio02_MDR
NULL

$Bio03_Iso
NULL

$Bio04_TS
NULL

$Bio05_TWM
NULL

$Bio06_MinTCM
NULL

$Bio07_TAR
NULL

$Bio08_MT_WetQ
NULL

$Bio09_MT_DryQ
NULL

$Bio10_MT_WarQ
NULL

$Bio11_MT_ColQ
NULL

$Bio12_Pecip_Annu
NULL

$Bio13_Precip_WetM
NULL

$Bio14_Precip_DryM
NULL

$Bio15_Precip_S
NULL

$Bio16_Precip_WetQ
NULL

$Bio17_Precip_DryQ
NULL

$iSDA_Depth_to_bedrock
NULL

$iSDA_SAND_conc
NULL

$iSDA_CLAY_conc
NULL

$iSDA_SILT_conc
NULL

$iSDA_FE_Bulk_dens
NULL

$iSDA_log_C_tot
NULL

$iSDA_log_Ca
NULL

$iSDA_log_eCEC
NULL

$iSDA_log_Fe
NULL

$iSDA_log_K
NULL

$iSDA_log_Mg
NULL

$iSDA_log_N
NULL

$iSDA_log_SOC
NULL

$iSDA_log_P
NULL

$iSDA_log_S
NULL

$iSDA_pH
NULL

$ASTER_Altitude
NULL

$ASTER_Slope
NULL

$logRR
NULL</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>new_obs_1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>PrName <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='st'>"Agroforestry Pruning-Alleycropping"</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Parklands"</span>, <span class='st'>"Agroforestry Pruning-Organic Fertilizer"</span>, 
                                                                                          <span class='st'>"Agroforestry Pruning"</span>, <span class='st'>"Agroforestry Pruning-Inorganic Fertilizer"</span>, 
                                                                                          <span class='st'>"Agroforestry Pruning-Alleycropping"</span>, <span class='st'>"Alleycropping"</span>, 
                                                                                          <span class='st'>"Agroforestry Pruning-Alleycropping-Inorganic Fertilizer"</span>, 
                                                                                          <span class='st'>"Alleycropping-Inorganic Fertilizer"</span>, <span class='st'>"Agroforestry Pruning-Alleycropping-Organic Fertilizer"</span>,
                                                                                          <span class='st'>"Agroforestry Pruning-Alleycropping-Reduced Tillage"</span>, <span class='st'>"Agroforestry Pruning-Parklands"</span>,
                                                                                          <span class='st'>"Agroforestry Pruning-Boundary Planting"</span>, 
                                                                                          <span class='st'>"Agroforestry Pruning-Boundary Planting-Inorganic Fertilizer"</span>, 
                                                                                          <span class='st'>"Agroforestry Fallow-Agroforestry Pruning"</span>, 
                                                                                          <span class='st'>"Agroforestry Fallow-Agroforestry Pruning-Alleycropping"</span>, 
                                                                                          <span class='st'>"Agroforestry Pruning-Alleycropping-Intercropping"</span>, 
                                                                                          <span class='st'>"Agroforestry Pruning-Green Manure"</span>, <span class='st'>"Agroforestry Pruning-Green Manure-Inorganic Fertilizer"</span>,
                                                                                          <span class='st'>"Agroforestry Fallow"</span>,  <span class='st'>"Agroforestry Fallow-Water Harvesting"</span>, 
                                                                                          <span class='st'>"Agroforestry Fallow-Agroforestry Pruning-Reduced Tillage"</span>, <span class='st'>"Agroforestry Pruning-Intercropping"</span>,
                                                                                          <span class='st'>"Other Agroforestry"</span>, <span class='st'>"Mulch-Other Agroforestry-Reduced Tillage"</span>, 
                                                                                          <span class='st'>"Agroforestry Pruning-Reduced Tillage-Water Harvesting"</span><span class='op'>)</span><span class='op'>)</span>,
                        Out.SubInd <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='st'>"Crop Yield"</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Biomass Yield"</span>, <span class='st'>"Soil Organic Carbon"</span>, <span class='st'>"Soil Nitrogen"</span>, <span class='st'>"Crop Yield"</span>, <span class='st'>"Carbon Dioxide Emissions"</span>, <span class='st'>"Gross Return"</span>,
                                                                      <span class='st'>"Marginal Rate of Return"</span>, <span class='st'>"Beneficial Organisms"</span>, <span class='st'>"Nitrogen Use Efficiency (ARE AGB)"</span>, <span class='st'>"Cation Exchange Capacity"</span>,
                                                                      <span class='st'>"Phosphorus Use Efficiency (ARE AGB)"</span>, <span class='st'>"Potassium Use Efficiency (ARE AGB)"</span>, <span class='st'>"Soil Organic Carbon (Change)"</span>, 
                                                                      <span class='st'>"Water Use Efficiency"</span>, <span class='st'>"Soil Moisture"</span>, <span class='st'>"Labour Person Hours"</span>, <span class='st'>"Labour Cost"</span>, <span class='st'>"Variable Cost"</span>, <span class='st'>"Net Return"</span>,
                                                                      <span class='st'>"Benefit Cost Ratio (NRTC)"</span>, <span class='st'>"Return to Labour"</span>, <span class='st'>"Gross Margin"</span>, <span class='st'>"Benefit Cost Ratio (GRVC)"</span>, <span class='st'>"Net Present Value"</span>,
                                                                      <span class='st'>"Biodiversity"</span>, <span class='st'>"Phosphorus Agronomic Efficiency"</span>, <span class='st'>"Soil Organic Matter"</span>, <span class='st'>"Nitrogen Factor Productivity"</span>, <span class='st'>"Water Use"</span>,
                                                                      <span class='st'>"Infiltration Rate"</span>, <span class='st'>"Runoff"</span>, <span class='st'>"Erosion"</span>, <span class='st'>"Soil Total Nitrogen"</span>, <span class='st'>"Soil Carbon Stocks"</span>, <span class='st'>"Soil Available Nitrogen"</span>,
                                                                      <span class='st'>"Nitrous Oxide Emissions"</span>, <span class='st'>"Methane Emissions"</span>, <span class='st'>"CO2 Equivalent Emissions"</span>, <span class='st'>"Benefit Cost Ratio (GRTC)"</span>, <span class='st'>"Soil NH4"</span>,
                                                                      <span class='st'>"Soil NO3"</span>, <span class='st'>"Land Equivalent Ratio"</span><span class='op'>)</span><span class='op'>)</span>,
                        Product <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='st'>"Maize"</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Pearl Millet"</span>, <span class='st'>"Maize"</span>, <span class='st'>"Wheat"</span>, <span class='st'>"Sorghum"</span>, <span class='st'>"Tomato (Total Yield)"</span>, <span class='st'>"Common Bean"</span>, <span class='st'>"Okra"</span>, <span class='st'>"Spinach"</span>, <span class='st'>"Sunflower (Seed)"</span>,
                                                              <span class='st'>"Rice"</span>, <span class='st'>"Sunflower (Oil)"</span>, <span class='st'>"Sesame Seed"</span>, <span class='st'>"Eggplant"</span>, <span class='st'>"Barley"</span>, <span class='st'>"Finger Millet"</span>, <span class='st'>"Soybean"</span><span class='op'>)</span><span class='op'>)</span>,
                        Tree <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='st'>"Senna siamea"</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Faidherbia albida"</span>, <span class='st'>"Aristida sieberiana"</span>, <span class='st'>"Guiera senegalensis"</span>, <span class='st'>"Calliandra calothyrsus"</span>, <span class='st'>"Sesbania sesban"</span>, 
                                                                  <span class='st'>"Leucaena leucocephala"</span>, <span class='st'>"Leucaena pallida"</span>, <span class='st'>"Acacia albida"</span>, <span class='st'>"Albizia gummifera"</span>, <span class='st'>"Cordia africana"</span>, 
                                                                  <span class='st'>"Croton macrostachyus"</span>, <span class='st'>"Milletia ferruginea"</span>, <span class='st'>"Gliricidia sepium"</span>, <span class='st'>"Unknown_Tree"</span>, <span class='st'>"Alnus acuminata"</span>, 
                                                                  <span class='st'>"Alnus acuminata.Calliandra calothyrsus.Sesbania sesban"</span>, <span class='st'>"Calliandra calothyrsus.Leucaena leucocephala"</span>, 
                                                                  <span class='st'>"Crotalaria juncea"</span>, <span class='st'>"Cupressus lusitanica"</span>, <span class='st'>"Casuarina equisetifolia"</span>, <span class='st'>"Markhamia lutea"</span>, <span class='st'>"Melia azedarach"</span>, 
                                                                  <span class='st'>"Cordia abyssinica"</span>, <span class='st'>"Maesopsis eminii"</span>, <span class='st'>"Senna spectabilis"</span>, <span class='st'>"Tithonia diversifolia"</span>, <span class='st'>"Acacia tumida"</span>, 
                                                                  <span class='st'>"Eucalyptus saligna"</span>, <span class='st'>"Flemingia macrophylla"</span>, <span class='st'>"Senna siamea"</span>, <span class='st'>"Leucaena leucocephala.Gliricidia Sepium"</span>, 
                                                                  <span class='st'>"Croton megalocarpus"</span>, <span class='st'>"Melia volkensii"</span>, <span class='st'>"Croton megalocarpus.Melia volkensii.Senna spectabilis.Gliricidia sepium"</span>,
                                                                  <span class='st'>"Pinus patula"</span>, <span class='st'>"Acacia saligna"</span>, <span class='st'>"Crotalaria grahamiana"</span>, <span class='st'>"Grevillea robusta"</span>, <span class='st'>"Paulownia fortunei"</span>, 
                                                                  <span class='st'>"Entada abyssinica"</span>, <span class='st'>"Dactyladenia barteri"</span>, <span class='st'>"Gliricidia"</span>, <span class='st'>"Flemingia"</span>, <span class='st'>"Cinnamomum cassia"</span>,<span class='st'>"Flemingia congesta"</span>, 
                                                                  <span class='st'>"Cassia siamea"</span>, <span class='st'>"cassia siamea"</span>, <span class='st'>"Leucaena leucocephala.Acioa barteri"</span>, <span class='st'>"Acioa barteri"</span>, <span class='st'>"Azadirachta indica"</span>,
                                                                  <span class='st'>"Parkia biglobosa"</span>, <span class='st'>"Millettia  thonningii"</span>, <span class='st'>"Pterocarpus santalinoides"</span>, <span class='st'>"Acacia angustissima"</span>,
                                                                  <span class='st'>"Tithonia diversifolia.Acacia angustissima"</span>, <span class='st'>"Tithonia diversifolia.Calliandra calothyrsus"</span>, 
                                                                  <span class='st'>"Tithonia diversifolia.Flemingia macrophylla"</span>, <span class='st'>"Elaeis guineensis"</span>, <span class='st'>"Leucaena leucocephala (Var K28)"</span>, 
                                                                  <span class='st'>"Cajanus cajan"</span>, <span class='st'>"Leucaena.Azadirachta indica.Parkia biglobosa"</span>, 
                                                                  <span class='st'>"Senna siamea.Leucaena leucocephala.Azadirachta indica"</span>, <span class='st'>"Vitellaria paradoxa.Parkia biglobosa"</span>, <span class='st'>"Vitellaria paradoxa"</span>,
                                                                  <span class='st'>"Parkia biglobosa.Vitellaria paradoxa"</span>, <span class='st'>"Parkia biglobosa.Adansonia digitata"</span>, <span class='st'>"Stylosanthes hamata"</span>, 
                                                                  <span class='st'>"Adansonia digitata"</span>, <span class='st'>"Albizia lebbeck"</span>, <span class='st'>"Acacia holosericea"</span>, <span class='st'>"Palm"</span>, <span class='st'>"Acacia senegal"</span>, <span class='st'>"Acacia crassicarpa"</span>, 
                                                                  <span class='st'>"Acacia mangium"</span>, <span class='st'>"Acacia polyacantha"</span>, <span class='st'>"Leucaena diversifolia"</span>, <span class='st'>"Tephrosia vogelii.Sesbania sesban"</span>, 
                                                                  <span class='st'>"Alchornea cordifolia"</span>, <span class='st'>"Uapaca kirkiana.Brachystegia spiciformis.Julbernardia globiflora"</span>, <span class='st'>"Uapaca kirkiana"</span>,
                                                                  <span class='st'>"Sesbania rostrata"</span>, <span class='st'>"Cassia spectabilis"</span>, <span class='st'>"Grevillea robusta.Cajanus cajan"</span>, <span class='st'>"Tephrosia vogelii"</span>, <span class='st'>"Sesbania cinerascens"</span>,
                                                                  <span class='st'>"Senna didymobotrya"</span>, <span class='st'>"Senna occidentalis"</span>, <span class='st'>"Eucalyptus camaldulensis"</span>, <span class='st'>"Pueraria phaseoloides"</span>, <span class='st'>"Acacia leptocarpa"</span>,
                                                                  <span class='st'>"Gliricida sepium"</span>, <span class='st'>"Flemingia macrophylla.Gliricidia sepium"</span>, <span class='st'>"Cedrela serrata"</span>, <span class='st'>"Acrocarpus fraxinifolius"</span>, 
                                                                  <span class='st'>"Cedrela odorata"</span>, <span class='st'>"Erythrina poeppigiana"</span>, <span class='st'>"Albizia chinensis"</span>, <span class='st'>"Piliostigma reticulatum"</span>, 
                                                                  <span class='st'>"Poupartia silvatica-Fernandoa madagascariensis-Tarenna sp"</span>, <span class='st'>"Acacia tortilis"</span>, <span class='st'>"Crotalaria ochrolueca"</span>, 
                                                                  <span class='st'>"Desmodium intortum"</span>, <span class='st'>"Bauhinia reticulata"</span>, <span class='st'>"Bauhinia reticulata-Guiera senegalensis"</span>, <span class='st'>"Acacia sp"</span><span class='op'>)</span><span class='op'>)</span>,
                        Out.SubInd.Code <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='st'>"CrY"</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"BiY"</span>, <span class='st'>"SOC"</span>, <span class='st'>"SN"</span>, <span class='st'>"CrY"</span>, <span class='st'>"CO2"</span>, <span class='st'>"GR"</span>, <span class='st'>"MRR"</span>, <span class='st'>"BO"</span>, <span class='st'>"NUE-Aag"</span>, <span class='st'>"CEC"</span>, <span class='st'>"PUE-Aag"</span>, <span class='st'>"KUE-Aag"</span>, <span class='st'>"SOCh"</span>, <span class='st'>"WUE"</span>, <span class='st'>"SM"</span>,
                                                                    <span class='st'>"La-ph"</span>, <span class='st'>"LC"</span>, <span class='st'>"VC"</span>, <span class='st'>"NR"</span>, <span class='st'>"BCR-NRTC"</span>, <span class='st'>"RtL"</span>, <span class='st'>"GM"</span>, <span class='st'>"BCR-GRVC"</span>, <span class='st'>"NOV"</span>, <span class='st'>"Bd"</span>, <span class='st'>"PAEp"</span>, <span class='st'>"SOM"</span>, <span class='st'>"NTFP"</span>, <span class='st'>"WU"</span>, <span class='st'>"In"</span>,
                                                                    <span class='st'>"Ru"</span>, <span class='st'>"Er"</span>, <span class='st'>"STN"</span>, <span class='st'>"SCS"</span>, <span class='st'>"SAN"</span>, <span class='st'>"NOx"</span>, <span class='st'>"CH4"</span>, <span class='st'>"CO2eq"</span>, <span class='st'>"BCR-GRTC"</span>, <span class='st'>"SNH4"</span>, <span class='st'>"SNO3"</span>, <span class='st'>"LER"</span><span class='op'>)</span><span class='op'>)</span>,
                        Site.Type <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='st'>"Station"</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Farm"</span>, <span class='st'>"Station"</span>, <span class='st'>"Survey"</span><span class='op'>)</span><span class='op'>)</span>,
                        Latitude <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1.5824</span>,
                        Longitude <span class='op'>=</span> <span class='fl'>37.2432</span>,
                        
                        Bio01_MT_Annu <span class='op'>=</span> <span class='fl'>21.61667</span>, 
                        Bio02_MDR <span class='op'>=</span> <span class='fl'>9.716667</span>, 
                        Bio03_Iso <span class='op'>=</span> <span class='fl'>83.04844</span>, 
                        Bio04_TS <span class='op'>=</span> <span class='fl'>52.88638</span>, 
                        Bio05_TWM <span class='op'>=</span> <span class='fl'>27.5</span>, 
                        Bio06_MinTCM <span class='op'>=</span> <span class='fl'>15.8</span>, 
                        Bio07_TAR <span class='op'>=</span> <span class='fl'>11.7</span>, 
                        Bio08_MT_WetQ <span class='op'>=</span> <span class='fl'>21.8</span>, 
                        Bio09_MT_DryQ <span class='op'>=</span> <span class='fl'>20.91667</span>, 
                        Bio10_MT_WarQ <span class='op'>=</span> <span class='fl'>22.28333</span>, 
                        Bio11_MT_ColQ <span class='op'>=</span> <span class='fl'>20.91667</span>, 
                        Bio12_Pecip_Annu <span class='op'>=</span> <span class='fl'>1316</span>, 
                        Bio13_Precip_WetM <span class='op'>=</span> <span class='fl'>227</span>, 
                        Bio14_Precip_DryM <span class='op'>=</span> <span class='fl'>42</span>, 
                        Bio15_Precip_S <span class='op'>=</span> <span class='fl'>53.04502</span>, 
                        Bio16_Precip_WetQ <span class='op'>=</span> <span class='fl'>585</span>,
                        Bio17_Precip_DryQ <span class='op'>=</span> <span class='fl'>168</span>, 
                        iSDA_Depth_to_bedrock <span class='op'>=</span> <span class='fl'>199.99</span>, 
                        iSDA_SAND_conc <span class='op'>=</span> <span class='fl'>48.582</span>, 
                        iSDA_CLAY_conc <span class='op'>=</span> <span class='fl'>33.402</span>, 
                        iSDA_SILT_conc <span class='op'>=</span> <span class='fl'>16.748</span>, 
                        iSDA_log_C_tot <span class='op'>=</span> <span class='fl'>27.514</span>  , 
                        iSDA_FE_Bulk_dens <span class='op'>=</span> <span class='fl'>132.154</span>, 
                        iSDA_log_Ca <span class='op'>=</span> <span class='fl'>67.774</span>, 
                        iSDA_log_eCEC <span class='op'>=</span> <span class='fl'>27.786</span>, 
                        iSDA_log_Fe <span class='op'>=</span> <span class='fl'>35.182</span>, 
                        iSDA_log_K <span class='op'>=</span> <span class='fl'>53.296</span>, 
                        iSDA_log_Mg <span class='op'>=</span> <span class='fl'>55.09</span>,
                        iSDA_log_N <span class='op'>=</span> <span class='fl'>60.844</span>,
                        iSDA_log_SOC <span class='op'>=</span> <span class='fl'>22.29</span>, 
                        iSDA_log_P <span class='op'>=</span> <span class='fl'>24.798</span>,
                        iSDA_log_S <span class='op'>=</span> <span class='fl'>17.79</span>, 
                        iSDA_pH <span class='op'>=</span> <span class='fl'>59.784</span>,
                        ASTER_Altitude <span class='op'>=</span> <span class='fl'>1578.35</span>,
                        ASTER_Slope <span class='op'>=</span> <span class='fl'>4.2</span><span class='op'>)</span>

<span class='va'>cp_rf_logRR_low</span> <span class='op'>&lt;-</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>explainer_rf_continous</span>, <span class='va'>new_obs_1</span><span class='op'>)</span>

<span class='va'>cp_rf_logRR_low</span>
</code></pre>
</div>
</details>
<pre><code>[1] -0.3301883</code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cp_1</span> <span class='op'>&lt;-</span> <span class='fu'>DALEX</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/DALEX/man/predict_profile.html'>predict_profile</a></span><span class='op'>(</span><span class='va'>explainer_rf_continous</span>, 
                               <span class='va'>new_obs_1</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>cp_1</span>,
     variables <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"iSDA_log_P"</span>, <span class='st'>"Bio01_MT_Annu"</span>, <span class='st'>"Bio17_Precip_DryQ"</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># "iSDA_SAND_conc", "iSDA_CLAY_conc", "Bio07_TAR"</span>
</code></pre>
</div>
</details>
<p><img src="TIDYMODELSWFS_files/figure-html5/unnamed-chunk-65-1.png" width="624" /></p>
</div>
<p>Prediction profiles</p>
<p>new observation</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
<h3 id="references">References</h3>
<div id="references-listing"></div>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
